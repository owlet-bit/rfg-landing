<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Twilight Herbarium - A Color Portrait</title>
<style>
:root {
  --void: #2A2D2A;
  --deep-sage: #3D4A3D;
  --sage-shadow: #4A5548;
  --sage-mid: #708878;
  --sage-light: #90A890;
  --sage-whisper: #A8C0B0;
  --silver-vein: #B8B4B0;
  --bone: #E8E0D8;
  --shell: #F5F0EB;
  --flush: #D4A8A4;
  --rose: #C08080;
  --mauve: #986870;
  --berry: #904858;
  --periwinkle: #8898B8;
  --gold-fleck: #D4C8A0;
  --moon-glow: rgba(168, 192, 176, 0.15);
}

* { box-sizing: border-box; margin: 0; padding: 0; }

@keyframes moonPulse {
  0%, 100% { opacity: 0.4; transform: scale(1); }
  50% { opacity: 0.7; transform: scale(1.02); }
}

@keyframes particleFloat {
  0%, 100% { transform: translateY(0) translateX(0); opacity: 0.3; }
  25% { transform: translateY(-20px) translateX(10px); opacity: 0.6; }
  50% { transform: translateY(-10px) translateX(-5px); opacity: 0.4; }
  75% { transform: translateY(-30px) translateX(15px); opacity: 0.5; }
}

@keyframes softGlow {
  0%, 100% { box-shadow: 0 0 20px var(--moon-glow); }
  50% { box-shadow: 0 0 40px var(--moon-glow), 0 0 60px var(--moon-glow); }
}

@keyframes textReveal {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes swatchAppear {
  from { opacity: 0; transform: scale(0.8); }
  to { opacity: 1; transform: scale(1); }
}

body {
  font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, Georgia, serif;
  background: var(--void);
  color: var(--bone);
  min-height: 100vh;
  line-height: 1.6;
  overflow-x: hidden;
}

.particles {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 0;
  overflow: hidden;
}

.particle {
  position: absolute;
  width: 4px;
  height: 4px;
  background: var(--sage-whisper);
  border-radius: 50%;
  animation: particleFloat 8s ease-in-out infinite;
}

.moon {
  position: fixed;
  top: 40px;
  right: 40px;
  width: 80px;
  height: 80px;
  background: radial-gradient(circle at 30% 30%, var(--shell), var(--sage-whisper));
  border-radius: 50%;
  animation: moonPulse 6s ease-in-out infinite, softGlow 4s ease-in-out infinite;
  z-index: 1;
  opacity: 0.6;
}

@media (max-width: 600px) {
  .moon { width: 50px; height: 50px; top: 20px; right: 20px; }
}

.container {
  position: relative;
  z-index: 2;
  max-width: 800px;
  margin: 0 auto;
  padding: 60px 24px 100px;
}

header {
  text-align: center;
  margin-bottom: 60px;
  animation: textReveal 1.2s ease-out;
}

.season-badge {
  display: inline-block;
  font-size: 11px;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: var(--sage-light);
  border: 1px solid var(--sage-shadow);
  padding: 6px 16px;
  margin-bottom: 20px;
}

h1 {
  font-size: clamp(28px, 8vw, 42px);
  font-weight: normal;
  font-style: italic;
  color: var(--shell);
  margin-bottom: 8px;
  letter-spacing: 0.02em;
}

.subtitle {
  font-size: 14px;
  color: var(--sage-light);
  letter-spacing: 0.1em;
}

.analysis {
  background: linear-gradient(135deg, var(--deep-sage), var(--sage-shadow));
  border: 1px solid var(--sage-mid);
  padding: 32px;
  margin-bottom: 50px;
  animation: textReveal 1.4s ease-out;
}

.analysis p {
  font-size: 15px;
  margin-bottom: 16px;
  text-align: justify;
  hyphens: auto;
}

.analysis p:last-child { margin-bottom: 0; }

.section-title {
  font-size: 12px;
  letter-spacing: 0.25em;
  text-transform: uppercase;
  color: var(--sage-whisper);
  margin-bottom: 24px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--sage-shadow);
}

.pigments {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 16px;
  margin-bottom: 50px;
}

.pigment {
  background: var(--deep-sage);
  border: 1px solid var(--sage-shadow);
  padding: 16px;
  animation: swatchAppear 0.6s ease-out backwards;
}

.pigment-swatch {
  width: 100%;
  height: 50px;
  margin-bottom: 12px;
  border: 1px solid rgba(255,255,255,0.1);
}

.pigment-name {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--sage-light);
  margin-bottom: 4px;
}

.pigment-desc {
  font-size: 13px;
  font-style: italic;
  color: var(--bone);
}

.pigment-hex {
  font-size: 11px;
  font-family: 'Courier New', monospace;
  color: var(--silver-vein);
  margin-top: 4px;
}

.palette-section {
  margin-bottom: 40px;
}

.palette-group-title {
  font-size: 14px;
  font-style: italic;
  color: var(--flush);
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.palette-group-title::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--sage-shadow);
}

.swatches {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
  gap: 8px;
}

.swatch {
  aspect-ratio: 1;
  min-height: 50px;
  border: 1px solid rgba(255,255,255,0.1);
  cursor: pointer;
  position: relative;
  transition: transform 0.2s, box-shadow 0.3s;
  animation: swatchAppear 0.5s ease-out backwards;
}

.swatch:hover {
  transform: scale(1.08);
  box-shadow: 0 0 20px var(--moon-glow);
  z-index: 10;
}

.swatch.favorited::after {
  content: '';
  position: absolute;
  top: 4px;
  right: 4px;
  width: 8px;
  height: 8px;
  background: var(--gold-fleck);
  border-radius: 50%;
  box-shadow: 0 0 8px var(--gold-fleck);
}

.swatch.comparing {
  outline: 2px solid var(--shell);
  outline-offset: 2px;
}

.swatch-tooltip {
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: var(--void);
  border: 1px solid var(--sage-mid);
  padding: 6px 10px;
  font-size: 11px;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s;
  z-index: 100;
}

.swatch:hover .swatch-tooltip { opacity: 1; }

.toast {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: var(--deep-sage);
  border: 1px solid var(--sage-light);
  color: var(--shell);
  padding: 12px 24px;
  font-size: 13px;
  z-index: 1000;
  transition: transform 0.3s ease-out;
}

.toast.visible { transform: translateX(-50%) translateY(0); }

.tools {
  background: var(--deep-sage);
  border: 1px solid var(--sage-shadow);
  padding: 24px;
  margin-bottom: 40px;
}

.tool-tabs {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 20px;
}

.tool-tab {
  background: transparent;
  border: 1px solid var(--sage-shadow);
  color: var(--sage-light);
  padding: 10px 16px;
  font-family: inherit;
  font-size: 12px;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.2s;
  min-height: 44px;
}

.tool-tab:hover, .tool-tab.active {
  background: var(--sage-shadow);
  color: var(--shell);
  border-color: var(--sage-mid);
}

.tool-panel { display: none; }
.tool-panel.active { display: block; }

.compare-area {
  display: flex;
  gap: 20px;
  align-items: flex-start;
  flex-wrap: wrap;
}

.compare-slot {
  flex: 1;
  min-width: 120px;
  text-align: center;
}

.compare-swatch {
  width: 100%;
  height: 80px;
  border: 2px dashed var(--sage-shadow);
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: var(--sage-mid);
}

.compare-swatch.filled { border-style: solid; }

.compare-verdict {
  margin-top: 16px;
  padding: 16px;
  background: var(--sage-shadow);
  font-size: 14px;
  line-height: 1.5;
}

.looks-grid {
  display: grid;
  gap: 20px;
}

.look-card {
  background: var(--sage-shadow);
  border: 1px solid var(--sage-mid);
  padding: 20px;
}

.look-title {
  font-size: 16px;
  font-style: italic;
  color: var(--shell);
  margin-bottom: 4px;
}

.look-occasion {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--sage-light);
  margin-bottom: 16px;
}

.look-colors {
  display: flex;
  gap: 6px;
  margin-bottom: 12px;
}

.look-color {
  width: 36px;
  height: 36px;
  border: 1px solid rgba(255,255,255,0.2);
}

.look-desc {
  font-size: 13px;
  color: var(--bone);
  line-height: 1.5;
}

.favorites-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 16px;
  min-height: 50px;
}

.favorites-empty {
  color: var(--sage-mid);
  font-style: italic;
  font-size: 13px;
}

.export-buttons {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.export-btn {
  background: var(--sage-shadow);
  border: 1px solid var(--sage-mid);
  color: var(--bone);
  padding: 12px 20px;
  font-family: inherit;
  font-size: 12px;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.2s;
  min-height: 44px;
}

.export-btn:hover {
  background: var(--sage-mid);
  color: var(--shell);
}

.lighting-controls {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-bottom: 20px;
}

.light-btn {
  background: transparent;
  border: 1px solid var(--sage-shadow);
  color: var(--sage-light);
  padding: 10px 14px;
  font-family: inherit;
  font-size: 11px;
  cursor: pointer;
  transition: all 0.2s;
  min-height: 44px;
}

.light-btn:hover, .light-btn.active {
  background: var(--sage-shadow);
  color: var(--shell);
}

.lighting-preview {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 6px;
}

.lighting-swatch {
  height: 40px;
  border: 1px solid rgba(255,255,255,0.1);
  transition: background-color 0.5s;
}

.harmony-result {
  margin-top: 16px;
}

.harmony-swatches {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
}

.harmony-swatch {
  width: 50px;
  height: 50px;
  border: 1px solid rgba(255,255,255,0.2);
  cursor: pointer;
  transition: transform 0.2s;
}

.harmony-swatch:hover { transform: scale(1.1); }

.harmony-desc {
  font-size: 13px;
  font-style: italic;
  color: var(--bone);
}

.color-input-row {
  display: flex;
  gap: 12px;
  align-items: center;
  margin-bottom: 16px;
  flex-wrap: wrap;
}

.color-picker-wrap {
  position: relative;
}

.color-picker {
  width: 60px;
  height: 44px;
  border: 1px solid var(--sage-mid);
  background: var(--void);
  cursor: pointer;
  padding: 0;
}

.match-btn {
  background: var(--sage-shadow);
  border: 1px solid var(--sage-mid);
  color: var(--bone);
  padding: 12px 20px;
  font-family: inherit;
  font-size: 12px;
  cursor: pointer;
  min-height: 44px;
}

.match-result {
  margin-top: 16px;
  padding: 16px;
  background: var(--sage-shadow);
}

.match-comparison {
  display: flex;
  gap: 16px;
  align-items: center;
  margin-bottom: 12px;
}

.match-box {
  text-align: center;
}

.match-swatch {
  width: 60px;
  height: 60px;
  border: 1px solid rgba(255,255,255,0.2);
  margin-bottom: 6px;
}

.match-label {
  font-size: 11px;
  color: var(--sage-light);
}

.match-arrow {
  font-size: 20px;
  color: var(--sage-mid);
}

.focus-mode {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1000;
  display: none;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

.focus-mode.active { display: flex; }

.focus-inner {
  text-align: center;
  animation: softGlow 3s ease-in-out infinite;
  padding: 40px;
}

.focus-swatch {
  width: 200px;
  height: 200px;
  margin: 0 auto 24px;
  border: 1px solid rgba(255,255,255,0.2);
}

.focus-name {
  font-size: 18px;
  font-style: italic;
  color: var(--shell);
  margin-bottom: 8px;
}

.focus-hex {
  font-family: 'Courier New', monospace;
  font-size: 14px;
  color: var(--silver-vein);
}

.focus-hint {
  position: absolute;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 12px;
  color: var(--sage-mid);
}

.generator-btn {
  background: var(--sage-shadow);
  border: 1px solid var(--sage-mid);
  color: var(--bone);
  padding: 14px 24px;
  font-family: inherit;
  font-size: 13px;
  cursor: pointer;
  margin-bottom: 20px;
  min-height: 44px;
  transition: all 0.2s;
}

.generator-btn:hover {
  background: var(--sage-mid);
}

.generated-story {
  padding: 20px;
  background: var(--sage-shadow);
  margin-top: 16px;
}

.story-colors {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
}

.story-swatch {
  flex: 1;
  height: 60px;
  border: 1px solid rgba(255,255,255,0.2);
}

.story-narrative {
  font-size: 14px;
  font-style: italic;
  line-height: 1.6;
}

.drift-visual {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
}

.drift-column {
  flex: 1;
  min-width: 100px;
}

.drift-label {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--sage-light);
  margin-bottom: 8px;
  text-align: center;
}

.drift-swatches {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.drift-swatch {
  height: 30px;
  border: 1px solid rgba(255,255,255,0.1);
}

.undertone-bar {
  height: 20px;
  display: flex;
  margin-top: 16px;
  border: 1px solid var(--sage-mid);
}

.undertone-segment {
  transition: width 0.3s;
}

.undertone-labels {
  display: flex;
  justify-content: space-between;
  font-size: 11px;
  color: var(--sage-light);
  margin-top: 6px;
}

footer {
  text-align: center;
  padding: 40px 0;
  font-size: 12px;
  color: var(--sage-mid);
  letter-spacing: 0.1em;
}

.instructions {
  background: var(--sage-shadow);
  padding: 16px;
  margin-bottom: 40px;
  font-size: 13px;
  line-height: 1.6;
  color: var(--sage-light);
}

.instructions strong { color: var(--bone); }

.makeup-sections {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.makeup-category {
  background: var(--sage-shadow);
  padding: 16px;
  border: 1px solid var(--sage-mid);
}

.makeup-category-title {
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.15em;
  color: var(--flush);
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--sage-mid);
}

.makeup-swatches {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(36px, 1fr));
  gap: 6px;
}

.makeup-swatch {
  width: 100%;
  aspect-ratio: 1;
  min-height: 36px;
  border: 1px solid rgba(255,255,255,0.15);
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
  position: relative;
}

.makeup-swatch:hover {
  transform: scale(1.15);
  box-shadow: 0 0 12px var(--moon-glow);
  z-index: 10;
}

.makeup-swatch.selected {
  outline: 2px solid var(--shell);
  outline-offset: 2px;
}

.makeup-swatch-tooltip {
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: var(--void);
  border: 1px solid var(--sage-mid);
  padding: 4px 8px;
  font-size: 10px;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s;
  z-index: 100;
}

.makeup-swatch:hover .makeup-swatch-tooltip { opacity: 1; }

.makeup-builder {
  background: var(--deep-sage);
  border: 1px solid var(--sage-mid);
  padding: 20px;
  margin-bottom: 20px;
}

.makeup-builder-title {
  font-size: 14px;
  font-style: italic;
  color: var(--shell);
  margin-bottom: 12px;
}

.makeup-face-container {
  display: flex;
  gap: 30px;
  align-items: center;
  flex-wrap: wrap;
}

.makeup-face {
  width: 160px;
  height: 200px;
  background: var(--sage-shadow);
  border: 1px solid var(--sage-mid);
  border-radius: 80px 80px 60px 60px;
  position: relative;
  flex-shrink: 0;
}

.face-zone {
  position: absolute;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  color: var(--sage-light);
  cursor: pointer;
  transition: all 0.2s;
  border: 1px dashed var(--sage-mid);
}

.face-zone:hover {
  border-color: var(--shell);
  color: var(--shell);
}

.face-zone.filled {
  border-style: solid;
  color: transparent;
}

.face-eyes {
  width: 120px;
  height: 24px;
  top: 60px;
  left: 50%;
  transform: translateX(-50%);
  border-radius: 12px;
}

.face-brows {
  width: 120px;
  height: 12px;
  top: 42px;
  left: 50%;
  transform: translateX(-50%);
  border-radius: 6px;
}

.face-cheeks {
  width: 130px;
  height: 30px;
  top: 100px;
  left: 50%;
  transform: translateX(-50%);
  border-radius: 15px;
}

.face-lips {
  width: 50px;
  height: 20px;
  top: 145px;
  left: 50%;
  transform: translateX(-50%);
  border-radius: 10px;
}

.makeup-selected {
  display: flex;
  align-items: center;
  gap: 12px;
}

.selected-label {
  font-size: 12px;
  color: var(--sage-light);
}

.selected-swatch {
  width: 40px;
  height: 40px;
  border: 1px solid var(--sage-mid);
  background: var(--sage-shadow);
}

.selected-name {
  font-size: 13px;
  color: var(--bone);
  font-style: italic;
}

.makeup-looks-grid {
  display: grid;
  gap: 16px;
}

.makeup-look-card {
  background: var(--sage-shadow);
  border: 1px solid var(--sage-mid);
  padding: 16px;
}

.makeup-look-title {
  font-size: 15px;
  font-style: italic;
  color: var(--shell);
  margin-bottom: 4px;
}

.makeup-look-vibe {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--sage-light);
  margin-bottom: 12px;
}

.makeup-look-colors {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
  flex-wrap: wrap;
}

.makeup-look-color {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
}

.makeup-look-swatch {
  width: 32px;
  height: 32px;
  border: 1px solid rgba(255,255,255,0.2);
}

.makeup-look-label {
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--sage-light);
}

.makeup-look-desc {
  font-size: 13px;
  color: var(--bone);
  line-height: 1.5;
}
</style>
</head>
<body>

<div class="particles" id="particles"></div>
<div class="moon"></div>

<div class="container">
  <header>
    <div class="season-badge">Light Summer</div>
    <h1>Twilight Herbarium</h1>
    <div class="subtitle">Pressed Colors for a Light Summer</div>
  </header>

  <section class="analysis">
    <p>Your coloring exists in the liminal space between daylight and dusk — that tender interval when shadows turn lavender and the world holds its breath. There is nothing harsh here, no hard edges. The light that lives in your skin is diffuse, cool, touched with an almost spectral translucency. Blue veins trace delicate maps beneath the surface; your natural flush speaks in soft pink rather than peach, as though color itself approaches you gently, asking permission.</p>
    
    <p>The eyes complicate everything beautifully. Soft sage green with a gray veil, they would be entirely cool if not for that secret: an amber sunburst around each pupil, a warm private gold that contradicts the silver story of the rest. This is your tension, your interest — cool foundation, warm whisper. Your ash-blonde roots fade into lengths kissed more golden, whether by sun or intention. The effect is of someone who belongs to the cool seasons but carries a small flame.</p>
    
    <p>You are Light Summer with a footnote, a soft palette with hidden warmth. Your colors should feel like early morning in a garden: sage, pewter, dusty rose, soft periwinkle, the palest coral. Nothing too saturated, nothing too dark, nothing that shouts. But within that gentleness — permission for warmth where it echoes your own: soft gold jewelry, a hint of peach in your blush, champagne where silver feels too cold. You are the soft hour, and your colors should honor that quiet radiance.</p>
  </section>

  <div class="instructions">
    <strong>How to use:</strong> Click any swatch to copy its hex code. Double-click to mark as favorite. Click a favorited swatch in Focus mode to meditate on it. Use the tools below to compare colors, explore looks, simulate lighting, and discover harmonies.
  </div>

  <section>
    <h2 class="section-title">Source Pigments</h2>
    <div class="pigments" id="pigments"></div>
  </section>

  <section>
    <h2 class="section-title">Your Wearable Palette</h2>
    <div id="palette"></div>
  </section>

  <section class="tools">
    <div class="tool-tabs">
      <button class="tool-tab active" data-tab="compare">Compare</button>
      <button class="tool-tab" data-tab="looks">Looks</button>
      <button class="tool-tab" data-tab="makeup">Makeup</button>
      <button class="tool-tab" data-tab="favorites">Favorites</button>
      <button class="tool-tab" data-tab="lighting">Lighting</button>
      <button class="tool-tab" data-tab="generator">Story Generator</button>
      <button class="tool-tab" data-tab="shopping">Shopping Match</button>
      <button class="tool-tab" data-tab="drift">Seasonal Drift</button>
      <button class="tool-tab" data-tab="undertone">Undertone Map</button>
    </div>

    <div class="tool-panel active" id="compare-panel">
      <p style="font-size: 13px; color: var(--sage-light); margin-bottom: 16px;">Click two swatches to compare them side by side.</p>
      <div class="compare-area">
        <div class="compare-slot">
          <div class="compare-swatch" id="compare-1">Select first</div>
          <div class="compare-hex" id="compare-hex-1">—</div>
        </div>
        <div class="compare-slot">
          <div class="compare-swatch" id="compare-2">Select second</div>
          <div class="compare-hex" id="compare-hex-2">—</div>
        </div>
      </div>
      <div class="compare-verdict" id="compare-verdict" style="display: none;"></div>
      <button class="export-btn" style="margin-top: 16px;" onclick="clearCompare()">Clear Comparison</button>
    </div>

    <div class="tool-panel" id="looks-panel">
      <div class="looks-grid" id="looks-grid"></div>
    </div>

    <div class="tool-panel" id="makeup-panel">
      <div class="makeup-sections">
        <div class="makeup-category">
          <div class="makeup-category-title">Lips</div>
          <div class="makeup-swatches" id="lip-swatches"></div>
        </div>
        <div class="makeup-category">
          <div class="makeup-category-title">Cheeks</div>
          <div class="makeup-swatches" id="cheek-swatches"></div>
        </div>
        <div class="makeup-category">
          <div class="makeup-category-title">Eyes</div>
          <div class="makeup-swatches" id="eye-swatches"></div>
        </div>
        <div class="makeup-category">
          <div class="makeup-category-title">Brows</div>
          <div class="makeup-swatches" id="brow-swatches"></div>
        </div>
      </div>
      
      <div class="makeup-builder">
        <div class="makeup-builder-title">Build a Look</div>
        <p style="font-size: 13px; color: var(--sage-light); margin-bottom: 16px;">Click colors above to build a makeup combination. Click a face zone to assign the selected color.</p>
        <div class="makeup-face-container">
          <div class="makeup-face">
            <div class="face-zone face-eyes" id="face-eyes" title="Eyes">Eyes</div>
            <div class="face-zone face-brows" id="face-brows" title="Brows">Brows</div>
            <div class="face-zone face-cheeks" id="face-cheeks" title="Cheeks">Cheeks</div>
            <div class="face-zone face-lips" id="face-lips" title="Lips">Lips</div>
          </div>
          <div class="makeup-selected">
            <div class="selected-label">Selected:</div>
            <div class="selected-swatch" id="makeup-selected-swatch"></div>
            <div class="selected-name" id="makeup-selected-name">None</div>
          </div>
        </div>
        <button class="export-btn" style="margin-top: 16px;" onclick="clearMakeupFace()">Clear Face</button>
        <button class="export-btn" style="margin-top: 16px;" onclick="randomMakeupLook()">Random Look</button>
      </div>

      <div class="makeup-looks-section">
        <div class="makeup-builder-title" style="margin-top: 30px;">Curated Makeup Looks</div>
        <div class="makeup-looks-grid" id="makeup-looks-grid"></div>
      </div>
    </div>

    <div class="tool-panel" id="favorites-panel">
      <p style="font-size: 13px; color: var(--sage-light); margin-bottom: 16px;">Your marked favorites appear here. Double-click any palette swatch to favorite it.</p>
      <div class="favorites-list" id="favorites-list">
        <span class="favorites-empty">No favorites yet</span>
      </div>
      <div class="export-buttons">
        <button class="export-btn" onclick="exportJSON()">Export JSON</button>
        <button class="export-btn" onclick="exportText()">Copy as Text</button>
        <button class="export-btn" onclick="exportFavoritesJSON()">Export Favorites JSON</button>
        <button class="export-btn" onclick="exportFavoritesText()">Copy Favorites as Text</button>
      </div>
    </div>

    <div class="tool-panel" id="lighting-panel">
      <p style="font-size: 13px; color: var(--sage-light); margin-bottom: 16px;">See how your palette shifts under different lighting conditions.</p>
      <div class="lighting-controls">
        <button class="light-btn active" data-light="daylight">Daylight</button>
        <button class="light-btn" data-light="morning">Morning</button>
        <button class="light-btn" data-light="evening">Golden Hour</button>
        <button class="light-btn" data-light="candle">Candlelight</button>
        <button class="light-btn" data-light="fluorescent">Fluorescent</button>
        <button class="light-btn" data-light="overcast">Overcast</button>
      </div>
      <div class="lighting-preview" id="lighting-preview"></div>
    </div>

    <div class="tool-panel" id="generator-panel">
      <p style="font-size: 13px; color: var(--sage-light); margin-bottom: 16px;">Generate a random harmonious color story from your palette.</p>
      <button class="generator-btn" onclick="generateStory()">Generate Color Story</button>
      <div id="generated-story"></div>
    </div>

    <div class="tool-panel" id="shopping-panel">
      <p style="font-size: 13px; color: var(--sage-light); margin-bottom: 16px;">Found a color while shopping? Check if it belongs in your palette or find the closest match.</p>
      <div class="color-input-row">
        <div class="color-picker-wrap">
          <input type="color" class="color-picker" id="shopping-picker" value="#B8A0A0">
        </div>
        <button class="match-btn" onclick="findMatch()">Find Match</button>
      </div>
      <div id="match-result"></div>
    </div>

    <div class="tool-panel" id="drift-panel">
      <p style="font-size: 13px; color: var(--sage-light); margin-bottom: 16px;">How your palette would shift if you drifted one season warmer or cooler.</p>
      <div class="drift-visual" id="drift-visual"></div>
    </div>

    <div class="tool-panel" id="undertone-panel">
      <p style="font-size: 13px; color: var(--sage-light); margin-bottom: 16px;">Click any swatch to analyze its undertone composition.</p>
      <div id="undertone-selected" style="margin-bottom: 16px;">
        <span style="color: var(--sage-mid); font-style: italic;">Select a swatch from the palette above</span>
      </div>
      <div class="undertone-bar" id="undertone-bar" style="display: none;">
        <div class="undertone-segment" id="ut-cool" style="background: #8898B8;"></div>
        <div class="undertone-segment" id="ut-warm" style="background: #D4C8A0;"></div>
      </div>
      <div class="undertone-labels" id="undertone-labels" style="display: none;">
        <span>Cool</span>
        <span>Warm</span>
      </div>
    </div>
  </section>

  <footer>
    Twilight Herbarium - Light Summer Palette<br>
    Double-click any swatch to enter Focus Mode
  </footer>
</div>

<div class="focus-mode" id="focus-mode" onclick="closeFocus()">
  <div class="focus-inner">
    <div class="focus-swatch" id="focus-swatch"></div>
    <div class="focus-name" id="focus-name"></div>
    <div class="focus-hex" id="focus-hex"></div>
  </div>
  <div class="focus-hint">Click anywhere to close</div>
</div>

<div class="toast" id="toast"></div>

<script>
const sourcePigments = [
  { name: "Skin Base", desc: "Cool beige with gray cast", hex: "#E8D5C8" },
  { name: "Vein Shadow", desc: "Lavender translucency", hex: "#C5B8C9" },
  { name: "Natural Flush", desc: "Cool pink bloom", hex: "#D4A5A0" },
  { name: "Lips", desc: "Dusty mauve-pink", hex: "#C0908A" },
  { name: "Hair Root", desc: "Medium ash blonde", hex: "#8B7D6B" },
  { name: "Hair Length", desc: "Warmer golden blonde", hex: "#C9AD7C" },
  { name: "Eye Primary", desc: "Soft sage green", hex: "#8B9E7E" },
  { name: "Eye Fleck", desc: "Amber gold burst", hex: "#A89560" },
  { name: "Brows", desc: "Cool ashy brown", hex: "#6B5D52" }
];

const paletteGroups = {
  "Whites & Whispers": [
    { hex: "#F5F0EB", name: "Soft White" },
    { hex: "#EBE6E1", name: "Ivory Mist" },
    { hex: "#E8E0D8", name: "Warm Shell" },
    { hex: "#E0D8D2", name: "Pearl" }
  ],
  "Silver & Stone": [
    { hex: "#D0CCC8", name: "Morning Fog" },
    { hex: "#B8B4B0", name: "Silver Vein" },
    { hex: "#A8A4A0", name: "Pewter" },
    { hex: "#7A7876", name: "Soft Charcoal" },
    { hex: "#5C5A58", name: "Deep Charcoal" }
  ],
  "Taupe & Earth": [
    { hex: "#C4B8AC", name: "Driftwood" },
    { hex: "#A89888", name: "Mushroom" },
    { hex: "#8A7D70", name: "Cocoa Taupe" },
    { hex: "#6B5F54", name: "Dusk Earth" }
  ],
  "Rose & Blush": [
    { hex: "#F5E0DC", name: "Powder Pink" },
    { hex: "#F0D4D0", name: "Ballet Slipper" },
    { hex: "#E8C0BC", name: "Blush" },
    { hex: "#D4A8A4", name: "Rose Pink" },
    { hex: "#C89090", name: "Dusty Rose" }
  ],
  "Mauve & Berry": [
    { hex: "#C08080", name: "Antique Rose" },
    { hex: "#B87878", name: "Faded Peony" },
    { hex: "#A06868", name: "Pressed Rose" },
    { hex: "#986870", name: "Mauve Shadow" },
    { hex: "#904858", name: "Raspberry" },
    { hex: "#7A4048", name: "Deep Berry" }
  ],
  "Soft Red & Coral": [
    { hex: "#B85858", name: "Soft Red" },
    { hex: "#C86868", name: "Watermelon" },
    { hex: "#E8A898", name: "Soft Coral" },
    { hex: "#F0C0B0", name: "Peach Whisper" }
  ],
  "Blue & Periwinkle": [
    { hex: "#A8C0D0", name: "Powder Blue" },
    { hex: "#8898B8", name: "Periwinkle" },
    { hex: "#88A8C0", name: "Sky Wash" },
    { hex: "#6080A0", name: "Cornflower" },
    { hex: "#5B6B7A", name: "Storm Blue" },
    { hex: "#4A5568", name: "Soft Navy" }
  ],
  "Sage & Green": [
    { hex: "#A8C0B0", name: "Mint Breath" },
    { hex: "#90A890", name: "Soft Sage" },
    { hex: "#88A098", name: "Seafoam" },
    { hex: "#708878", name: "Eucalyptus" },
    { hex: "#607868", name: "Jade Shadow" }
  ],
  "Lavender & Plum": [
    { hex: "#C8B8D0", name: "Lavender Haze" },
    { hex: "#A898B0", name: "Wisteria" },
    { hex: "#9080A0", name: "Soft Violet" },
    { hex: "#786888", name: "Dusty Plum" }
  ],
  "Warm Accents": [
    { hex: "#D4C8A0", name: "Soft Gold" },
    { hex: "#C9AD7C", name: "Wheat" },
    { hex: "#B8A078", name: "Champagne" }
  ]
};

const looks = [
  {
    title: "Morning Garden",
    occasion: "Casual Day",
    colors: ["#90A890", "#F5F0EB", "#A89888", "#C89090"],
    desc: "Soft sage top with white denim, mushroom bag, dusty rose lip. Effortless and luminous."
  },
  {
    title: "Twilight Editorial",
    occasion: "Evening Event",
    colors: ["#4A5568", "#D4A8A4", "#B8B4B0", "#786888"],
    desc: "Navy dress, rose blush, silver jewelry, plum smoky eye. Sophisticated with depth."
  },
  {
    title: "Pressed Flower",
    occasion: "Romantic Dinner",
    colors: ["#E8C0BC", "#C08080", "#6B5F54", "#D4C8A0"],
    desc: "Blush silk, antique rose lip, dark taupe heels, soft gold earrings. Tender and timeless."
  },
  {
    title: "Sea Glass",
    occasion: "Beach or Brunch",
    colors: ["#88A098", "#EBE6E1", "#A8C0D0", "#C9AD7C"],
    desc: "Seafoam linen, ivory accessories, powder blue nails, wheat sandals. Fresh and serene."
  },
  {
    title: "Storm Approaching",
    occasion: "Professional",
    colors: ["#7A7876", "#F5F0EB", "#8898B8", "#B87878"],
    desc: "Charcoal blazer, soft white blouse, periwinkle scarf, faded peony lip. Authority with softness."
  },
  {
    title: "Moonlit Ceremony",
    occasion: "Formal Event",
    colors: ["#C8B8D0", "#5C5A58", "#D0CCC8", "#904858"],
    desc: "Lavender gown, deep charcoal clutch, silver-gray shawl, raspberry lip. Ethereal drama."
  }
];

let favorites = [];
let compareSlots = [null, null];
let allSwatches = [];
let selectedMakeupColor = null;

const makeupColors = {
  lips: [
    { hex: "#D4A5A0", name: "Nude Rose" },
    { hex: "#C89090", name: "Dusty Pink" },
    { hex: "#C08080", name: "Antique Rose" },
    { hex: "#B87878", name: "Mauve Rose" },
    { hex: "#A06868", name: "Pressed Petal" },
    { hex: "#986870", name: "Berry Mauve" },
    { hex: "#904858", name: "Raspberry" },
    { hex: "#B85858", name: "Soft Red" },
    { hex: "#C86868", name: "Watermelon" },
    { hex: "#E8A898", name: "Coral Glaze" },
    { hex: "#C0908A", name: "Your Lips + 1" }
  ],
  cheeks: [
    { hex: "#F0D4D0", name: "Whisper Pink" },
    { hex: "#E8C0BC", name: "Petal Flush" },
    { hex: "#D4A8A4", name: "Rose Glow" },
    { hex: "#C89090", name: "Dusty Rose" },
    { hex: "#E8A898", name: "Soft Coral" },
    { hex: "#D4A5A0", name: "Natural Flush" },
    { hex: "#B87878", name: "Deeper Rose" },
    { hex: "#C9AD7C", name: "Bronzed Wheat" }
  ],
  eyes: [
    { hex: "#F5E0DC", name: "Inner Corner" },
    { hex: "#E8C0BC", name: "Soft Pink" },
    { hex: "#D4A8A4", name: "Rose Wash" },
    { hex: "#C08080", name: "Dusty Rose" },
    { hex: "#A06868", name: "Mauve Crease" },
    { hex: "#986870", name: "Plum Haze" },
    { hex: "#786888", name: "Dusty Violet" },
    { hex: "#8898B8", name: "Periwinkle" },
    { hex: "#6080A0", name: "Soft Navy" },
    { hex: "#90A890", name: "Sage" },
    { hex: "#708878", name: "Eucalyptus" },
    { hex: "#607868", name: "Deep Sage" },
    { hex: "#A89888", name: "Taupe" },
    { hex: "#8A7D70", name: "Cocoa" },
    { hex: "#6B5F54", name: "Deep Earth" },
    { hex: "#D4C8A0", name: "Champagne" },
    { hex: "#C9AD7C", name: "Soft Gold" },
    { hex: "#B8B4B0", name: "Silver" },
    { hex: "#7A7876", name: "Charcoal" },
    { hex: "#5C5A58", name: "Smoke" }
  ],
  brows: [
    { hex: "#8A7D70", name: "Soft Taupe" },
    { hex: "#8B7D6B", name: "Ash Blonde" },
    { hex: "#6B5D52", name: "Cool Brown" },
    { hex: "#6B5F54", name: "Taupe Brown" },
    { hex: "#5C5A58", name: "Soft Charcoal" }
  ]
};

const makeupLooks = [
  {
    title: "Barely There",
    vibe: "Natural / Everyday",
    colors: { lips: "#D4A5A0", cheeks: "#D4A8A4", eyes: "#C9AD7C", brows: "#8B7D6B" },
    desc: "Your-face-but-better. Champagne wash on lids, natural flush on cheeks, nude rose lip. Effortless luminosity."
  },
  {
    title: "Garden at Dusk",
    vibe: "Soft Romantic",
    colors: { lips: "#C08080", cheeks: "#E8C0BC", eyes: "#90A890", brows: "#6B5D52" },
    desc: "Sage shadow with rose in the crease, petal flush cheeks, antique rose lip. Dreamy without trying."
  },
  {
    title: "Silver Veil",
    vibe: "Cool & Ethereal",
    colors: { lips: "#B87878", cheeks: "#D4A8A4", eyes: "#8898B8", brows: "#6B5D52" },
    desc: "Periwinkle on the lid with silver inner corner, soft rose cheeks, mauve lip. Otherworldly cool."
  },
  {
    title: "The Deep End",
    vibe: "Evening Drama",
    colors: { lips: "#904858", cheeks: "#C89090", eyes: "#5C5A58", brows: "#5C5A58" },
    desc: "Smoky charcoal eye with champagne highlight, deeper rose cheek, raspberry lip. Statement without screaming."
  },
  {
    title: "Sun-Touched",
    vibe: "Warm Accent",
    colors: { lips: "#E8A898", cheeks: "#C9AD7C", eyes: "#D4C8A0", brows: "#8A7D70" },
    desc: "Soft gold lid, bronzed cheeks, coral glaze lip. Your warm secret, amplified."
  },
  {
    title: "Pressed Violets",
    vibe: "Editorial",
    colors: { lips: "#986870", cheeks: "#E8C0BC", eyes: "#786888", brows: "#6B5D52" },
    desc: "Dusty violet lid blended into mauve crease, soft pink cheek, berry mauve lip. Moody and intentional."
  }
];

function init() {
  createParticles();
  renderPigments();
  renderPalette();
  renderLooks();
  renderMakeup();
  renderLightingPreview();
  renderDrift();
  setupTabs();
  setupCompareMode();
  setupMakeupFace();
}

function createParticles() {
  const container = document.getElementById("particles");
  for (let i = 0; i < 20; i++) {
    const p = document.createElement("div");
    p.className = "particle";
    p.style.left = Math.random() * 100 + "%";
    p.style.top = Math.random() * 100 + "%";
    p.style.animationDelay = Math.random() * 8 + "s";
    p.style.animationDuration = (6 + Math.random() * 4) + "s";
    container.appendChild(p);
  }
}

function renderPigments() {
  const container = document.getElementById("pigments");
  sourcePigments.forEach((p, i) => {
    const div = document.createElement("div");
    div.className = "pigment";
    div.style.animationDelay = (i * 0.1) + "s";
    div.innerHTML = `
      <div class="pigment-swatch" style="background: ${p.hex};"></div>
      <div class="pigment-name">${p.name}</div>
      <div class="pigment-desc">${p.desc}</div>
      <div class="pigment-hex">${p.hex}</div>
    `;
    container.appendChild(div);
  });
}

function renderPalette() {
  const container = document.getElementById("palette");
  let swatchIndex = 0;
  
  Object.entries(paletteGroups).forEach(([groupName, colors]) => {
    const section = document.createElement("div");
    section.className = "palette-section";
    section.innerHTML = `<div class="palette-group-title">${groupName}</div>`;
    
    const swatchesDiv = document.createElement("div");
    swatchesDiv.className = "swatches";
    
    colors.forEach(color => {
      const swatch = document.createElement("div");
      swatch.className = "swatch";
      swatch.style.background = color.hex;
      swatch.style.animationDelay = (swatchIndex * 0.03) + "s";
      swatch.dataset.hex = color.hex;
      swatch.dataset.name = color.name;
      swatch.innerHTML = `<span class="swatch-tooltip">${color.name}<br>${color.hex}</span>`;
      
      swatch.addEventListener("click", (e) => {
        if (e.detail === 1) {
          setTimeout(() => {
            if (!swatch.dataset.dblclick) {
              handleSwatchClick(color);
            }
            swatch.dataset.dblclick = "";
          }, 200);
        }
      });
      
      swatch.addEventListener("dblclick", () => {
        swatch.dataset.dblclick = "true";
        toggleFavorite(color, swatch);
      });
      
      allSwatches.push({ element: swatch, color });
      swatchesDiv.appendChild(swatch);
      swatchIndex++;
    });
    
    section.appendChild(swatchesDiv);
    container.appendChild(section);
  });
}

function handleSwatchClick(color) {
  const activeTab = document.querySelector(".tool-tab.active").dataset.tab;
  
  if (activeTab === "compare") {
    addToCompare(color);
  } else if (activeTab === "undertone") {
    analyzeUndertone(color);
  } else {
    copyHex(color.hex);
  }
}

function copyHex(hex) {
  navigator.clipboard.writeText(hex).then(() => {
    showToast(`Copied ${hex}`);
  }).catch(() => {
    showToast(`${hex} (copy manually)`);
  });
}

function showToast(msg) {
  const toast = document.getElementById("toast");
  toast.textContent = msg;
  toast.classList.add("visible");
  setTimeout(() => toast.classList.remove("visible"), 2000);
}

function toggleFavorite(color, element) {
  const idx = favorites.findIndex(f => f.hex === color.hex);
  if (idx > -1) {
    favorites.splice(idx, 1);
    element.classList.remove("favorited");
    showToast(`Removed ${color.name} from favorites`);
  } else {
    favorites.push(color);
    element.classList.add("favorited");
    showToast(`Added ${color.name} to favorites`);
    openFocus(color);
  }
  renderFavorites();
}

function renderFavorites() {
  const container = document.getElementById("favorites-list");
  if (favorites.length === 0) {
    container.innerHTML = '<span class="favorites-empty">No favorites yet</span>';
    return;
  }
  
  container.innerHTML = "";
  favorites.forEach(color => {
    const swatch = document.createElement("div");
    swatch.className = "swatch";
    swatch.style.background = color.hex;
    swatch.style.width = "50px";
    swatch.style.height = "50px";
    swatch.innerHTML = `<span class="swatch-tooltip">${color.name}<br>${color.hex}</span>`;
    swatch.addEventListener("click", () => copyHex(color.hex));
    swatch.addEventListener("dblclick", () => openFocus(color));
    container.appendChild(swatch);
  });
}

function openFocus(color) {
  const mode = document.getElementById("focus-mode");
  document.getElementById("focus-swatch").style.background = color.hex;
  document.getElementById("focus-name").textContent = color.name;
  document.getElementById("focus-hex").textContent = color.hex;
  mode.style.background = color.hex;
  mode.classList.add("active");
}

function closeFocus() {
  document.getElementById("focus-mode").classList.remove("active");
}

function setupTabs() {
  document.querySelectorAll(".tool-tab").forEach(tab => {
    tab.addEventListener("click", () => {
      document.querySelectorAll(".tool-tab").forEach(t => t.classList.remove("active"));
      document.querySelectorAll(".tool-panel").forEach(p => p.classList.remove("active"));
      tab.classList.add("active");
      document.getElementById(tab.dataset.tab + "-panel").classList.add("active");
    });
  });
}

function setupCompareMode() {
  document.querySelectorAll(".light-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".light-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      applyLighting(btn.dataset.light);
    });
  });
}

function addToCompare(color) {
  allSwatches.forEach(s => s.element.classList.remove("comparing"));
  
  if (!compareSlots[0]) {
    compareSlots[0] = color;
    document.getElementById("compare-1").style.background = color.hex;
    document.getElementById("compare-1").classList.add("filled");
    document.getElementById("compare-1").textContent = "";
    document.getElementById("compare-hex-1").textContent = color.name;
  } else if (!compareSlots[1]) {
    compareSlots[1] = color;
    document.getElementById("compare-2").style.background = color.hex;
    document.getElementById("compare-2").classList.add("filled");
    document.getElementById("compare-2").textContent = "";
    document.getElementById("compare-hex-2").textContent = color.name;
    showCompareVerdict();
  } else {
    compareSlots = [color, null];
    document.getElementById("compare-1").style.background = color.hex;
    document.getElementById("compare-1").textContent = "";
    document.getElementById("compare-hex-1").textContent = color.name;
    document.getElementById("compare-2").style.background = "";
    document.getElementById("compare-2").classList.remove("filled");
    document.getElementById("compare-2").textContent = "Select second";
    document.getElementById("compare-hex-2").textContent = "—";
    document.getElementById("compare-verdict").style.display = "none";
  }
  
  allSwatches.forEach(s => {
    if (compareSlots.some(c => c && c.hex === s.color.hex)) {
      s.element.classList.add("comparing");
    }
  });
}

function clearCompare() {
  compareSlots = [null, null];
  document.getElementById("compare-1").style.background = "";
  document.getElementById("compare-1").classList.remove("filled");
  document.getElementById("compare-1").textContent = "Select first";
  document.getElementById("compare-hex-1").textContent = "—";
  document.getElementById("compare-2").style.background = "";
  document.getElementById("compare-2").classList.remove("filled");
  document.getElementById("compare-2").textContent = "Select second";
  document.getElementById("compare-hex-2").textContent = "—";
  document.getElementById("compare-verdict").style.display = "none";
  allSwatches.forEach(s => s.element.classList.remove("comparing"));
}

function showCompareVerdict() {
  const [c1, c2] = compareSlots;
  const verdict = document.getElementById("compare-verdict");
  
  const rgb1 = hexToRgb(c1.hex);
  const rgb2 = hexToRgb(c2.hex);
  const distance = colorDistance(rgb1, rgb2);
  const contrast = getContrast(c1.hex, c2.hex);
  
  let relationship = "";
  if (distance < 50) {
    relationship = "These are tonal neighbors — they blend softly together. Use them in the same color story for subtle variation.";
  } else if (distance < 100) {
    relationship = "These have gentle contrast. Good for outfit combinations where one supports the other.";
  } else if (distance < 150) {
    relationship = "Moderate contrast — they create visual interest without competing. Excellent for intentional pairing.";
  } else {
    relationship = "High contrast pair. Use strategically — one as anchor, one as accent. Creates drama.";
  }
  
  let usage = "";
  const warm1 = isWarm(rgb1);
  const warm2 = isWarm(rgb2);
  if (warm1 === warm2) {
    usage = "Both share similar undertone temperature, making them inherently harmonious.";
  } else {
    usage = "Mixed undertones — this creates dynamic tension. Balance carefully.";
  }
  
  verdict.innerHTML = `<strong>${c1.name}</strong> + <strong>${c2.name}</strong><br><br>${relationship}<br><br>${usage}<br><br>Contrast ratio: ${contrast.toFixed(2)}:1`;
  verdict.style.display = "block";
}

function hexToRgb(hex) {
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result ? {
    r: parseInt(result[1], 16),
    g: parseInt(result[2], 16),
    b: parseInt(result[3], 16)
  } : null;
}

function colorDistance(c1, c2) {
  return Math.sqrt(Math.pow(c1.r - c2.r, 2) + Math.pow(c1.g - c2.g, 2) + Math.pow(c1.b - c2.b, 2));
}

function getLuminance(hex) {
  const rgb = hexToRgb(hex);
  const [r, g, b] = [rgb.r, rgb.g, rgb.b].map(v => {
    v /= 255;
    return v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);
  });
  return 0.2126 * r + 0.7152 * g + 0.0722 * b;
}

function getContrast(hex1, hex2) {
  const l1 = getLuminance(hex1);
  const l2 = getLuminance(hex2);
  const lighter = Math.max(l1, l2);
  const darker = Math.min(l1, l2);
  return (lighter + 0.05) / (darker + 0.05);
}

function isWarm(rgb) {
  return rgb.r > rgb.b;
}

function renderLooks() {
  const container = document.getElementById("looks-grid");
  looks.forEach(look => {
    const card = document.createElement("div");
    card.className = "look-card";
    card.innerHTML = `
      <div class="look-title">${look.title}</div>
      <div class="look-occasion">${look.occasion}</div>
      <div class="look-colors">
        ${look.colors.map(c => `<div class="look-color" style="background: ${c};" title="${c}"></div>`).join("")}
      </div>
      <div class="look-desc">${look.desc}</div>
    `;
    container.appendChild(card);
  });
}

function renderLightingPreview() {
  const container = document.getElementById("lighting-preview");
  const sampleColors = ["#F5F0EB", "#D4A8A4", "#90A890", "#8898B8", "#C08080", "#4A5568"];
  
  sampleColors.forEach(hex => {
    const swatch = document.createElement("div");
    swatch.className = "lighting-swatch";
    swatch.style.background = hex;
    swatch.dataset.original = hex;
    container.appendChild(swatch);
  });
}

function applyLighting(type) {
  const swatches = document.querySelectorAll(".lighting-swatch");
  const adjustments = {
    daylight: { r: 0, g: 0, b: 0 },
    morning: { r: 10, g: 5, b: -15 },
    evening: { r: 25, g: 10, b: -20 },
    candle: { r: 35, g: 15, b: -25 },
    fluorescent: { r: -10, g: 5, b: 15 },
    overcast: { r: -5, g: -5, b: 5 }
  };
  
  const adj = adjustments[type];
  swatches.forEach(swatch => {
    const original = hexToRgb(swatch.dataset.original);
    const adjusted = {
      r: Math.min(255, Math.max(0, original.r + adj.r)),
      g: Math.min(255, Math.max(0, original.g + adj.g)),
      b: Math.min(255, Math.max(0, original.b + adj.b))
    };
    swatch.style.background = `rgb(${adjusted.r}, ${adjusted.g}, ${adjusted.b})`;
  });
}

function generateStory() {
  const allColors = Object.values(paletteGroups).flat();
  const story = [];
  const used = new Set();
  
  while (story.length < 4) {
    const idx = Math.floor(Math.random() * allColors.length);
    if (!used.has(idx)) {
      used.add(idx);
      story.push(allColors[idx]);
    }
  }
  
  const narratives = [
    "A quiet morning where fog meets the first light. Soft layers that breathe.",
    "The garden at dusk, when colors deepen into memory.",
    "Rain on old stone — everything softened, everything still.",
    "A letter written in fading light, sealed with intention.",
    "The space between seasons, where one palette yields to another.",
    "Moonlight through gauze curtains, silver touching rose."
  ];
  
  const narrative = narratives[Math.floor(Math.random() * narratives.length)];
  
  document.getElementById("generated-story").innerHTML = `
    <div class="generated-story">
      <div class="story-colors">
        ${story.map(c => `<div class="story-swatch" style="background: ${c.hex};" title="${c.name}"></div>`).join("")}
      </div>
      <div class="story-narrative">${narrative}</div>
      <div style="margin-top: 12px; font-size: 12px; color: var(--sage-light);">
        ${story.map(c => c.name).join(" / ")}
      </div>
    </div>
  `;
}

function findMatch() {
  const picker = document.getElementById("shopping-picker");
  const inputHex = picker.value.toUpperCase();
  const inputRgb = hexToRgb(inputHex);
  
  let closest = null;
  let closestDist = Infinity;
  
  Object.values(paletteGroups).flat().forEach(color => {
    const rgb = hexToRgb(color.hex);
    const dist = colorDistance(inputRgb, rgb);
    if (dist < closestDist) {
      closestDist = dist;
      closest = color;
    }
  });
  
  let verdict = "";
  if (closestDist < 30) {
    verdict = "Excellent match! This color is effectively in your palette.";
  } else if (closestDist < 60) {
    verdict = "Close match. This would work well in your wardrobe.";
  } else if (closestDist < 100) {
    verdict = "Approximate match. Wearable, but not ideal — consider the closest palette color instead.";
  } else {
    verdict = "This color is outside your palette. The match shown is the nearest option.";
  }
  
  document.getElementById("match-result").innerHTML = `
    <div class="match-result">
      <div class="match-comparison">
        <div class="match-box">
          <div class="match-swatch" style="background: ${inputHex};"></div>
          <div class="match-label">Your find</div>
        </div>
        <div class="match-arrow">→</div>
        <div class="match-box">
          <div class="match-swatch" style="background: ${closest.hex};"></div>
          <div class="match-label">${closest.name}</div>
        </div>
      </div>
      <div style="font-size: 13px;">${verdict}</div>
    </div>
  `;
}

function renderDrift() {
  const container = document.getElementById("drift-visual");
  const coreColors = [
    { hex: "#D4A8A4", name: "Rose" },
    { hex: "#90A890", name: "Sage" },
    { hex: "#8898B8", name: "Periwinkle" },
    { hex: "#C08080", name: "Antique Rose" }
  ];
  
  const warmer = coreColors.map(c => {
    const rgb = hexToRgb(c.hex);
    return rgbToHex(Math.min(255, rgb.r + 15), Math.max(0, rgb.g - 5), Math.max(0, rgb.b - 20));
  });
  
  const cooler = coreColors.map(c => {
    const rgb = hexToRgb(c.hex);
    return rgbToHex(Math.max(0, rgb.r - 15), rgb.g, Math.min(255, rgb.b + 15));
  });
  
  container.innerHTML = `
    <div class="drift-column">
      <div class="drift-label">Cooler (Soft Summer)</div>
      <div class="drift-swatches">
        ${cooler.map(h => `<div class="drift-swatch" style="background: ${h};"></div>`).join("")}
      </div>
    </div>
    <div class="drift-column">
      <div class="drift-label">Your Palette</div>
      <div class="drift-swatches">
        ${coreColors.map(c => `<div class="drift-swatch" style="background: ${c.hex};"></div>`).join("")}
      </div>
    </div>
    <div class="drift-column">
      <div class="drift-label">Warmer (Light Spring)</div>
      <div class="drift-swatches">
        ${warmer.map(h => `<div class="drift-swatch" style="background: ${h};"></div>`).join("")}
      </div>
    </div>
  `;
}

function rgbToHex(r, g, b) {
  return "#" + [r, g, b].map(x => {
    const hex = Math.round(x).toString(16);
    return hex.length === 1 ? "0" + hex : hex;
  }).join("").toUpperCase();
}

function analyzeUndertone(color) {
  const rgb = hexToRgb(color.hex);
  const warmth = (rgb.r - rgb.b + 255) / 510;
  const coolness = 1 - warmth;
  
  document.getElementById("undertone-selected").innerHTML = `
    <div style="display: flex; align-items: center; gap: 12px;">
      <div style="width: 40px; height: 40px; background: ${color.hex}; border: 1px solid rgba(255,255,255,0.2);"></div>
      <div>
        <div style="font-weight: bold;">${color.name}</div>
        <div style="font-size: 12px; color: var(--sage-light);">${color.hex}</div>
      </div>
    </div>
  `;
  
  document.getElementById("ut-cool").style.width = (coolness * 100) + "%";
  document.getElementById("ut-warm").style.width = (warmth * 100) + "%";
  document.getElementById("undertone-bar").style.display = "flex";
  document.getElementById("undertone-labels").style.display = "flex";
}

function exportJSON() {
  const data = { palette: paletteGroups, sourcePigments };
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
  downloadBlob(blob, "twilight-herbarium-palette.json");
}

function exportText() {
  let text = "TWILIGHT HERBARIUM - Light Summer Palette\n\n";
  Object.entries(paletteGroups).forEach(([group, colors]) => {
    text += group.toUpperCase() + "\n";
    colors.forEach(c => {
      text += `  ${c.name}: ${c.hex}\n`;
    });
    text += "\n";
  });
  navigator.clipboard.writeText(text).then(() => showToast("Palette copied to clipboard"));
}

function exportFavoritesJSON() {
  if (favorites.length === 0) {
    showToast("No favorites to export");
    return;
  }
  const blob = new Blob([JSON.stringify(favorites, null, 2)], { type: "application/json" });
  downloadBlob(blob, "twilight-herbarium-favorites.json");
}

function exportFavoritesText() {
  if (favorites.length === 0) {
    showToast("No favorites to export");
    return;
  }
  const text = favorites.map(f => `${f.name}: ${f.hex}`).join("\n");
  navigator.clipboard.writeText(text).then(() => showToast("Favorites copied to clipboard"));
}

function downloadBlob(blob, filename) {
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  a.click();
  URL.revokeObjectURL(url);
}

function renderMakeup() {
  renderMakeupCategory("lip-swatches", makeupColors.lips);
  renderMakeupCategory("cheek-swatches", makeupColors.cheeks);
  renderMakeupCategory("eye-swatches", makeupColors.eyes);
  renderMakeupCategory("brow-swatches", makeupColors.brows);
  renderMakeupLooks();
}

function renderMakeupCategory(containerId, colors) {
  const container = document.getElementById(containerId);
  colors.forEach(color => {
    const swatch = document.createElement("div");
    swatch.className = "makeup-swatch";
    swatch.style.background = color.hex;
    swatch.dataset.hex = color.hex;
    swatch.dataset.name = color.name;
    swatch.innerHTML = `<span class="makeup-swatch-tooltip">${color.name}</span>`;
    swatch.addEventListener("click", () => selectMakeupColor(color, swatch));
    container.appendChild(swatch);
  });
}

function selectMakeupColor(color, element) {
  document.querySelectorAll(".makeup-swatch").forEach(s => s.classList.remove("selected"));
  element.classList.add("selected");
  selectedMakeupColor = color;
  document.getElementById("makeup-selected-swatch").style.background = color.hex;
  document.getElementById("makeup-selected-name").textContent = color.name;
}

function setupMakeupFace() {
  const zones = ["face-eyes", "face-brows", "face-cheeks", "face-lips"];
  zones.forEach(zoneId => {
    const zone = document.getElementById(zoneId);
    zone.addEventListener("click", () => {
      if (selectedMakeupColor) {
        zone.style.background = selectedMakeupColor.hex;
        zone.classList.add("filled");
        zone.dataset.color = selectedMakeupColor.hex;
        zone.dataset.colorName = selectedMakeupColor.name;
      }
    });
  });
}

function clearMakeupFace() {
  const zones = ["face-eyes", "face-brows", "face-cheeks", "face-lips"];
  zones.forEach(zoneId => {
    const zone = document.getElementById(zoneId);
    zone.style.background = "";
    zone.classList.remove("filled");
    zone.dataset.color = "";
    zone.dataset.colorName = "";
  });
  selectedMakeupColor = null;
  document.querySelectorAll(".makeup-swatch").forEach(s => s.classList.remove("selected"));
  document.getElementById("makeup-selected-swatch").style.background = "var(--sage-shadow)";
  document.getElementById("makeup-selected-name").textContent = "None";
}

function randomMakeupLook() {
  const randomLip = makeupColors.lips[Math.floor(Math.random() * makeupColors.lips.length)];
  const randomCheek = makeupColors.cheeks[Math.floor(Math.random() * makeupColors.cheeks.length)];
  const randomEye = makeupColors.eyes[Math.floor(Math.random() * makeupColors.eyes.length)];
  const randomBrow = makeupColors.brows[Math.floor(Math.random() * makeupColors.brows.length)];
  
  document.getElementById("face-lips").style.background = randomLip.hex;
  document.getElementById("face-lips").classList.add("filled");
  document.getElementById("face-cheeks").style.background = randomCheek.hex;
  document.getElementById("face-cheeks").classList.add("filled");
  document.getElementById("face-eyes").style.background = randomEye.hex;
  document.getElementById("face-eyes").classList.add("filled");
  document.getElementById("face-brows").style.background = randomBrow.hex;
  document.getElementById("face-brows").classList.add("filled");
  
  showToast("Random look generated");
}

function renderMakeupLooks() {
  const container = document.getElementById("makeup-looks-grid");
  makeupLooks.forEach(look => {
    const card = document.createElement("div");
    card.className = "makeup-look-card";
    card.innerHTML = `
      <div class="makeup-look-title">${look.title}</div>
      <div class="makeup-look-vibe">${look.vibe}</div>
      <div class="makeup-look-colors">
        <div class="makeup-look-color">
          <div class="makeup-look-swatch" style="background: ${look.colors.eyes};"></div>
          <div class="makeup-look-label">Eyes</div>
        </div>
        <div class="makeup-look-color">
          <div class="makeup-look-swatch" style="background: ${look.colors.cheeks};"></div>
          <div class="makeup-look-label">Cheeks</div>
        </div>
        <div class="makeup-look-color">
          <div class="makeup-look-swatch" style="background: ${look.colors.lips};"></div>
          <div class="makeup-look-label">Lips</div>
        </div>
        <div class="makeup-look-color">
          <div class="makeup-look-swatch" style="background: ${look.colors.brows};"></div>
          <div class="makeup-look-label">Brows</div>
        </div>
      </div>
      <div class="makeup-look-desc">${look.desc}</div>
    `;
    card.addEventListener("click", () => applyMakeupLook(look));
    container.appendChild(card);
  });
}

function applyMakeupLook(look) {
  document.getElementById("face-eyes").style.background = look.colors.eyes;
  document.getElementById("face-eyes").classList.add("filled");
  document.getElementById("face-cheeks").style.background = look.colors.cheeks;
  document.getElementById("face-cheeks").classList.add("filled");
  document.getElementById("face-lips").style.background = look.colors.lips;
  document.getElementById("face-lips").classList.add("filled");
  document.getElementById("face-brows").style.background = look.colors.brows;
  document.getElementById("face-brows").classList.add("filled");
  showToast(`Applied: ${look.title}`);
}

init();
</script>
<script src="../assets/gate.js"></script>
</body>
</html>
