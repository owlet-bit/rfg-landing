<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soft Power - A Personal Color Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --void: #0a0a0c;
            --ink: #12121a;
            --smoke: #1a1a24;
            --ash: #2a2a36;
            --stone: #4a4a58;
            --bone: #e8e4dc;
            --parchment: #f5f2ed;
            --gold: #c9a87c;
            --gold-dim: #8a7a5c;
            --rose: #b89095;
            --sage: #889b82;
            --accent: #7088a0;
            --glow-rose: rgba(184, 144, 149, 0.4);
            --glow-gold: rgba(201, 168, 124, 0.5);
            --glow-sage: rgba(136, 155, 130, 0.4);
            --glow-accent: rgba(112, 136, 160, 0.4);
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px var(--glow-color, var(--glow-rose)), inset 0 0 20px rgba(255,255,255,0.05); }
            50% { box-shadow: 0 0 35px var(--glow-color, var(--glow-rose)), inset 0 0 30px rgba(255,255,255,0.1); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        @keyframes reveal {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes candle-flicker {
            0%, 100% { opacity: 0.8; filter: brightness(1); }
            25% { opacity: 0.85; filter: brightness(1.05); }
            50% { opacity: 0.75; filter: brightness(0.95); }
            75% { opacity: 0.9; filter: brightness(1.02); }
        }

        @keyframes soft-breathe {
            0%, 100% { 
                box-shadow: 0 0 5px rgba(255,255,255,0.1), inset 0 0 10px rgba(255,255,255,0.05);
                filter: brightness(1) saturate(1);
            }
            50% { 
                box-shadow: 0 0 15px rgba(255,255,255,0.2), 0 0 30px rgba(201, 168, 124, 0.15), inset 0 0 15px rgba(255,255,255,0.1);
                filter: brightness(1.08) saturate(1.05);
            }
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        @keyframes drift {
            0% { 
                transform: translateY(0) translateX(0) scale(1); 
                opacity: 0; 
            }
            5% { 
                opacity: 0.8; 
            }
            50% {
                transform: translateY(-50vh) translateX(15px) scale(1.2);
                opacity: 1;
            }
            95% { 
                opacity: 0.8; 
            }
            100% { 
                transform: translateY(-110vh) translateX(30px) scale(0.8); 
                opacity: 0; 
            }
        }

        @keyframes color-shift {
            0%, 100% { filter: hue-rotate(0deg) brightness(1); }
            50% { filter: hue-rotate(5deg) brightness(1.05); }
        }

        @keyframes border-glow {
            0%, 100% { border-color: var(--ash); }
            50% { border-color: var(--gold-dim); }
        }

        @keyframes ambient-pulse {
            0%, 100% { opacity: 0.02; }
            50% { opacity: 0.05; }
        }

        @keyframes star-twinkle {
            0%, 100% { opacity: 0.2; transform: scale(0.8); }
            50% { opacity: 0.8; transform: scale(1); }
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: Georgia, "Times New Roman", serif;
            background: var(--void);
            color: var(--bone);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Ambient glow overlay */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at 50% 0%, rgba(184, 144, 149, 0.03) 0%, transparent 50%),
                        radial-gradient(ellipse at 0% 100%, rgba(136, 155, 130, 0.02) 0%, transparent 40%),
                        radial-gradient(ellipse at 100% 100%, rgba(112, 136, 160, 0.02) 0%, transparent 40%);
            pointer-events: none;
            z-index: 0;
            animation: ambient-pulse 8s ease-in-out infinite;
        }

        /* Floating particles */
        .particle {
            position: fixed;
            bottom: -20px;
            width: 6px;
            height: 6px;
            background: var(--gold);
            border-radius: 50%;
            pointer-events: none;
            z-index: 1;
            animation: drift linear infinite;
            box-shadow: 0 0 15px var(--glow-gold), 0 0 30px var(--glow-gold);
        }

        .particle:nth-child(1) { left: 10%; animation-duration: 20s; animation-delay: 0s; }
        .particle:nth-child(2) { left: 20%; animation-duration: 25s; animation-delay: 2s; width: 4px; height: 4px; }
        .particle:nth-child(3) { left: 35%; animation-duration: 22s; animation-delay: 1s; width: 5px; height: 5px; }
        .particle:nth-child(4) { left: 50%; animation-duration: 28s; animation-delay: 3s; width: 3px; height: 3px; }
        .particle:nth-child(5) { left: 65%; animation-duration: 21s; animation-delay: 0.5s; }
        .particle:nth-child(6) { left: 80%; animation-duration: 24s; animation-delay: 4s; width: 4px; height: 4px; }
        .particle:nth-child(7) { left: 90%; animation-duration: 23s; animation-delay: 2s; width: 5px; height: 5px; }
        .particle:nth-child(8) { left: 5%; animation-duration: 26s; animation-delay: 1.5s; width: 4px; height: 4px; background: var(--rose); box-shadow: 0 0 15px var(--glow-rose), 0 0 30px var(--glow-rose); }
        .particle:nth-child(9) { left: 45%; animation-duration: 19s; animation-delay: 0s; background: var(--sage); box-shadow: 0 0 15px var(--glow-sage), 0 0 30px var(--glow-sage); }
        .particle:nth-child(10) { left: 75%; animation-duration: 27s; animation-delay: 3.5s; background: var(--accent); box-shadow: 0 0 15px var(--glow-accent), 0 0 30px var(--glow-accent); }
        .particle:nth-child(11) { left: 15%; animation-duration: 24s; animation-delay: 5s; background: var(--rose); box-shadow: 0 0 15px var(--glow-rose); width: 5px; height: 5px; }
        .particle:nth-child(12) { left: 55%; animation-duration: 21s; animation-delay: 2.5s; background: var(--sage); box-shadow: 0 0 15px var(--glow-sage); width: 4px; height: 4px; }
        .particle:nth-child(13) { left: 85%; animation-duration: 26s; animation-delay: 1s; width: 5px; height: 5px; }
        .particle:nth-child(14) { left: 30%; animation-duration: 23s; animation-delay: 4.5s; background: var(--accent); box-shadow: 0 0 15px var(--glow-accent); }
        .particle:nth-child(15) { left: 70%; animation-duration: 20s; animation-delay: 0.5s; width: 4px; height: 4px; }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bone);
            color: var(--void);
            padding: 14px 28px;
            font-size: 13px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            font-family: system-ui, -apple-system, sans-serif;
            letter-spacing: 0.5px;
            border: 1px solid var(--gold-dim);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Navigation */
        nav {
            position: sticky;
            top: 0;
            background: linear-gradient(180deg, var(--void) 0%, var(--void) 80%, transparent 100%);
            z-index: 100;
            padding: 0 20px 20px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border-bottom: 1px solid var(--ash);
        }

        nav::-webkit-scrollbar {
            display: none;
        }

        nav ul {
            display: flex;
            gap: 4px;
            list-style: none;
            padding: 16px 0 0;
            min-width: max-content;
        }

        nav a {
            display: block;
            padding: 10px 14px;
            color: var(--stone);
            text-decoration: none;
            font-size: 11px;
            font-family: system-ui, -apple-system, sans-serif;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            transition: all 0.3s ease;
            white-space: nowrap;
            border-bottom: 1px solid transparent;
        }

        nav a:hover {
            color: var(--bone);
        }

        nav a.active {
            color: var(--gold);
            border-bottom-color: var(--gold);
        }

        /* Header */
        header {
            padding: 80px 24px 60px;
            text-align: center;
            max-width: 700px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .title-pre {
            font-size: 10px;
            letter-spacing: 4px;
            text-transform: uppercase;
            color: var(--stone);
            margin-bottom: 16px;
            font-family: system-ui, -apple-system, sans-serif;
        }

        h1 {
            font-size: clamp(3rem, 10vw, 5rem);
            font-weight: 400;
            font-style: italic;
            letter-spacing: 2px;
            margin-bottom: 16px;
            color: var(--parchment);
            text-shadow: 0 0 60px var(--glow-rose);
            animation: candle-flicker 4s ease-in-out infinite;
        }

        .subtitle {
            font-size: 13px;
            color: var(--gold-dim);
            letter-spacing: 2px;
            text-transform: uppercase;
            font-family: system-ui, -apple-system, sans-serif;
        }

        /* Decorative line */
        .ornament {
            width: 60px;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--gold-dim), transparent);
            margin: 32px auto;
            position: relative;
        }

        .ornament::after {
            content: "";
            position: absolute;
            top: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background: var(--gold);
            border-radius: 50%;
            animation: sparkle 3s ease-in-out infinite;
            box-shadow: 0 0 10px var(--glow-gold);
        }

        /* Sections */
        section {
            padding: 60px 24px 80px;
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
            border-bottom: 1px solid var(--ash);
        }

        h2 {
            font-size: 11px;
            font-weight: 400;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: var(--gold-dim);
            margin-bottom: 32px;
            font-family: system-ui, -apple-system, sans-serif;
            display: flex;
            align-items: center;
            gap: 16px;
            position: relative;
        }

        h2::before {
            content: "";
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--ash) 20%, var(--ash) 80%, transparent);
            animation: line-pulse-left 5s ease-in-out infinite;
        }

        h2::after {
            content: "";
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--ash) 20%, var(--ash) 80%, transparent);
            animation: line-pulse-right 5s ease-in-out infinite;
            animation-delay: 2.5s;
        }

        @keyframes line-pulse-left {
            0%, 100% { 
                background: linear-gradient(90deg, transparent, var(--ash) 20%, var(--ash) 80%, transparent);
            }
            50% { 
                background: linear-gradient(90deg, transparent, var(--gold-dim) 20%, var(--gold) 50%, var(--gold-dim) 80%, transparent);
            }
        }

        @keyframes line-pulse-right {
            0%, 100% { 
                background: linear-gradient(90deg, transparent, var(--ash) 20%, var(--ash) 80%, transparent);
            }
            50% { 
                background: linear-gradient(90deg, transparent, var(--gold-dim) 20%, var(--gold) 50%, var(--gold-dim) 80%, transparent);
            }
        }

        h3 {
            font-size: 1.4rem;
            font-weight: 400;
            font-style: italic;
            margin-bottom: 16px;
            color: var(--parchment);
        }

        p {
            margin-bottom: 16px;
            font-size: 1rem;
            color: var(--bone);
        }

        p.dim {
            font-size: 13px;
            color: var(--stone);
        }

        /* Analysis Text */
        .analysis-text {
            max-width: 580px;
            margin: 0 auto;
            text-align: justify;
        }

        .analysis-text p {
            text-indent: 2em;
            margin-bottom: 1.5em;
        }

        .analysis-text p:first-child {
            text-indent: 0;
        }

        .analysis-text p:first-child::first-letter {
            font-size: 4em;
            float: left;
            line-height: 0.75;
            margin-right: 10px;
            margin-top: 6px;
            color: var(--gold);
            text-shadow: 0 0 30px var(--glow-gold);
        }

        .season-badge {
            display: inline-block;
            padding: 14px 32px;
            background: transparent;
            color: var(--gold);
            font-family: system-ui, -apple-system, sans-serif;
            font-size: 11px;
            letter-spacing: 3px;
            text-transform: uppercase;
            border: 1px solid var(--gold-dim);
            margin: 32px 0;
            position: relative;
            overflow: hidden;
            animation: border-glow 4s ease-in-out infinite;
        }

        .season-badge::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, var(--glow-gold), transparent);
            animation: shimmer-slide 3s ease-in-out infinite;
        }

        @keyframes shimmer-slide {
            0% { left: -100%; }
            50%, 100% { left: 100%; }
        }

        .season-note {
            font-style: italic;
            font-size: 14px;
            color: var(--stone);
            padding-left: 24px;
            border-left: 1px solid var(--gold-dim);
            max-width: 500px;
            margin: 0 auto;
        }

        /* Pigments */
        .pigment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 16px;
        }

        .pigment {
            background: var(--ink);
            border: 1px solid var(--ash);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            animation: border-glow 6s ease-in-out infinite;
        }

        .pigment:nth-child(2n) { animation-delay: 1s; }
        .pigment:nth-child(3n) { animation-delay: 2s; }
        .pigment:nth-child(4n) { animation-delay: 0.5s; }

        .pigment:hover {
            border-color: var(--gold-dim);
            transform: translateY(-2px);
        }

        .pigment:hover .pigment-swatch {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .pigment-swatch {
            height: 90px;
            position: relative;
            transition: all 0.4s ease;
            animation: pigment-glow 5s ease-in-out infinite;
        }

        @keyframes pigment-glow {
            0%, 100% { 
                box-shadow: inset 0 0 20px rgba(255,255,255,0.05);
            }
            50% { 
                box-shadow: inset 0 0 30px rgba(255,255,255,0.15), 0 0 20px rgba(201, 168, 124, 0.2);
            }
        }

        .pigment:nth-child(2n) .pigment-swatch { animation-delay: 1.5s; }
        .pigment:nth-child(3n) .pigment-swatch { animation-delay: 0.8s; }
        .pigment:nth-child(4n) .pigment-swatch { animation-delay: 2.2s; }

        .pigment-info {
            padding: 14px;
            background: var(--ink);
        }

        .pigment-name {
            font-size: 12px;
            font-style: italic;
            margin-bottom: 4px;
            color: var(--parchment);
        }

        .pigment-hex {
            font-size: 11px;
            color: var(--stone);
            font-family: ui-monospace, monospace;
            letter-spacing: 1px;
        }

        /* Palette */
        .palette-group {
            margin-bottom: 48px;
        }

        .palette-group-title {
            font-size: 11px;
            color: var(--stone);
            margin-bottom: 16px;
            font-family: system-ui, -apple-system, sans-serif;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .palette-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(52px, 1fr));
            gap: 10px;
        }

        .swatch {
            aspect-ratio: 1;
            cursor: pointer;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 48px;
            border: 1px solid rgba(255,255,255,0.05);
            animation: soft-breathe 4s ease-in-out infinite;
            animation-delay: calc(var(--i, 0) * 0.1s);
        }

        .swatch::before {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at center, rgba(255,255,255,0.15) 0%, transparent 70%);
            opacity: 0;
            animation: swatch-glow 4s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes swatch-glow {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        .swatch:nth-child(3n)::before { animation-delay: 0.5s; }
        .swatch:nth-child(3n+1)::before { animation-delay: 1s; }
        .swatch:nth-child(3n+2)::before { animation-delay: 1.5s; }
        
        .swatch:nth-child(3n) { animation-delay: 0.5s; }
        .swatch:nth-child(3n+1) { animation-delay: 1s; }
        .swatch:nth-child(3n+2) { animation-delay: 1.5s; }
        .swatch:nth-child(5n) { animation-duration: 5s; }
        .swatch:nth-child(7n) { animation-duration: 3.5s; }

        .swatch:hover {
            transform: scale(1.12) translateY(-2px);
            z-index: 10;
            animation: pulse-glow 1.5s ease-in-out infinite;
            border-color: rgba(255,255,255,0.2);
        }

        .swatch:active {
            transform: scale(0.95);
        }

        .swatch.favorite::after {
            content: "";
            position: absolute;
            top: 4px;
            right: 4px;
            width: 8px;
            height: 8px;
            background: var(--gold);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--glow-gold);
            animation: sparkle 2s ease-in-out infinite;
        }

        .swatch.favorite::before {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, transparent 40%, rgba(255,255,255,0.1) 50%, transparent 60%);
            animation: shimmer 3s ease-in-out infinite;
        }

        .swatch.selected {
            outline: 2px solid var(--gold);
            outline-offset: 3px;
        }

        .swatch-tooltip {
            position: absolute;
            bottom: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--ink);
            color: var(--bone);
            padding: 10px 14px;
            font-size: 12px;
            font-family: Georgia, serif;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            border: 1px solid var(--ash);
            text-align: center;
            line-height: 1.4;
        }

        .swatch:hover .swatch-tooltip {
            opacity: 1;
        }

        /* Favorites */
        .favorites-empty {
            text-align: center;
            padding: 60px 24px;
            border: 1px dashed var(--ash);
        }

        .favorites-empty p {
            color: var(--stone);
            font-size: 14px;
            font-style: italic;
            margin: 0;
        }

        .favorites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 16px;
        }

        .favorite-card {
            background: var(--ink);
            border: 1px solid var(--ash);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .favorite-card:hover {
            border-color: var(--gold-dim);
        }

        .favorite-swatch {
            height: 70px;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: favorite-glow 3s ease-in-out infinite;
        }

        @keyframes favorite-glow {
            0%, 100% { 
                box-shadow: inset 0 0 15px rgba(255,255,255,0.05);
            }
            50% { 
                box-shadow: inset 0 0 25px rgba(255,255,255,0.15), 0 0 15px rgba(201, 168, 124, 0.25);
            }
        }

        .favorite-swatch:hover {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .favorite-info {
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .favorite-hex {
            font-size: 10px;
            font-family: ui-monospace, monospace;
            color: var(--stone);
            letter-spacing: 0.5px;
        }

        .favorite-remove {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            cursor: pointer;
            color: var(--stone);
            font-size: 16px;
            line-height: 1;
            transition: color 0.2s ease;
        }

        .favorite-remove:hover {
            color: var(--rose);
        }

        /* Compare */
        .compare-area {
            display: flex;
            gap: 20px;
            margin-bottom: 32px;
        }

        .compare-slot {
            flex: 1;
            aspect-ratio: 4/3;
            background: var(--ink);
            border: 1px dashed var(--ash);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: var(--stone);
            font-family: system-ui, -apple-system, sans-serif;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .compare-slot.filled {
            border: 1px solid var(--ash);
            animation: pulse-glow 3s ease-in-out infinite;
        }

        .compare-slot.filled span {
            position: absolute;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--void);
            padding: 6px 12px;
            font-size: 11px;
            font-family: ui-monospace, monospace;
            border: 1px solid var(--ash);
        }

        .compare-verdict {
            background: var(--ink);
            padding: 28px;
            border: 1px solid var(--ash);
            min-height: 120px;
        }

        .compare-verdict h4 {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--gold-dim);
            margin-bottom: 12px;
            font-family: system-ui, -apple-system, sans-serif;
            font-weight: 400;
        }

        .compare-verdict p {
            margin: 0;
            font-size: 14px;
            line-height: 1.7;
        }

        .compare-clear {
            margin-top: 20px;
            padding: 12px 24px;
            background: transparent;
            border: 1px solid var(--ash);
            font-size: 11px;
            font-family: system-ui, -apple-system, sans-serif;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--stone);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .compare-clear:hover {
            border-color: var(--gold-dim);
            color: var(--gold);
        }

        /* Looks */
        .looks-carousel {
            display: flex;
            gap: 24px;
            overflow-x: auto;
            padding: 8px 0 32px;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
        }

        /* Metals */
        .metals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 16px;
        }

        .metal-card {
            background: var(--ink);
            border: 1px solid var(--ash);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .metal-card:hover {
            border-color: var(--gold-dim);
        }

        .metal-swatch {
            height: 80px;
            position: relative;
            animation: metal-shine 4s ease-in-out infinite;
        }

        @keyframes metal-shine {
            0%, 100% { 
                filter: brightness(1);
            }
            50% { 
                filter: brightness(1.2);
            }
        }

        .metal-card:nth-child(2) .metal-swatch { animation-delay: 0.5s; }
        .metal-card:nth-child(3) .metal-swatch { animation-delay: 1s; }
        .metal-card:nth-child(4) .metal-swatch { animation-delay: 1.5s; }
        .metal-card:nth-child(5) .metal-swatch { animation-delay: 2s; }

        .metal-info {
            padding: 14px;
        }

        .metal-name {
            font-size: 13px;
            font-style: italic;
            color: var(--parchment);
            margin-bottom: 4px;
        }

        .metal-rating {
            font-size: 10px;
            font-family: system-ui, -apple-system, sans-serif;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .metal-rating.perfect { color: var(--sage); }
        .metal-rating.good { color: var(--gold); }
        .metal-rating.conditional { color: var(--accent); }
        .metal-rating.avoid { color: var(--rose); }

        /* Makeup */
        .makeup-container {
            display: flex;
            flex-direction: column;
            gap: 40px;
        }

        .makeup-category {
            background: var(--ink);
            border: 1px solid var(--ash);
            padding: 24px;
        }

        .makeup-category-title {
            font-size: 11px;
            font-family: system-ui, -apple-system, sans-serif;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--gold-dim);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--ash);
        }

        .makeup-items {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .makeup-item {
            display: flex;
            gap: 16px;
            align-items: flex-start;
            cursor: pointer;
            padding: 12px;
            margin: -12px;
            transition: background 0.2s ease;
        }

        .makeup-item:hover {
            background: rgba(255,255,255,0.02);
        }

        .makeup-swatch {
            width: 50px;
            height: 50px;
            flex-shrink: 0;
            animation: soft-breathe 4s ease-in-out infinite;
        }

        .makeup-item:nth-child(2) .makeup-swatch { animation-delay: 0.3s; }
        .makeup-item:nth-child(3) .makeup-swatch { animation-delay: 0.6s; }
        .makeup-item:nth-child(4) .makeup-swatch { animation-delay: 0.9s; }

        .makeup-text {
            flex: 1;
        }

        .makeup-name {
            font-size: 14px;
            font-style: italic;
            color: var(--parchment);
            margin-bottom: 4px;
        }

        .makeup-desc {
            font-size: 13px;
            color: var(--stone);
            line-height: 1.5;
        }

        .makeup-no-swatch {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .makeup-no-swatch .makeup-item {
            flex-direction: column;
            gap: 8px;
        }

        .looks-carousel::-webkit-scrollbar {
            height: 4px;
        }

        .looks-carousel::-webkit-scrollbar-track {
            background: var(--ash);
        }

        .looks-carousel::-webkit-scrollbar-thumb {
            background: var(--gold-dim);
        }

        .look-card {
            flex: 0 0 300px;
            background: var(--ink);
            border: 1px solid var(--ash);
            overflow: hidden;
            scroll-snap-align: start;
            transition: all 0.3s ease;
        }

        .look-card:hover {
            border-color: var(--gold-dim);
        }

        .look-swatches {
            display: flex;
            height: 100px;
        }

        .look-swatches > div {
            flex: 1;
            transition: all 0.3s ease;
            animation: soft-breathe 4s ease-in-out infinite;
        }

        .look-swatches > div:nth-child(1) { animation-delay: 0s; }
        .look-swatches > div:nth-child(2) { animation-delay: 0.3s; }
        .look-swatches > div:nth-child(3) { animation-delay: 0.6s; }
        .look-swatches > div:nth-child(4) { animation-delay: 0.9s; }
        .look-swatches > div:nth-child(5) { animation-delay: 1.2s; }

        .look-card:hover .look-swatches > div {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .look-content {
            padding: 24px;
        }

        .look-title {
            font-size: 1.2rem;
            font-style: italic;
            margin-bottom: 12px;
            color: var(--parchment);
        }

        .look-desc {
            font-size: 13px;
            color: var(--stone);
            margin: 0;
            line-height: 1.6;
        }

        /* Mood Translation */
        .mood-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 32px;
        }

        .mood-btn {
            padding: 16px;
            background: var(--ink);
            border: 1px solid var(--ash);
            color: var(--stone);
            font-family: Georgia, serif;
            font-size: 13px;
            font-style: italic;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .mood-btn:hover, .mood-btn.active {
            border-color: var(--gold-dim);
            color: var(--gold);
        }

        .mood-result {
            background: var(--ink);
            border: 1px solid var(--ash);
            padding: 28px;
            display: none;
        }

        .mood-result.show {
            display: block;
            animation: reveal 0.4s ease forwards;
        }

        .mood-colors {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .mood-swatch {
            width: 50px;
            height: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: soft-breathe 4s ease-in-out infinite;
        }

        .mood-swatch:nth-child(2) { animation-delay: 0.3s; }
        .mood-swatch:nth-child(3) { animation-delay: 0.6s; }
        .mood-swatch:nth-child(4) { animation-delay: 0.9s; }
        .mood-swatch:nth-child(5) { animation-delay: 1.2s; }

        .mood-swatch:hover {
            animation: pulse-glow 1.5s ease-in-out infinite;
            transform: scale(1.1);
        }

        /* Distance Zones */
        .zone-diagram {
            display: flex;
            flex-direction: column;
            gap: 24px;
            margin-bottom: 32px;
        }

        .zone {
            background: var(--ink);
            border: 1px solid var(--ash);
            padding: 20px;
        }

        .zone-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .zone-name {
            font-size: 12px;
            color: var(--gold-dim);
            font-family: system-ui, -apple-system, sans-serif;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .zone-note {
            font-size: 11px;
            color: var(--stone);
            font-style: italic;
        }

        .zone-colors {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .zone-swatch {
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: soft-breathe 4s ease-in-out infinite;
        }

        .zone-swatch:nth-child(2n) { animation-delay: 0.5s; }
        .zone-swatch:nth-child(3n) { animation-delay: 1s; }

        .zone-swatch:hover {
            animation: pulse-glow 1.5s ease-in-out infinite;
            transform: scale(1.15);
        }

        /* Confidante */
        .confidante-input {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .confidante-input input {
            flex: 1;
            padding: 16px 20px;
            border: 1px solid var(--ash);
            background: var(--ink);
            font-size: 14px;
            font-family: ui-monospace, monospace;
            color: var(--bone);
            letter-spacing: 1px;
        }

        .confidante-input input::placeholder {
            color: var(--stone);
        }

        .confidante-input input:focus {
            outline: none;
            border-color: var(--gold-dim);
        }

        .confidante-input button {
            padding: 16px 28px;
            background: var(--gold-dim);
            color: var(--void);
            border: none;
            font-size: 11px;
            letter-spacing: 2px;
            text-transform: uppercase;
            cursor: pointer;
            font-family: system-ui, -apple-system, sans-serif;
            transition: all 0.2s ease;
        }

        .confidante-input button:hover {
            background: var(--gold);
        }

        .confidante-result {
            background: var(--ink);
            padding: 28px;
            border: 1px solid var(--ash);
            display: none;
        }

        .confidante-result.show {
            display: block;
            animation: reveal 0.4s ease forwards;
        }

        .confidante-swatches {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-bottom: 20px;
        }

        .confidante-swatch {
            width: 70px;
            height: 70px;
            transition: all 0.3s ease;
            animation: soft-breathe 3s ease-in-out infinite;
        }

        .confidante-swatch:hover {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .confidante-arrow {
            color: var(--stone);
            font-size: 24px;
        }

        .confidante-verdict-tag {
            display: inline-block;
            padding: 8px 16px;
            font-size: 10px;
            font-family: system-ui, -apple-system, sans-serif;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 16px;
            border: 1px solid;
        }

        .confidante-verdict-tag.yes {
            border-color: var(--sage);
            color: var(--sage);
        }

        .confidante-verdict-tag.stretch {
            border-color: var(--gold);
            color: var(--gold);
        }

        .confidante-verdict-tag.no {
            border-color: var(--rose);
            color: var(--rose);
        }

        /* Capsule */
        .capsule-generate {
            text-align: center;
            margin-bottom: 32px;
        }

        .capsule-btn {
            padding: 18px 40px;
            background: transparent;
            border: 1px solid var(--gold-dim);
            color: var(--gold);
            font-size: 11px;
            letter-spacing: 3px;
            text-transform: uppercase;
            cursor: pointer;
            font-family: system-ui, -apple-system, sans-serif;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .capsule-btn::before {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, transparent, var(--glow-gold), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .capsule-btn:hover::before {
            opacity: 0.3;
            animation: shimmer 2s ease-in-out infinite;
        }

        .capsule-btn:hover {
            background: var(--gold-dim);
            color: var(--void);
        }

        .capsule-result {
            background: var(--ink);
            border: 1px solid var(--ash);
            overflow: hidden;
            display: none;
        }

        .capsule-result.show {
            display: block;
            animation: reveal 0.5s ease forwards;
        }

        .capsule-header {
            padding: 32px;
            text-align: center;
            border-bottom: 1px solid var(--ash);
        }

        .capsule-name {
            font-size: 1.8rem;
            font-style: italic;
            margin-bottom: 8px;
            color: var(--parchment);
        }

        .capsule-desc {
            font-size: 13px;
            color: var(--stone);
            margin: 0;
            font-style: italic;
        }

        .capsule-colors {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
        }

        .capsule-color {
            aspect-ratio: 1;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: soft-breathe 4s ease-in-out infinite;
        }

        .capsule-color:nth-child(2) { animation-delay: 0.3s; }
        .capsule-color:nth-child(3) { animation-delay: 0.6s; }
        .capsule-color:nth-child(4) { animation-delay: 0.9s; }
        .capsule-color:nth-child(5) { animation-delay: 1.2s; }
        .capsule-color:nth-child(6) { animation-delay: 1.5s; }
        .capsule-color:nth-child(7) { animation-delay: 1.8s; }
        .capsule-color:nth-child(8) { animation-delay: 2.1s; }

        .capsule-color:hover {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .capsule-color span {
            background: var(--void);
            padding: 4px 10px;
            font-size: 10px;
            font-family: ui-monospace, monospace;
            border: 1px solid var(--ash);
        }

        /* Permission Palette */
        .permission-intro {
            text-align: center;
            max-width: 500px;
            margin: 0 auto 32px;
        }

        .permission-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 16px;
        }

        .permission-card {
            background: var(--ink);
            border: 1px solid var(--ash);
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .permission-card:hover {
            border-color: var(--gold-dim);
        }

        .permission-card.owned {
            border-color: var(--sage);
        }

        .permission-card.seeking {
            border-color: var(--rose);
        }

        .permission-swatch {
            width: 100%;
            aspect-ratio: 1;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            animation: soft-breathe 4s ease-in-out infinite;
        }

        .permission-card:hover .permission-swatch {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .permission-status {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: system-ui, -apple-system, sans-serif;
        }

        .permission-card.owned .permission-status {
            color: var(--sage);
        }

        .permission-card.seeking .permission-status {
            color: var(--rose);
        }

        /* Silence Mode */
        .silence-btn {
            display: block;
            width: 100%;
            padding: 20px;
            background: var(--ink);
            border: 1px solid var(--ash);
            color: var(--stone);
            font-family: Georgia, serif;
            font-size: 14px;
            font-style: italic;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            margin-bottom: 24px;
        }

        .silence-btn:hover {
            border-color: var(--gold-dim);
            color: var(--gold);
        }

        .silence-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 8px;
            display: none;
        }

        .silence-grid.show {
            display: grid;
            animation: reveal 0.6s ease forwards;
        }

        .silence-swatch {
            aspect-ratio: 1;
            transition: all 0.4s ease;
            animation: soft-breathe 5s ease-in-out infinite;
        }

        .silence-swatch:nth-child(4n) { animation-delay: 0.5s; }
        .silence-swatch:nth-child(4n+1) { animation-delay: 1s; }
        .silence-swatch:nth-child(4n+2) { animation-delay: 1.5s; }
        .silence-swatch:nth-child(4n+3) { animation-delay: 2s; }

        .silence-swatch:hover {
            animation: pulse-glow 2s ease-in-out infinite;
            transform: scale(1.1);
        }

        /* Export */
        .export-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 24px;
        }

        .export-btn {
            padding: 14px 24px;
            background: var(--gold-dim);
            color: var(--void);
            border: none;
            font-size: 11px;
            font-family: system-ui, -apple-system, sans-serif;
            letter-spacing: 1px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 48px;
        }

        .export-btn:hover {
            background: var(--gold);
        }

        .export-btn.secondary {
            background: transparent;
            color: var(--stone);
            border: 1px solid var(--ash);
        }

        .export-btn.secondary:hover {
            border-color: var(--gold-dim);
            color: var(--gold);
        }

        .export-preview {
            background: var(--ink);
            color: var(--stone);
            padding: 24px;
            border: 1px solid var(--ash);
            font-family: ui-monospace, monospace;
            font-size: 11px;
            max-height: 300px;
            overflow: auto;
            white-space: pre-wrap;
            word-break: break-all;
            display: none;
        }

        .export-preview.show {
            display: block;
        }

        /* Whisper Mode */
        .whisper-trigger {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            background: var(--ink);
            border: 1px solid var(--gold-dim);
            cursor: pointer;
            color: var(--gold);
            font-size: 24px;
            z-index: 50;
            transition: all 0.3s ease;
            animation: soft-breathe 3s ease-in-out infinite;
            --glow-color: var(--glow-gold);
        }

        .whisper-trigger:hover {
            background: var(--gold-dim);
            color: var(--void);
            animation: pulse-glow 2s ease-in-out infinite;
            --glow-color: var(--glow-gold);
        }

        .whisper-mode {
            position: fixed;
            inset: 0;
            background: var(--void);
            z-index: 200;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }

        .whisper-mode.active {
            display: flex;
        }

        .whisper-swatch {
            width: min(320px, 80vw);
            aspect-ratio: 1;
            margin-bottom: 40px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            animation: pulse-glow 3s ease-in-out infinite, float 4s ease-in-out infinite;
        }

        .whisper-info {
            text-align: center;
        }

        .whisper-hex {
            font-family: ui-monospace, monospace;
            font-size: 1.8rem;
            margin-bottom: 8px;
            color: var(--parchment);
            letter-spacing: 2px;
        }

        .whisper-group {
            font-size: 12px;
            color: var(--stone);
            letter-spacing: 2px;
            text-transform: uppercase;
            font-family: system-ui, -apple-system, sans-serif;
        }

        .whisper-nav {
            display: flex;
            gap: 20px;
            margin-top: 40px;
        }

        .whisper-nav button {
            width: 56px;
            height: 56px;
            border: 1px solid var(--ash);
            background: transparent;
            cursor: pointer;
            font-size: 20px;
            color: var(--stone);
            transition: all 0.2s ease;
        }

        .whisper-nav button:hover {
            border-color: var(--gold-dim);
            color: var(--gold);
        }

        .whisper-close {
            position: absolute;
            top: 24px;
            right: 24px;
            width: 48px;
            height: 48px;
            border: 1px solid var(--ash);
            background: transparent;
            cursor: pointer;
            font-size: 20px;
            color: var(--stone);
            transition: all 0.2s ease;
        }

        .whisper-close:hover {
            border-color: var(--gold-dim);
            color: var(--gold);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 60px 24px;
            color: var(--stone);
            font-size: 11px;
            font-family: system-ui, -apple-system, sans-serif;
            letter-spacing: 1px;
            border-top: 1px solid var(--ash);
        }

        /* Color Detail Panel */
        .color-detail {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--ink);
            border-top: 1px solid var(--gold-dim);
            padding: 24px;
            z-index: 150;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 50vh;
            overflow-y: auto;
        }

        .color-detail.show {
            transform: translateY(0);
        }

        .color-detail-inner {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            gap: 24px;
            align-items: flex-start;
        }

        .color-detail-swatch {
            width: 100px;
            height: 100px;
            flex-shrink: 0;
            animation: soft-breathe 3s ease-in-out infinite;
        }

        .color-detail-info {
            flex: 1;
        }

        .color-detail-name {
            font-size: 1.4rem;
            font-style: italic;
            color: var(--parchment);
            margin-bottom: 4px;
        }

        .color-detail-hex {
            font-family: ui-monospace, monospace;
            font-size: 12px;
            color: var(--gold);
            letter-spacing: 1px;
            margin-bottom: 16px;
        }

        .color-detail-desc {
            font-size: 14px;
            line-height: 1.7;
            color: var(--bone);
            margin: 0;
        }

        .color-detail-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 40px;
            height: 40px;
            background: transparent;
            border: 1px solid var(--ash);
            color: var(--stone);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .color-detail-close:hover {
            border-color: var(--gold-dim);
            color: var(--gold);
        }

        .color-detail-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .color-detail-btn {
            padding: 10px 16px;
            background: transparent;
            border: 1px solid var(--ash);
            color: var(--stone);
            font-size: 11px;
            font-family: system-ui, -apple-system, sans-serif;
            letter-spacing: 1px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .color-detail-btn:hover {
            border-color: var(--gold-dim);
            color: var(--gold);
        }

        @media (max-width: 480px) {
            .color-detail-inner {
                flex-direction: column;
            }
            
            .color-detail-swatch {
                width: 100%;
                height: 80px;
            }
        }

        /* Mobile */
        @media (max-width: 480px) {
            section {
                padding: 48px 16px 64px;
            }

            .palette-grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 6px;
            }

            .look-card {
                flex: 0 0 280px;
            }

            .compare-area {
                flex-direction: column;
            }

            .compare-slot {
                aspect-ratio: 16/9;
            }

            .mood-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    
    <div class="toast" id="toast"></div>

    <nav>
        <ul>
            <li><a href="#analysis" class="active">Analysis</a></li>
            <li><a href="#pigments">Pigments</a></li>
            <li><a href="#palette">Palette</a></li>
            <li><a href="#favorites">Favorites</a></li>
            <li><a href="#compare">Compare</a></li>
            <li><a href="#looks">Looks</a></li>
            <li><a href="#metals">Metals</a></li>
            <li><a href="#makeup">Makeup</a></li>
            <li><a href="#moods">Moods</a></li>
            <li><a href="#zones">Zones</a></li>
            <li><a href="#confidante">Confidante</a></li>
            <li><a href="#capsule">Capsule</a></li>
            <li><a href="#permission">Permission</a></li>
            <li><a href="#silence">Silence</a></li>
            <li><a href="#export">Export</a></li>
        </ul>
    </nav>

    <header>
        <p class="title-pre">A Personal Color Analysis</p>
        <h1>Soft Power</h1>
        <p class="subtitle">Soft Summer - Cool-Neutral Undertone</p>
        <div class="ornament"></div>
    </header>

    <section id="analysis">
        <h2>The Analysis</h2>
        <div class="analysis-text">
            <p>Your coloring speaks in whispers. A pale porcelain canvas with the faintest blush of cool pink beneath, like the inside of a seashell held to morning light. High translucency reveals the body's hidden waterways; blue-violet veins trace delicate maps beneath the surface. Scattered across the nose and cheeks, golden freckles appear like tiny sun-kisses that forgot to ask permission - warm visitors on cool terrain. The eyes are where complexity lives: a soft gray-green, the color of sage leaves in fog, of lichen on old stone, with a starburst of amber ringing the pupil like a secret kept at the center.</p>
            <p>Everything about your natural coloring is softened, as if seen through gauze or remembered from a dream. The eyes are complex rather than clear. The skin is delicate rather than bright. High chroma would overwhelm this coloring like a shout in a quiet room. The distance between lightest and darkest is short - skin, hair, eyes sit close together on the value scale, blending rather than striking. There is no drama here, only harmony.</p>
            <p>You belong to the muted seasons, where colors are complex and edges are soft. The cool undertone places you in the Summer family; the pervasive dustiness makes it Soft Summer specifically. This is not the clarity of True Summer or the pure lightness of Light Summer - this is the beauty of fog, of watercolors left to dry, of photographs faded by time. Soft does not mean weak. The colors that honor you are quiet, but they are not silent.</p>
        </div>
        <div style="text-align: center;">
            <span class="season-badge">Soft Summer</span>
        </div>
        <p class="season-note">Muted, cool-neutral, low contrast. The defining characteristic is softness - everything is dusty and blended rather than clear or vivid.</p>
    </section>

    <section id="pigments">
        <h2>Source Pigments</h2>
        <p class="dim" style="margin-bottom: 32px; text-align: center;">The colors your body already contains. Click any for details on what it means.</p>
        <div class="pigment-grid" id="pigmentGrid"></div>
    </section>

    <section id="palette">
        <h2>Your Palette</h2>
        <p class="dim" style="margin-bottom: 32px; text-align: center;">Click any swatch for details. Double-click to favorite.</p>
        <div id="paletteGroups"></div>
    </section>

    <section id="favorites">
        <h2>Favorites</h2>
        <div id="favoritesContainer">
            <div class="favorites-empty">
                <p>Double-click any swatch to mark it as a favorite.<br>They will gather here.</p>
            </div>
        </div>
    </section>

    <section id="compare">
        <h2>Compare</h2>
        <p class="dim" style="margin-bottom: 32px; text-align: center;">Click any swatch, then use "Add to Compare" in the detail panel.</p>
        <div class="compare-area">
            <div class="compare-slot" id="compareSlot1"><span>First</span></div>
            <div class="compare-slot" id="compareSlot2"><span>Second</span></div>
        </div>
        <div class="compare-verdict" id="compareVerdict">
            <h4>Verdict</h4>
            <p style="color: var(--stone); font-style: italic;">Awaiting your selection.</p>
        </div>
        <button class="compare-clear" onclick="clearCompare()">Clear</button>
    </section>

    <section id="looks">
        <h2>Styled Looks</h2>
        <p class="dim" style="margin-bottom: 32px; text-align: center;">Five curated color stories.</p>
        <div class="looks-carousel" id="looksCarousel"></div>
    </section>

    <section id="metals">
        <h2>Your Metals</h2>
        <p class="dim" style="margin-bottom: 32px; text-align: center;">Not all that glitters is yours.</p>
        <div class="metals-grid" id="metalsGrid"></div>
    </section>

    <section id="makeup">
        <h2>Makeup Guide</h2>
        <p class="dim" style="margin-bottom: 32px; text-align: center;">Colors derived from your source pigments. Click any swatch for details.</p>
        <div class="makeup-container" id="makeupContainer"></div>
    </section>

    <section id="moods">
        <h2>Mood Translation</h2>
        <p class="dim" style="margin-bottom: 32px; text-align: center;">Select a mood. I will translate it into color relationships.</p>
        <div class="mood-grid" id="moodGrid"></div>
        <div class="mood-result" id="moodResult"></div>
    </section>

    <section id="zones">
        <h2>Distance Zones</h2>
        <p class="dim" style="margin-bottom: 32px; text-align: center;">Not all colors work everywhere. Some are face colors. Some are distance colors.</p>
        <div class="zone-diagram" id="zoneDiagram"></div>
    </section>

    <section id="confidante">
        <h2>Color Confidante</h2>
        <p class="dim" style="margin-bottom: 32px; text-align: center;">Ask me about any color. I will tell you if it belongs in your world.</p>
        <div class="confidante-input">
            <input type="text" id="confidanteInput" placeholder="#B89095 or dusty rose">
            <button onclick="askConfidante()">Ask</button>
        </div>
        <div class="confidante-result" id="confidanteResult"></div>
    </section>

    <section id="capsule">
        <h2>The Capsule</h2>
        <p class="dim" style="margin-bottom: 32px; text-align: center;">Generate a minimal 8-color wardrobe. Different each time.</p>
        <div class="capsule-generate">
            <button class="capsule-btn" onclick="generateCapsule()">Generate</button>
        </div>
        <div class="capsule-result" id="capsuleResult"></div>
    </section>

    <section id="permission">
        <h2>Permission Palette</h2>
        <div class="permission-intro">
            <p class="dim">Some colors you own completely. Others, you wear only when someone else says you look good. Click to toggle between owned and seeking permission.</p>
        </div>
        <div class="permission-grid" id="permissionGrid"></div>
    </section>

    <section id="silence">
        <h2>Color Silence</h2>
        <p class="dim" style="margin-bottom: 32px; text-align: center;">Sometimes you need to see without names, without labels, without guidance. Just color.</p>
        <button class="silence-btn" onclick="toggleSilence()">Enter Silence</button>
        <div class="silence-grid" id="silenceGrid"></div>
    </section>

    <section id="export">
        <h2>Export</h2>
        <div class="export-buttons">
            <button class="export-btn" onclick="exportJSON()">Full Palette (JSON)</button>
            <button class="export-btn secondary" onclick="exportFavoritesJSON()">Favorites (JSON)</button>
            <button class="export-btn secondary" onclick="exportText()">Copy as Text</button>
        </div>
        <pre class="export-preview" id="exportPreview"></pre>
    </section>

    <footer>
        <p>Soft Power</p>
        <p style="margin-top: 8px; color: var(--ash);">Wear what makes you feel powerful.</p>
    </footer>

    <button class="whisper-trigger" onclick="openWhisper()" title="Whisper Mode">&#9678;</button>

    <div class="color-detail" id="colorDetail">
        <button class="color-detail-close" onclick="closeColorDetail()">&#215;</button>
        <div class="color-detail-inner">
            <div class="color-detail-swatch" id="detailSwatch"></div>
            <div class="color-detail-info">
                <h3 class="color-detail-name" id="detailName"></h3>
                <p class="color-detail-hex" id="detailHex"></p>
                <p class="color-detail-desc" id="detailDesc"></p>
                <div class="color-detail-actions">
                    <button class="color-detail-btn" onclick="copyDetailHex()">Copy Hex</button>
                    <button class="color-detail-btn" id="detailFavBtn" onclick="toggleDetailFavorite()">Add to Favorites</button>
                    <button class="color-detail-btn" onclick="addDetailToCompare()">Add to Compare</button>
                </div>
            </div>
        </div>
    </div>

    <div class="whisper-mode" id="whisperMode">
        <button class="whisper-close" onclick="closeWhisper()">&#215;</button>
        <div class="whisper-swatch" id="whisperSwatch"></div>
        <div class="whisper-info">
            <p class="whisper-hex" id="whisperHex">#000000</p>
            <p class="whisper-group" id="whisperGroup">Group</p>
        </div>
        <div class="whisper-nav">
            <button onclick="whisperPrev()">&#8592;</button>
            <button onclick="whisperNext()">&#8594;</button>
        </div>
    </div>

    <script>
        // Data
        const sourcePigments = [
            { name: "Skin Base", hex: "#EEDED8", desc: "Pale porcelain", fullDesc: "Your foundation color - the lightest, truest tone of your skin without flush or shadow. A cool-leaning cream with the faintest pink undertone. This is your baseline for determining which colors will harmonize vs fight with your complexion." },
            { name: "Skin Variation", hex: "#E0C4BE", desc: "Pink undertone", fullDesc: "The pink that lives beneath your surface - visible in your inner arm, chest, and anywhere blood runs close to skin. This cool pink confirms your cool-neutral undertone and explains why warm corals look 'off' on you." },
            { name: "Freckles", hex: "#B89B78", desc: "Golden kisses", fullDesc: "The warm intruders. Your freckles are distinctly golden-brown, warmer than the rest of your coloring. They're why you can tolerate some muted warm tones - there's a whisper of gold already present. But they're visitors, not residents." },
            { name: "Natural Flush", hex: "#C99B98", desc: "Dusty rose bloom", fullDesc: "When blood rises to your cheeks, this is the color it makes - a muted, dusty rose. Not coral, not peach, not bright pink. This is your best blush color and the key to your entire rose palette. It's YOU." },
            { name: "Lips", hex: "#B38A8E", desc: "Quiet mauve", fullDesc: "Your natural lip color - a soft mauve with cool undertones. Desaturated and gentle. Any lipstick close to this will look like 'your lips but better.' Stray too warm or too bright and you'll look like you're wearing someone else's mouth." },
            { name: "Hair Root", hex: "#7A6B58", desc: "Smoke and earth", fullDesc: "Your true hair color at the root - a cool ash brown with grey undertones. This is the depth anchor of your coloring. It explains why your darkest colors can go to medium-depth without overwhelming you." },
            { name: "Hair Mid", hex: "#C2A882", desc: "Wheat", fullDesc: "The sun-touched middle of your hair - soft wheat gold. This is where a bit of warmth enters your coloring naturally. It's why you can wear muted gold jewelry and certain soft warm neutrals." },
            { name: "Hair Light", hex: "#D6C4A0", desc: "Pale honey", fullDesc: "Your lightest natural highlights - pale honey blonde. This light, soft gold represents the upper limit of warmth you carry naturally. It harmonizes with your cool base because it's so muted." },
            { name: "Eyes Primary", hex: "#889B82", desc: "Sage in fog", fullDesc: "The dominant color of your iris - a soft grey-green sage. Muted, complex, never vivid. This is your signature color, the one that makes your eyes look lit from within when you wear it. Sage is your superpower." },
            { name: "Eyes Amber", hex: "#A08654", desc: "Hidden warmth", fullDesc: "The amber starburst around your pupil - warm gold hidden inside cool green. This inner ring is why you have depth and complexity. It's the secret warmth that keeps you from being entirely cool, the reason you read as 'cool-neutral' rather than 'true cool.'" },
            { name: "Brows", hex: "#6B5A4A", desc: "Soft definition", fullDesc: "Your natural brow color - a soft ash brown. Neither too dark nor too warm. This is your natural contrast level and suggests your ideal brow product shade. Going darker would overwhelm; going warmer would fight your undertone." },
            { name: "Veins", hex: "#8090A8", desc: "Blue-violet rivers", fullDesc: "The color visible through your translucent skin - distinctly blue-purple, not green or teal. This is the clearest indicator of your cool undertone. Veins don't lie. Yours say: cool." }
        ];

        const colorNames = {
            // Neutrals
            "#4A4F52": "Ink Stone",
            "#5E6268": "Storm Cloud",
            "#8A8D8E": "Mourning Dove",
            "#A8A9A6": "Cathedral Grey",
            "#C9C5BE": "Bone Dust",
            "#DDD9D2": "Pale Linen",
            "#EAE6E1": "Ivory Veil",
            "#F5F2ED": "First Snow",
            // Cool Taupe
            "#6B635C": "Driftwood",
            "#857B73": "Sparrow Wing",
            "#9E958C": "Dried Sage",
            "#B5ACA3": "Worn Stone",
            "#C8C0B8": "Morning Mist",
            "#D8D2CB": "Winter Wool",
            // Soft Navy
            "#3E4A5C": "Midnight Study",
            "#4F5B6B": "Deep Current",
            "#6B7885": "Twilight Slate",
            "#8593A0": "Coastal Fog",
            "#A4B0BA": "Daybreak",
            // Dusty Rose
            "#B89095": "Faded Peony",
            "#C9A0A5": "Rose Quartz",
            "#D4AFB3": "Ballet Slipper",
            "#DCBEC0": "Petal Blush",
            "#9E7B80": "Dried Roses",
            "#876A70": "Wilted Bloom",
            "#755C62": "Bruised Petal",
            // Muted Pink
            "#D4B8BA": "Powder Kiss",
            "#E0C8C8": "Shell Pink",
            "#E8D5D5": "Whisper Pink",
            "#C9A8AA": "Dusty Corsage",
            "#BA9698": "Tea Rose",
            "#D4A8A3": "Soft Coral",
            // Sage
            "#6B7C6A": "Forest Floor",
            "#7D8E7A": "Lichen",
            "#92A28E": "Sea Glass",
            "#A8B5A2": "Morning Garden",
            "#BCC7B5": "Soft Fern",
            "#5A6B58": "Deep Moss",
            // Soft Teal
            "#5B7B7E": "Still Water",
            "#6E8E90": "Verdigris",
            "#82A0A2": "Seaglass Blue",
            "#98B2B3": "Pale Tide",
            "#4A6668": "Deep Lagoon",
            // Dusty Blue
            "#7088A0": "Wistful Blue",
            "#8498AE": "Faded Denim",
            "#98AABB": "Chambray",
            "#ABBCC8": "Winter Sky",
            "#5E7590": "Stormy Sea",
            "#4C6280": "Prussian Dusk",
            // Soft Lavender
            "#8878A0": "Distant Thunder",
            "#9A8CAE": "Dried Lavender",
            "#ACA0BC": "Wisteria",
            "#BEB4C8": "Pale Amethyst",
            "#756890": "Twilight Violet",
            // Muted Raspberry
            "#8E5B68": "Crushed Berry",
            "#A06B78": "Dusty Wine",
            "#7A4A58": "Dried Plum",
            "#6B3E4C": "Dark Cherry",
            // Cocoa
            "#6E5C52": "Espresso",
            "#7F6D62": "Driftwood Brown",
            "#8E7C72": "Fawn",
            "#5E4E45": "Dark Earth"
        };

        const colorDescriptions = {
            // Neutrals
            "#4A4F52": "Your darkest neutral. A cool charcoal with subtle blue undertones. Use as your alternative to black  it's softer but still authoritative. Best for: structured jackets, trousers, bags, shoes. Creates grounding without harshness.",
            "#5E6268": "Mid-dark grey with a whisper of blue. Professional without being severe. Best for: workwear, outerwear, denim alternatives. Pairs beautifully with your roses and lavenders.",
            "#8A8D8E": "Your true medium grey  perfectly balanced, neither warm nor cool. The ultimate mixer. Best for: knits, t-shirts, layering pieces. Disappears into outfits while making other colors sing.",
            "#A8A9A6": "A sophisticated greige leaning slightly cool. Elegant and understated. Best for: suits, blazers, quality basics. Reads as expensive and intentional.",
            "#C9C5BE": "Warm-leaning light neutral with a hint of stone. Soft but not washed out. Best for: light layers, summer pieces, linen. More interesting than white, less stark than cream.",
            "#DDD9D2": "Pale greige with warmth. Creates breathing room in outfits. Best for: blouses, light knits, base layers. Harmonizes with your skin without competing.",
            "#EAE6E1": "Soft ivory with grey undertones. Flattering near face without the harshness of pure white. Best for: shirts, scarves, anything near your face. Your safest light neutral.",
            "#F5F2ED": "Your lightest neutral  a warm snow white. Use sparingly as a highlight. Best for: crisp shirts, accents, summer pieces. Bright but not stark.",
            
            // Cool Taupe
            "#6B635C": "Deep taupe with cool grey undertones. A sophisticated brown alternative. Best for: leather goods, boots, belts, structured bags. Earthier than your greys but still cool enough.",
            "#857B73": "Medium taupe  the color of sparrow feathers. Warm-neutral and incredibly versatile. Best for: trench coats, casual blazers, everyday bags. Works with everything in your palette.",
            "#9E958C": "Dusty taupe leaning grey. Soft and undemanding. Best for: knits, casual layers, relaxed pieces. Creates effortless polish without trying.",
            "#B5ACA3": "Light warm stone. Quiet elegance. Best for: summer suits, light outerwear, quality basics. More sophisticated than beige, less cold than grey.",
            "#C8C0B8": "Pale mushroom grey. Soft and ethereal. Best for: silk pieces, layering, feminine details. Flattering near face, especially in soft fabrics.",
            "#D8D2CB": "Lightest taupe  almost white with warmth. Best for: winter layers, cream alternatives, light knits. Cozy without being heavy.",
            
            // Soft Navy
            "#3E4A5C": "Your deepest blue  a muted navy. Serious and grounded. Best for: suits, structured coats, formal pieces. Your alternative to black for important occasions.",
            "#4F5B6B": "Dark slate blue. Professional with depth. Best for: blazers, dress pants, work bags. Authority without aggression.",
            "#6B7885": "Medium slate  moody and sophisticated. Best for: casual suits, denim, everyday sophistication. Your perfect 'dark but not too dark.'",
            "#8593A0": "Dusty blue-grey. Calm and collected. Best for: knits, casual shirts, relaxed tailoring. Easy to wear, hard to get wrong.",
            "#A4B0BA": "Light steel blue. Fresh and professional. Best for: summer suits, light blazers, dress shirts. Cool and clean without being cold.",
            
            // Dusty Rose
            "#B89095": "Your signature rose  muted pink with mauve depth. Derived from your natural flush. Best for: anything near your face. Lipstick, blush, scarves, necklines. This is YOUR color.",
            "#C9A0A5": "Soft rose quartz. Romantic but not saccharine. Best for: blouses, dresses, feminine pieces. Flattering on everyone but especially you.",
            "#D4AFB3": "Ballet pink with grey undertones. Soft and pretty without being childish. Best for: evening wear, silk pieces, special occasions. Elegant and timeless.",
            "#DCBEC0": "Palest dusty pink. Barely-there color. Best for: delicate layers, intimate apparel, soft touches. Whisper-quiet femininity.",
            "#9E7B80": "Deeper mauve rose. More serious than the lighter pinks. Best for: knitwear, bags, mid-tone pieces. Adds warmth without brightness.",
            "#876A70": "Dusty plum-rose. Rich and complex. Best for: autumn pieces, deeper accents, velvet. Moody romance.",
            "#755C62": "Dark mauve  almost brown with rose. Your deepest pink-family color. Best for: leather goods, dark accents, winter pieces. Unexpected and sophisticated.",
            
            // Muted Pink
            "#D4B8BA": "Soft powder pink with warmth. Sweet but muted. Best for: soft knits, feminine layers, gentle accents. Never garish, always flattering.",
            "#E0C8C8": "Pale shell pink. Almost neutral. Best for: base layers, delicate pieces, subtle femininity. So soft it reads as a warm neutral.",
            "#E8D5D5": "Whisper pink  your palest blush. Best for: highlights, soft touches, intimate pieces. Barely there but adds warmth.",
            "#C9A8AA": "Dusty coral-pink. Warmer than your roses. Best for: summer pieces, casual pink, everyday softness. Easy and wearable.",
            "#BA9698": "Medium tea rose. Grounded pink with maturity. Best for: everyday pieces, knitwear, casual elegance. Pink for people who think they can't wear pink.",
            "#D4A8A3": "Your warmest pink  a soft coral that's been muted just enough to work with your cool-neutral undertone. Best for: summer pieces, warm-weather makeup, when you want a sun-kissed vibe without fighting your coloring. The peachy-pink you've been looking for.",
            
            // Sage
            "#6B7C6A": "True sage  the color of your eyes. Muted green with grey. Best for: anything you want to feel grounded in. Jackets, dresses, everyday pieces. Deeply harmonious with your coloring.",
            "#7D8E7A": "Lichen green. Soft and organic. Best for: casual wear, summer pieces, relaxed looks. Earthy without being heavy.",
            "#92A28E": "Sea glass green. Cool and refreshing. Best for: summer dresses, light layers, effortless pieces. Sophisticated casual.",
            "#A8B5A2": "Pale sage. Fresh and clean. Best for: spring/summer, light knits, soft touches. Garden-party elegance.",
            "#BCC7B5": "Softest sage  almost grey-green. Best for: delicate layers, pale accents, subtle color. Barely-there green.",
            "#5A6B58": "Deep moss. Your darkest green. Best for: outerwear, structured pieces, autumn looks. Grounded and serious.",
            
            // Soft Teal
            "#5B7B7E": "Still water teal. Cool and deep. Best for: statement pieces, professional wear, elegant depth. Unusual but universally flattering on you.",
            "#6E8E90": "Verdigris  aged copper green-blue. Complex and interesting. Best for: unique pieces, artistic looks, standout items. For when you want to be memorable.",
            "#82A0A2": "Soft teal-grey. Calm and sophisticated. Best for: everyday elegance, knitwear, relaxed sophistication. Easy to wear, always chic.",
            "#98B2B3": "Pale teal. Fresh and breezy. Best for: summer pieces, light layers, effortless color. Cool without being cold.",
            "#4A6668": "Deep lagoon. Your darkest teal. Best for: evening wear, structured pieces, dramatic moments. Mysterious depth.",
            
            // Dusty Blue
            "#7088A0": "Wistful blue  your perfect mid-blue. Muted but present. Best for: denim alternatives, casual elegance, everyday sophistication. Extremely versatile.",
            "#8498AE": "Faded denim blue. Relaxed and familiar. Best for: casual shirts, chambray, weekend wear. Feels like your favorite broken-in jeans.",
            "#98AABB": "Soft chambray. Light and easy. Best for: summer shirts, light layers, effortless polish. The color of a perfect Sunday.",
            "#ABBCC8": "Winter sky blue. Pale and dreamy. Best for: delicate pieces, pale accents, soft touches. Ethereal and romantic.",
            "#5E7590": "Stormy blue. Deeper and moodier. Best for: statement pieces, evening wear, emotional depth. When you want blue with weight.",
            "#4C6280": "Prussian dusk. Your darkest pure blue. Best for: serious occasions, evening elegance, depth without black. Formal but not severe.",
            
            // Soft Lavender
            "#8878A0": "Distant thunder purple. Moody and complex. Best for: creative pieces, evening wear, artistic expression. Your most emotional color family.",
            "#9A8CAE": "Dried lavender. Soft purple-grey. Best for: knitwear, feminine pieces, gentle statements. Purple for people who find purple intimidating.",
            "#ACA0BC": "Wisteria. Romantic and soft. Best for: special occasions, evening looks, feminine drama. Flattering and unexpected.",
            "#BEB4C8": "Pale amethyst. Barely-there purple. Best for: delicate layers, soft accents, subtle interest. More interesting than grey, less demanding than pink.",
            "#756890": "Twilight violet. Deep and mysterious. Best for: evening statements, creative looks, bold choices. Your most dramatic purple.",
            
            // Muted Raspberry
            "#8E5B68": "Crushed berry. Rich and complex. Best for: lipstick, statement pieces, autumn elegance. Your boldest lip color.",
            "#A06B78": "Dusty wine. Sophisticated and warm. Best for: knitwear, autumn pieces, mature romance. Wine without the heaviness.",
            "#7A4A58": "Dried plum. Deep and moody. Best for: evening wear, dramatic accents, winter depth. Luxurious and serious.",
            "#6B3E4C": "Dark cherry. Your deepest warm tone. Best for: evening drama, statement lips, formal occasions. When you need to make an entrance.",
            
            // Cocoa
            "#6E5C52": "Espresso. Rich brown with cool undertones. Best for: leather goods, boots, grounding accents. Your warmest dark neutral.",
            "#7F6D62": "Driftwood brown. Medium taupe-brown. Best for: casual pieces, everyday accessories, relaxed warmth. Brown that works with cool undertones.",
            "#8E7C72": "Fawn. Soft medium brown. Best for: light leather, summer accessories, gentle warmth. Easy and undemanding.",
            "#5E4E45": "Dark earth. Deep brown-grey. Best for: winter accessories, grounding elements, serious warmth. Your alternative to black in brown family."
        };

        const paletteGroups = {
            "Neutrals": ["#4A4F52", "#5E6268", "#8A8D8E", "#A8A9A6", "#C9C5BE", "#DDD9D2", "#EAE6E1", "#F5F2ED"],
            "Cool Taupe": ["#6B635C", "#857B73", "#9E958C", "#B5ACA3", "#C8C0B8", "#D8D2CB"],
            "Soft Navy": ["#3E4A5C", "#4F5B6B", "#6B7885", "#8593A0", "#A4B0BA"],
            "Dusty Rose": ["#B89095", "#C9A0A5", "#D4AFB3", "#DCBEC0", "#9E7B80", "#876A70", "#755C62"],
            "Muted Pink": ["#D4B8BA", "#E0C8C8", "#E8D5D5", "#C9A8AA", "#BA9698", "#D4A8A3"],
            "Sage": ["#6B7C6A", "#7D8E7A", "#92A28E", "#A8B5A2", "#BCC7B5", "#5A6B58"],
            "Soft Teal": ["#5B7B7E", "#6E8E90", "#82A0A2", "#98B2B3", "#4A6668"],
            "Dusty Blue": ["#7088A0", "#8498AE", "#98AABB", "#ABBCC8", "#5E7590", "#4C6280"],
            "Soft Lavender": ["#8878A0", "#9A8CAE", "#ACA0BC", "#BEB4C8", "#756890"],
            "Muted Raspberry": ["#8E5B68", "#A06B78", "#7A4A58", "#6B3E4C"],
            "Cocoa": ["#6E5C52", "#7F6D62", "#8E7C72", "#5E4E45"]
        };

        const looks = [
            { name: "Morning Mist", colors: ["#F5F2ED", "#98AABB", "#889B82", "#B5ACA3", "#C9A0A5"], desc: "Soft cream base, dusty blue cardigan, sage accents. Mauve lip, soft rose cheek. For quiet confidence." },
            { name: "Twilight Study", colors: ["#4A4F52", "#8878A0", "#D8D2CB", "#7088A0", "#B38A8E"], desc: "Charcoal foundation, lavender silk, stone accessories. Dusty blue eyes, mauve lip. For thoughtful evenings." },
            { name: "Garden at Dusk", colors: ["#6B7C6A", "#D4AFB3", "#5E4E45", "#BCC7B5", "#876A70"], desc: "Deep sage dress, blush jewelry, cocoa bag. Rose-toned makeup throughout. For romantic occasions." },
            { name: "Coastal Grey", colors: ["#5B7B7E", "#EAE6E1", "#8A8D8E", "#98B2B3", "#C99B98"], desc: "Soft teal main, warm ivory layers, grey accents. Natural flush makeup. For effortless polish." },
            { name: "Velvet Hours", colors: ["#6B3E4C", "#D8D2CB", "#756890", "#9E7B80", "#C8C0B8"], desc: "Deep raspberry anchor, stone neutrals, purple accent. Bold lip, soft eye. For making an entrance." }
        ];

        const moods = [
            { name: "Severe", colors: ["#4A4F52", "#3E4A5C", "#5E4E45", "#6B3E4C", "#755C62"], desc: "When you need to be taken seriously. No softness. All edge." },
            { name: "Luminous", colors: ["#F5F2ED", "#E8D5D5", "#DCBEC0", "#D6C4A0", "#BCC7B5"], desc: "When you want to glow from within. Light values only. Ethereal." },
            { name: "Soft Authority", colors: ["#6B7885", "#8A8D8E", "#9E958C", "#B5ACA3", "#7088A0"], desc: "Competent without trying. The colors of someone who has nothing to prove." },
            { name: "Romantic Menace", colors: ["#6B3E4C", "#8878A0", "#B89095", "#5B7B7E", "#4A4F52"], desc: "Beautiful and dangerous. The palette of someone who might ruin you." },
            { name: "Clean Detachment", colors: ["#DDD9D2", "#C9C5BE", "#A8A9A6", "#8A8D8E", "#6B7885"], desc: "Emotionally unavailable chic. Cool, distant, untouchable." },
            { name: "Quiet Rebellion", colors: ["#5A6B58", "#7A4A58", "#4C6280", "#6E5C52", "#8878A0"], desc: "Not loud. Not obvious. But deeply yourself." }
        ];

        const zones = {
            "Near Face": {
                note: "These colors harmonize with your skin and eyes. Scarves, necklines, earrings.",
                colors: ["#C9A0A5", "#D4AFB3", "#B5ACA3", "#98AABB", "#889B82", "#DCBEC0", "#E0C8C8"]
            },
            "Mid-Body": {
                note: "Versatile. Tops, jackets, dresses. Can handle more saturation.",
                colors: ["#7088A0", "#6B7C6A", "#8878A0", "#B89095", "#5B7B7E", "#9E958C", "#857B73"]
            },
            "Far From Face": {
                note: "Pants, shoes, bags. Can go darker or more saturated without overwhelming.",
                colors: ["#4A4F52", "#3E4A5C", "#5E4E45", "#6B3E4C", "#4A6668", "#4C6280", "#755C62"]
            }
        };

        const capsuleNames = [
            { name: "The Understated", desc: "Quiet authority" },
            { name: "The Drift", desc: "Effortless movement" },
            { name: "The Murmur", desc: "Soft-spoken elegance" },
            { name: "The Reverie", desc: "Daydream dressed" },
            { name: "The Threshold", desc: "Between seasons" },
            { name: "The Archive", desc: "Timeless collection" }
        ];

        const metals = [
            { name: "Silver", hex: "#C0C0C0", rating: "Perfect", desc: "Your ideal metal. Cool, soft, harmonizes with your blue-violet veins and cool-neutral undertone. Brushed or satin finish is more flattering than high polish." },
            { name: "White Gold", hex: "#E8E8E0", rating: "Perfect", desc: "Essentially silver's expensive cousin. The slight warmth in white gold works beautifully with your muted coloring without fighting your cool undertone." },
            { name: "Pewter", hex: "#8A8A8A", rating: "Perfect", desc: "Antique, muted, sophisticated. Pewter's grey tones echo your natural mutedness. Especially beautiful in vintage or artisan pieces." },
            { name: "Rose Gold", hex: "#B76E79", rating: "Good", desc: "Works because it echoes your natural flush and dusty rose tones. Choose muted, greyed rose gold over bright pink-gold. Best in small doses near your face." },
            { name: "Soft Gold", hex: "#D4AF37", rating: "Conditional", desc: "You can wear this because of the amber in your eyes and the wheat in your hair  but keep it muted and brushed, never bright yellow gold. Best mixed with silver." },
            { name: "Brass", hex: "#B5A642", rating: "Avoid", desc: "Too warm, too yellow, too bold. Brass fights your cool undertone and overwhelms your mutedness. It will make you look sallow." },
            { name: "Copper", hex: "#B87333", rating: "Avoid", desc: "Too orange, too warm. Copper has no echo in your natural coloring. It will stand apart from you rather than harmonize." },
            { name: "Bright Gold", hex: "#FFD700", rating: "Avoid", desc: "Too vivid, too warm, too saturated. Bright yellow gold overpowers your soft coloring and clashes with your cool undertone. Always choose muted over bright." }
        ];

        const makeup = {
            face: [
                { name: "Foundation Undertone", desc: "Cool-neutral with pink undertones. Avoid anything labeled 'warm,' 'golden,' or 'olive.' Look for 'cool,' 'neutral,' or 'rose.' You likely need a lighter shade than you think." },
                { name: "Concealer", desc: "Match foundation undertone. For under-eyes, can go slightly peachy-pink to counteract blue, but never orange." },
                { name: "Powder", desc: "Translucent or finely-milled with no yellow. Avoid banana powder  it will make you look sallow." },
                { name: "Bronzer", desc: "Cool-toned or rose-bronze only. Think 'contour' not 'sun-kissed.' Avoid anything orange. Your bronzer should be greyed and muted." }
            ],
            blush: [
                { name: "Dusty Rose", hex: "#C99B98", desc: "Your exact natural flush  this will always look like you're glowing from within. Your fail-safe." },
                { name: "Muted Mauve", hex: "#B89095", desc: "Slightly deeper, slightly cooler. Beautiful for evening or when you want more definition." },
                { name: "Soft Berry", hex: "#A06B78", desc: "Your 'statement' blush  still muted but with more depth. For drama without harshness." },
                { name: "Barely Pink", hex: "#DCBEC0", desc: "For minimal makeup days. Just a whisper of color that looks like your own skin, perfected." },
                { name: "Warm Flush", hex: "#C9A595", desc: "A peachy-rose  the warmest blush you can wear. For sun-kissed looks that still harmonize." },
                { name: "Cool Pink", hex: "#C4A0A8", desc: "A true pink with grey in it. Fresh and youthful without being bright." }
            ],
            lips: [
                { name: "Your Lips But Better", hex: "#B38A8E", desc: "Your exact natural lip color. The perfect nude  any lipstick this shade will look effortless." },
                { name: "Dusty Rose", hex: "#C9A0A5", desc: "Slightly pinker, slightly lighter. Fresh and romantic without being saccharine." },
                { name: "Soft Pink", hex: "#D4B0B5", desc: "A true pink, but softened. Pretty without being bubblegum. Your 'girl next door' lip." },
                { name: "Muted Peach-Pink", hex: "#D4A8A3", desc: "The warmest pink you can go  a soft coral-pink that's been greyed down to work with your undertone. This is your 'coral' alternative." },
                { name: "Warm Nude", hex: "#C4A698", desc: "A nude with peachy warmth. Pairs well with bronzier makeup looks without fighting your undertone." },
                { name: "Mauve Moment", hex: "#9E7B80", desc: "Deeper mauve for everyday polish. Professional without being severe." },
                { name: "Berry Whisper", hex: "#8E5B68", desc: "Your boldest everyday lip  crushed berry that still reads as 'you' rather than 'lipstick.'" },
                { name: "Raspberry", hex: "#A06B78", desc: "A dusty raspberry  pinker than berry, deeper than rose. For when you want color with sophistication." },
                { name: "Evening Drama", hex: "#6B3E4C", desc: "Dark cherry for when you want to make an entrance. Your deepest flattering lip." },
                { name: "Dried Fig", hex: "#7A4A58", desc: "A muted plum-brown. Moody and complex. Beautiful for fall and winter." }
            ],
            eyes: [
                { name: "Lid Base", hex: "#E8D5D5", desc: "Whisper pink or soft champagne. Sets the stage without competing." },
                { name: "All-Over Wash", hex: "#C8C0B8", desc: "Soft taupe. Your perfect one-shadow look  defines without drama." },
                { name: "Crease Definition", hex: "#9E958C", desc: "Greyed taupe. Soft definition that makes your eyes look larger." },
                { name: "Soft Depth", hex: "#857B73", desc: "Deeper taupe for the outer corner. Still muted, never harsh." },
                { name: "Sage Magic", hex: "#889B82", desc: "Your eye color as eyeshadow  makes your eyes luminous and complex." },
                { name: "Dusty Plum", hex: "#8878A0", desc: "Brings out the green in your eyes through color theory. Soft and romantic." },
                { name: "Soft Rose", hex: "#B89095", desc: "Warm definition without orange. Beautiful in the crease or lower lash line." },
                { name: "Deep Definition", hex: "#6B635C", desc: "Your darkest shadow  a cool driftwood. For smokiness without black." },
                { name: "Liner", hex: "#4A4F52", desc: "Soft charcoal, never black. Smudged rather than sharp. Or try #5A6B58 deep moss for something unexpected." }
            ],
            brows: [
                { name: "Your Perfect Match", hex: "#6B5A4A", desc: "Your exact brow color  soft ash brown. Use light strokes, never heavy-handed." },
                { name: "Softer Option", hex: "#857B73", desc: "For a lighter, more diffused brow. Good for minimal makeup days." }
            ]
        };

        // State
        let favorites = [];
        let permissions = {};
        let compareColors = [null, null];
        let selectedForCompare = null;
        let whisperIndex = 0;
        let allColors = [];
        let silenceVisible = false;
        let currentDetailColor = null;

        Object.entries(paletteGroups).forEach(([group, colors]) => {
            colors.forEach(hex => allColors.push({ hex, group }));
        });

        // Init
        document.addEventListener("DOMContentLoaded", () => {
            loadFavorites();
            loadPermissions();
            renderPigments();
            renderPalette();
            renderFavorites();
            renderLooks();
            renderMetals();
            renderMakeup();
            renderMoods();
            renderZones();
            renderPermissions();
            renderSilence();

            document.querySelectorAll("nav a").forEach(link => {
                link.addEventListener("click", function() {
                    document.querySelectorAll("nav a").forEach(l => l.classList.remove("active"));
                    this.classList.add("active");
                });
            });
        });

        // Storage
        function loadFavorites() {
            try {
                const stored = localStorage.getItem("softpower_favorites_v2");
                if (stored) favorites = JSON.parse(stored);
            } catch(e) { favorites = []; }
        }

        function saveFavorites() {
            try {
                localStorage.setItem("softpower_favorites_v2", JSON.stringify(favorites));
            } catch(e) {}
        }

        function loadPermissions() {
            try {
                const stored = localStorage.getItem("softpower_permissions");
                if (stored) permissions = JSON.parse(stored);
            } catch(e) { permissions = {}; }
        }

        function savePermissions() {
            try {
                localStorage.setItem("softpower_permissions", JSON.stringify(permissions));
            } catch(e) {}
        }

        // Toast
        function showToast(message) {
            const toast = document.getElementById("toast");
            toast.textContent = message;
            toast.classList.add("show");
            setTimeout(() => toast.classList.remove("show"), 2000);
        }

        function copyHex(hex) {
            const name = colorNames[hex] ? colorNames[hex] + " " : "";
            navigator.clipboard.writeText(hex).then(() => showToast("Copied " + name + hex)).catch(() => showToast("Copied " + name + hex));
        }

        // Render
        function renderPigments() {
            document.getElementById("pigmentGrid").innerHTML = sourcePigments.map((p, i) => `
                <div class="pigment" onclick="openPigmentDetail(${i})" style="--glow-color: ${p.hex}40;">
                    <div class="pigment-swatch" style="background-color: ${p.hex};"></div>
                    <div class="pigment-info">
                        <p class="pigment-name">${p.desc}</p>
                        <p class="pigment-hex">${p.hex}</p>
                    </div>
                </div>
            `).join("");
        }

        function openPigmentDetail(index) {
            const p = sourcePigments[index];
            currentDetailColor = p.hex;
            const panel = document.getElementById("colorDetail");
            document.getElementById("detailSwatch").style.backgroundColor = p.hex;
            document.getElementById("detailSwatch").style.background = p.hex;
            document.getElementById("detailSwatch").style.setProperty("--glow-color", p.hex + "60");
            document.getElementById("detailName").textContent = p.name;
            document.getElementById("detailHex").textContent = p.hex + " - Source Pigment";
            document.getElementById("detailDesc").textContent = p.fullDesc;
            document.getElementById("detailFavBtn").style.display = "block";
            document.getElementById("detailFavBtn").textContent = favorites.includes(p.hex) ? "Remove from Favorites" : "Add to Favorites";
            panel.classList.add("show");
        }

        function renderPalette() {
            document.getElementById("paletteGroups").innerHTML = Object.entries(paletteGroups).map(([name, colors]) => `
                <div class="palette-group">
                    <p class="palette-group-title">${name}</p>
                    <div class="palette-grid">
                        ${colors.map(hex => `
                            <div class="swatch ${favorites.includes(hex) ? 'favorite' : ''} ${selectedForCompare === hex ? 'selected' : ''}" 
                                 style="background-color: ${hex}; --glow-color: ${hex}80;"
                                 onclick="handleSwatchClick('${hex}', '${name}')"
                                 ondblclick="toggleFavorite('${hex}')">
                                <span class="swatch-tooltip">${colorNames[hex] || hex}<br><span style="opacity: 0.6">${hex}</span></span>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `).join("");
        }

        function handleSwatchClick(hex, group) {
            openColorDetail(hex, group);
        }

        function openColorDetail(hex, group) {
            currentDetailColor = hex;
            const panel = document.getElementById("colorDetail");
            document.getElementById("detailSwatch").style.backgroundColor = hex;
            document.getElementById("detailSwatch").style.background = hex;
            document.getElementById("detailSwatch").style.setProperty("--glow-color", hex + "60");
            document.getElementById("detailName").textContent = colorNames[hex] || "Unnamed";
            document.getElementById("detailHex").textContent = hex + " - " + group;
            document.getElementById("detailDesc").textContent = colorDescriptions[hex] || "No description available.";
            document.getElementById("detailFavBtn").style.display = "block";
            document.getElementById("detailFavBtn").textContent = favorites.includes(hex) ? "Remove from Favorites" : "Add to Favorites";
            panel.classList.add("show");
        }

        function closeColorDetail() {
            document.getElementById("colorDetail").classList.remove("show");
            document.getElementById("detailFavBtn").style.display = "block";
            currentDetailColor = null;
        }

        function copyDetailHex() {
            if (currentDetailColor) {
                copyHex(currentDetailColor);
            }
        }

        function toggleDetailFavorite() {
            if (currentDetailColor) {
                toggleFavorite(currentDetailColor);
                document.getElementById("detailFavBtn").textContent = favorites.includes(currentDetailColor) ? "Remove from Favorites" : "Add to Favorites";
            }
        }

        function addDetailToCompare() {
            if (currentDetailColor) {
                // Find the group for this color
                let group = "Unknown";
                for (const [g, colors] of Object.entries(paletteGroups)) {
                    if (colors.includes(currentDetailColor)) {
                        group = g;
                        break;
                    }
                }
                addToCompare(currentDetailColor, group);
            }
        }

        function addToCompare(hex, group) {
            if (compareColors[0] === null) {
                compareColors[0] = { hex, group };
                updateCompareSlot(1, hex);
                showToast("Added to compare slot 1");
            } else if (compareColors[1] === null) {
                compareColors[1] = { hex, group };
                updateCompareSlot(2, hex);
                generateVerdict();
                showToast("Added to compare slot 2");
            } else {
                showToast("Clear compare first");
            }
        }

        function toggleFavorite(hex) {
            if (favorites.includes(hex)) {
                favorites = favorites.filter(f => f !== hex);
                showToast("Removed from favorites");
            } else {
                favorites.push(hex);
                showToast("Added to favorites");
            }
            saveFavorites();
            renderPalette();
            renderFavorites();
        }

        function renderFavorites() {
            const container = document.getElementById("favoritesContainer");
            if (favorites.length === 0) {
                container.innerHTML = `<div class="favorites-empty"><p>Double-click any swatch to mark it as a favorite.<br>They will gather here.</p></div>`;
                return;
            }
            container.innerHTML = `
                <div class="favorites-grid">
                    ${favorites.map(hex => `
                        <div class="favorite-card">
                            <div class="favorite-swatch" style="background-color: ${hex}; --glow-color: ${hex}80;" onclick="copyHex('${hex}')"></div>
                            <div class="favorite-info">
                                <span class="favorite-hex">${colorNames[hex] || hex}</span>
                                <button class="favorite-remove" onclick="toggleFavorite('${hex}')">&times;</button>
                            </div>
                        </div>
                    `).join("")}
                </div>
            `;
        }

        function renderLooks() {
            document.getElementById("looksCarousel").innerHTML = looks.map(look => `
                <div class="look-card">
                    <div class="look-swatches">
                        ${look.colors.map(c => `<div style="background-color: ${c}; --glow-color: ${c}60;"></div>`).join("")}
                    </div>
                    <div class="look-content">
                        <h3 class="look-title">${look.name}</h3>
                        <p class="look-desc">${look.desc}</p>
                    </div>
                </div>
            `).join("");
        }

        function renderMetals() {
            document.getElementById("metalsGrid").innerHTML = metals.map(m => `
                <div class="metal-card" onclick="openMetalDetail('${m.name}')">
                    <div class="metal-swatch" style="background: linear-gradient(135deg, ${m.hex} 0%, ${adjustBrightness(m.hex, 30)} 50%, ${m.hex} 100%);"></div>
                    <div class="metal-info">
                        <p class="metal-name">${m.name}</p>
                        <p class="metal-rating ${m.rating.toLowerCase()}">${m.rating}</p>
                    </div>
                </div>
            `).join("");
        }

        function openMetalDetail(name) {
            const m = metals.find(metal => metal.name === name);
            if (!m) return;
            currentDetailColor = m.hex;
            const panel = document.getElementById("colorDetail");
            document.getElementById("detailSwatch").style.background = `linear-gradient(135deg, ${m.hex} 0%, ${adjustBrightness(m.hex, 30)} 50%, ${m.hex} 100%)`;
            document.getElementById("detailSwatch").style.setProperty("--glow-color", m.hex + "60");
            document.getElementById("detailName").textContent = m.name;
            document.getElementById("detailHex").textContent = m.rating + " - Metal";
            document.getElementById("detailDesc").textContent = m.desc;
            document.getElementById("detailFavBtn").style.display = "none";
            panel.classList.add("show");
        }

        function adjustBrightness(hex, percent) {
            const rgb = hexToRgb(hex);
            const adjust = (val) => Math.min(255, Math.floor(val + (255 - val) * (percent / 100)));
            return `rgb(${adjust(rgb.r)}, ${adjust(rgb.g)}, ${adjust(rgb.b)})`;
        }

        function renderMakeup() {
            const container = document.getElementById("makeupContainer");
            
            let html = '';
            
            // Face (no swatches)
            html += `
                <div class="makeup-category">
                    <h3 class="makeup-category-title">Face</h3>
                    <div class="makeup-no-swatch">
                        ${makeup.face.map(item => `
                            <div class="makeup-item">
                                <p class="makeup-name">${item.name}</p>
                                <p class="makeup-desc">${item.desc}</p>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `;
            
            // Blush
            html += `
                <div class="makeup-category">
                    <h3 class="makeup-category-title">Blush</h3>
                    <div class="makeup-items">
                        ${makeup.blush.map(item => `
                            <div class="makeup-item" onclick="openMakeupDetail('${item.name}', '${item.hex}', '${item.desc.replace(/'/g, "\\'")}', 'Blush')">
                                <div class="makeup-swatch" style="background-color: ${item.hex}; --glow-color: ${item.hex}80;"></div>
                                <div class="makeup-text">
                                    <p class="makeup-name">${item.name}</p>
                                    <p class="makeup-desc">${item.desc}</p>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `;
            
            // Lips
            html += `
                <div class="makeup-category">
                    <h3 class="makeup-category-title">Lips</h3>
                    <div class="makeup-items">
                        ${makeup.lips.map(item => `
                            <div class="makeup-item" onclick="openMakeupDetail('${item.name}', '${item.hex}', '${item.desc.replace(/'/g, "\\'")}', 'Lips')">
                                <div class="makeup-swatch" style="background-color: ${item.hex}; --glow-color: ${item.hex}80;"></div>
                                <div class="makeup-text">
                                    <p class="makeup-name">${item.name}</p>
                                    <p class="makeup-desc">${item.desc}</p>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `;
            
            // Eyes
            html += `
                <div class="makeup-category">
                    <h3 class="makeup-category-title">Eyes</h3>
                    <div class="makeup-items">
                        ${makeup.eyes.map(item => `
                            <div class="makeup-item" onclick="openMakeupDetail('${item.name}', '${item.hex}', '${item.desc.replace(/'/g, "\\'")}', 'Eyes')">
                                <div class="makeup-swatch" style="background-color: ${item.hex}; --glow-color: ${item.hex}80;"></div>
                                <div class="makeup-text">
                                    <p class="makeup-name">${item.name}</p>
                                    <p class="makeup-desc">${item.desc}</p>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `;
            
            // Brows
            html += `
                <div class="makeup-category">
                    <h3 class="makeup-category-title">Brows</h3>
                    <div class="makeup-items">
                        ${makeup.brows.map(item => `
                            <div class="makeup-item" onclick="openMakeupDetail('${item.name}', '${item.hex}', '${item.desc.replace(/'/g, "\\'")}', 'Brows')">
                                <div class="makeup-swatch" style="background-color: ${item.hex}; --glow-color: ${item.hex}80;"></div>
                                <div class="makeup-text">
                                    <p class="makeup-name">${item.name}</p>
                                    <p class="makeup-desc">${item.desc}</p>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function openMakeupDetail(name, hex, desc, category) {
            currentDetailColor = hex;
            const panel = document.getElementById("colorDetail");
            document.getElementById("detailSwatch").style.backgroundColor = hex;
            document.getElementById("detailSwatch").style.background = hex;
            document.getElementById("detailSwatch").style.setProperty("--glow-color", hex + "60");
            document.getElementById("detailName").textContent = name;
            document.getElementById("detailHex").textContent = hex + " - " + category;
            document.getElementById("detailDesc").textContent = desc;
            document.getElementById("detailFavBtn").style.display = "block";
            document.getElementById("detailFavBtn").textContent = favorites.includes(hex) ? "Remove from Favorites" : "Add to Favorites";
            panel.classList.add("show");
        }

        function renderMoods() {
            document.getElementById("moodGrid").innerHTML = moods.map((m, i) => `
                <button class="mood-btn" onclick="selectMood(${i})">${m.name}</button>
            `).join("");
        }

        function selectMood(index) {
            const m = moods[index];
            document.querySelectorAll(".mood-btn").forEach((b, i) => b.classList.toggle("active", i === index));
            const result = document.getElementById("moodResult");
            result.classList.add("show");
            result.innerHTML = `
                <div class="mood-colors">
                    ${m.colors.map(c => `<div class="mood-swatch" style="background-color: ${c}; --glow-color: ${c}80;" onclick="openColorDetail('${c}', 'Mood: ${m.name}')"></div>`).join("")}
                </div>
                <p>${m.desc}</p>
            `;
        }

        function renderZones() {
            document.getElementById("zoneDiagram").innerHTML = Object.entries(zones).map(([name, data]) => `
                <div class="zone">
                    <div class="zone-header">
                        <span class="zone-name">${name}</span>
                        <span class="zone-note">${data.note}</span>
                    </div>
                    <div class="zone-colors">
                        ${data.colors.map(c => `<div class="zone-swatch" style="background-color: ${c}; --glow-color: ${c}80;" onclick="openColorDetail('${c}', '${name}')"></div>`).join("")}
                    </div>
                </div>
            `).join("");
        }

        function renderPermissions() {
            const colors = ["#6B3E4C", "#8878A0", "#5B7B7E", "#B89095", "#4A4F52", "#889B82", "#7088A0", "#6B7C6A"];
            document.getElementById("permissionGrid").innerHTML = colors.map(hex => {
                const status = permissions[hex] || "seeking";
                return `
                    <div class="permission-card ${status}" onclick="togglePermission('${hex}')">
                        <div class="permission-swatch" style="background-color: ${hex}; --glow-color: ${hex}80;"></div>
                        <p class="permission-status">${status === "owned" ? "Owned" : "Seeking"}</p>
                    </div>
                `;
            }).join("");
        }

        function togglePermission(hex) {
            permissions[hex] = permissions[hex] === "owned" ? "seeking" : "owned";
            savePermissions();
            renderPermissions();
            showToast(permissions[hex] === "owned" ? "You own this now" : "Still seeking permission");
        }

        function renderSilence() {
            document.getElementById("silenceGrid").innerHTML = allColors.map(c => `
                <div class="silence-swatch" style="background-color: ${c.hex}; --glow-color: ${c.hex}80;" onclick="copyHex('${c.hex}')"></div>
            `).join("");
        }

        function toggleSilence() {
            silenceVisible = !silenceVisible;
            document.getElementById("silenceGrid").classList.toggle("show", silenceVisible);
            document.querySelector(".silence-btn").textContent = silenceVisible ? "Exit Silence" : "Enter Silence";
        }

        // Compare
        function updateCompareSlot(slot, hex) {
            const el = document.getElementById("compareSlot" + slot);
            el.style.backgroundColor = hex;
            el.classList.add("filled");
            el.style.setProperty("--glow-color", hex + "60");
            el.innerHTML = `<span>${colorNames[hex] || hex}</span>`;
        }

        function clearCompare() {
            compareColors = [null, null];
            selectedForCompare = null;
            [1, 2].forEach(i => {
                const el = document.getElementById("compareSlot" + i);
                el.style.backgroundColor = "";
                el.classList.remove("filled");
                el.innerHTML = `<span>${i === 1 ? "First" : "Second"}</span>`;
            });
            document.getElementById("compareVerdict").innerHTML = `<h4>Verdict</h4><p style="color: var(--stone); font-style: italic;">Awaiting your selection.</p>`;
            renderPalette();
        }

        function generateVerdict() {
            if (!compareColors[0] || !compareColors[1]) return;
            const c1 = compareColors[0], c2 = compareColors[1];
            const contrast = getContrastRatio(c1.hex, c2.hex);
            let verdict = "", advice = "";

            if (contrast > 4.5) {
                verdict = "High Contrast";
                advice = "Strong visual separation. Use the lighter color for larger areas, the darker for accents. This combination makes a statement.";
            } else if (contrast > 2.5) {
                verdict = "Comfortable Contrast";
                advice = "Easy on the eye. These can be worn in equal proportions without overwhelming. Good for layering.";
            } else {
                verdict = "Tonal Harmony";
                advice = "Very subtle - these read as variations of each other. Beautiful for monochromatic looks. Add a third color with more contrast for definition.";
            }

            if (c1.group === c2.group) advice += ` Both from ${c1.group} - guaranteed harmony.`;

            document.getElementById("compareVerdict").innerHTML = `
                <h4>${verdict}</h4>
                <p>${advice}</p>
                <p style="margin-top: 16px; font-size: 11px; color: var(--stone);">Contrast ratio: ${contrast.toFixed(1)}:1</p>
            `;
        }

        // Confidante
        function askConfidante() {
            const input = document.getElementById("confidanteInput").value.trim();
            const result = document.getElementById("confidanteResult");
            let testHex = input.startsWith("#") ? input : colorNameToHex(input);

            if (!testHex || !/^#[0-9A-Fa-f]{6}$/.test(testHex)) {
                result.classList.add("show");
                result.innerHTML = `<p style="color: var(--stone); font-style: italic;">I could not parse that color. Try a hex code like #B89095.</p>`;
                return;
            }

            let closest = null, minDist = Infinity;
            allColors.forEach(c => {
                const dist = colorDistance(testHex, c.hex);
                if (dist < minDist) { minDist = dist; closest = c; }
            });

            let verdict, verdictClass, explanation;
            if (minDist < 30) {
                verdict = "In Your Palette";
                verdictClass = "yes";
                explanation = `This is essentially ${closest.hex} from your ${closest.group} family. It is yours.`;
            } else if (minDist < 60) {
                verdict = "A Stretch";
                verdictClass = "stretch";
                explanation = `Not quite in your palette, but close enough to work. The nearest match is ${closest.hex} from ${closest.group}.`;
            } else {
                verdict = "Foreign Territory";
                verdictClass = "no";
                explanation = `This color lives outside your world. The closest alternative is ${closest.hex} from ${closest.group}.`;
            }

            result.classList.add("show");
            result.innerHTML = `
                <div class="confidante-swatches">
                    <div class="confidante-swatch" style="background-color: ${testHex}; --glow-color: ${testHex}60;"></div>
                    <span class="confidante-arrow">&#8594;</span>
                    <div class="confidante-swatch" style="background-color: ${closest.hex}; --glow-color: ${closest.hex}60;"></div>
                </div>
                <span class="confidante-verdict-tag ${verdictClass}">${verdict}</span>
                <p>${explanation}</p>
            `;
        }

        // Capsule
        function generateCapsule() {
            const result = document.getElementById("capsuleResult");
            const nameData = capsuleNames[Math.floor(Math.random() * capsuleNames.length)];
            const neutrals = shuffle([...paletteGroups["Neutrals"]]).slice(0, 2);
            const depths = shuffle([...paletteGroups["Soft Navy"], ...paletteGroups["Cocoa"]]).slice(0, 1);
            const mains = shuffle([...paletteGroups["Sage"], ...paletteGroups["Dusty Blue"], ...paletteGroups["Soft Teal"]]).slice(0, 2);
            const accents = shuffle([...paletteGroups["Dusty Rose"], ...paletteGroups["Soft Lavender"], ...paletteGroups["Muted Pink"]]).slice(0, 2);
            const statement = shuffle([...paletteGroups["Muted Raspberry"]]).slice(0, 1);
            const capsule = [...neutrals, ...depths, ...mains, ...accents, ...statement];

            result.classList.add("show");
            result.innerHTML = `
                <div class="capsule-header">
                    <h3 class="capsule-name">${nameData.name}</h3>
                    <p class="capsule-desc">${nameData.desc}</p>
                </div>
                <div class="capsule-colors">
                    ${capsule.map(hex => `<div class="capsule-color" style="background-color: ${hex}; --glow-color: ${hex}60;" onclick="copyHex('${hex}')"><span>${colorNames[hex] || hex}</span></div>`).join("")}
                </div>
            `;
        }

        // Whisper
        function openWhisper() {
            document.getElementById("whisperMode").classList.add("active");
            updateWhisper();
        }

        function closeWhisper() {
            document.getElementById("whisperMode").classList.remove("active");
        }

        function updateWhisper() {
            const c = allColors[whisperIndex];
            const swatch = document.getElementById("whisperSwatch");
            swatch.style.backgroundColor = c.hex;
            swatch.style.setProperty("--glow-color", c.hex + "60");
            document.getElementById("whisperHex").textContent = colorNames[c.hex] || c.hex;
            document.getElementById("whisperGroup").textContent = c.hex + " - " + c.group;
        }

        function whisperPrev() { whisperIndex = (whisperIndex - 1 + allColors.length) % allColors.length; updateWhisper(); }
        function whisperNext() { whisperIndex = (whisperIndex + 1) % allColors.length; updateWhisper(); }

        // Export
        function exportJSON() {
            const data = { title: "Soft Power", season: "Soft Summer", undertone: "Cool-Neutral", sourcePigments, palette: paletteGroups, colorNames, favorites, permissions, exportedAt: new Date().toISOString() };
            const preview = document.getElementById("exportPreview");
            preview.textContent = JSON.stringify(data, null, 2);
            preview.classList.add("show");
            navigator.clipboard.writeText(JSON.stringify(data, null, 2)).then(() => showToast("JSON copied"));
        }

        function exportFavoritesJSON() {
            const data = { title: "Soft Power - Favorites", favorites, exportedAt: new Date().toISOString() };
            const preview = document.getElementById("exportPreview");
            preview.textContent = JSON.stringify(data, null, 2);
            preview.classList.add("show");
            navigator.clipboard.writeText(JSON.stringify(data, null, 2)).then(() => showToast("Favorites copied"));
        }

        function exportText() {
            let text = "SOFT POWER\nSeason: Soft Summer\nUndertone: Cool-Neutral\n\n";
            Object.entries(paletteGroups).forEach(([name, colors]) => { 
                text += `${name}:\n${colors.map(c => `  ${colorNames[c] || c} (${c})`).join("\n")}\n\n`; 
            });
            if (favorites.length) text += `FAVORITES:\n${favorites.map(c => `  ${colorNames[c] || c} (${c})`).join("\n")}\n`;
            const preview = document.getElementById("exportPreview");
            preview.textContent = text;
            preview.classList.add("show");
            navigator.clipboard.writeText(text).then(() => showToast("Text copied"));
        }

        // Utilities
        function hexToRgb(hex) {
            const r = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return r ? { r: parseInt(r[1], 16), g: parseInt(r[2], 16), b: parseInt(r[3], 16) } : null;
        }

        function getLuminance(hex) {
            const rgb = hexToRgb(hex);
            const [r, g, b] = [rgb.r, rgb.g, rgb.b].map(v => { v /= 255; return v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4); });
            return 0.2126 * r + 0.7152 * g + 0.0722 * b;
        }

        function getContrastRatio(h1, h2) {
            const l1 = getLuminance(h1), l2 = getLuminance(h2);
            return (Math.max(l1, l2) + 0.05) / (Math.min(l1, l2) + 0.05);
        }

        function colorDistance(h1, h2) {
            const c1 = hexToRgb(h1), c2 = hexToRgb(h2);
            return Math.sqrt(Math.pow(c1.r - c2.r, 2) + Math.pow(c1.g - c2.g, 2) + Math.pow(c1.b - c2.b, 2));
        }

        function shuffle(arr) {
            for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [arr[i], arr[j]] = [arr[j], arr[i]]; }
            return arr;
        }

        function colorNameToHex(name) {
            const colors = { "dusty rose": "#B89095", "sage": "#889B82", "mauve": "#B38A8E", "lavender": "#8878A0", "teal": "#5B7B7E", "navy": "#3E4A5C", "cream": "#F5F2ED", "taupe": "#9E958C", "blush": "#D4AFB3", "rose": "#C9A0A5", "grey": "#8A8D8E", "gray": "#8A8D8E", "charcoal": "#4A4F52", "slate": "#6B7885", "cocoa": "#6E5C52", "raspberry": "#8E5B68", "periwinkle": "#98AABB", "moss": "#6B7C6A", "pink": "#D4B8BA", "blue": "#7088A0", "green": "#92A28E", "purple": "#9A8CAE", "brown": "#7F6D62" };
            return colors[name.toLowerCase()] || null;
        }

        document.addEventListener("keydown", e => {
            if (e.key === "Escape") {
                if (document.getElementById("whisperMode").classList.contains("active")) {
                    closeWhisper();
                } else if (document.getElementById("colorDetail").classList.contains("show")) {
                    closeColorDetail();
                }
            }
            if (!document.getElementById("whisperMode").classList.contains("active")) return;
            if (e.key === "ArrowLeft") whisperPrev();
            if (e.key === "ArrowRight") whisperNext();
        });
    </script>
<script src="../assets/gate.js"></script>
</body>
</html>
