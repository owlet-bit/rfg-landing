<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Verdant Alchemist - Personal Color Analysis</title>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --deep-forest: #1a2e1f;
  --moss-shadow: #2d3e2f;
  --verdigris: #4a7c59;
  --antique-gold: #c9a227;
  --warm-ivory: #f5f0e6;
  --dried-rose: #9e6b6b;
  --ink: #1a1a1a;
  --parchment: #e8e2d5;
  --copper-patina: #5a7d6a;
  --burgundy-wine: #722f37;
}

html { font-size: 16px; }

body {
  font-family: Georgia, "Times New Roman", serif;
  background: linear-gradient(135deg, var(--deep-forest) 0%, #0f1a12 50%, #1a2418 100%);
  color: var(--warm-ivory);
  min-height: 100vh;
  line-height: 1.6;
  overflow-x: hidden;
}

/* Scrollbar */
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: var(--deep-forest); }
::-webkit-scrollbar-thumb { background: var(--verdigris); border-radius: 4px; }

/* Main Container */
.grimoire {
  max-width: 100%;
  margin: 0 auto;
  padding: 20px;
  position: relative;
}

@media (min-width: 768px) {
  .grimoire { max-width: 900px; padding: 40px; }
}

/* Header */
.tome-header {
  text-align: center;
  padding: 40px 20px;
  border-bottom: 1px solid var(--verdigris);
  margin-bottom: 40px;
  position: relative;
}

.tome-header::before {
  content: "";
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 60px;
  height: 2px;
  background: var(--antique-gold);
}

.palette-title {
  font-size: clamp(1.8rem, 5vw, 2.8rem);
  font-weight: normal;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  color: var(--antique-gold);
  margin-bottom: 8px;
  text-shadow: 0 2px 20px rgba(201, 162, 39, 0.3);
}

.palette-subtitle {
  font-style: italic;
  color: var(--copper-patina);
  font-size: 1rem;
  letter-spacing: 0.1em;
}

/* Navigation Tabs */
.chapter-nav {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: center;
  margin-bottom: 40px;
  padding: 0 10px;
}

.chapter-tab {
  background: transparent;
  border: 1px solid var(--verdigris);
  color: var(--warm-ivory);
  padding: 12px 20px;
  font-family: inherit;
  font-size: 0.85rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s ease;
  min-height: 48px;
}

.chapter-tab:hover, .chapter-tab.active {
  background: var(--verdigris);
  color: var(--deep-forest);
  box-shadow: 0 0 20px rgba(74, 124, 89, 0.3);
}

/* Chapter Sections */
.chapter {
  display: none;
  animation: fadeIn 0.5s ease;
}

.chapter.active { display: block; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.chapter-title {
  font-size: 1.4rem;
  color: var(--antique-gold);
  text-align: center;
  margin-bottom: 30px;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  position: relative;
}

.chapter-title::after {
  content: "";
  display: block;
  width: 40px;
  height: 1px;
  background: var(--antique-gold);
  margin: 15px auto 0;
}

/* Analysis Text */
.analysis-text {
  max-width: 650px;
  margin: 0 auto 40px;
  text-align: justify;
  font-size: 1rem;
  line-height: 1.8;
  color: var(--parchment);
}

.analysis-text p { margin-bottom: 1.5em; }

.analysis-text .drop-cap::first-letter {
  float: left;
  font-size: 3.5em;
  line-height: 0.8;
  padding-right: 10px;
  color: var(--antique-gold);
  font-weight: normal;
}

.season-badge {
  display: inline-block;
  background: var(--burgundy-wine);
  color: var(--warm-ivory);
  padding: 8px 20px;
  font-size: 0.85rem;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  margin: 20px 0;
}

/* Source Pigments */
.pigment-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 20px;
  margin-bottom: 40px;
}

.pigment-card {
  text-align: center;
  padding: 15px;
  background: rgba(0,0,0,0.3);
  border: 1px solid var(--moss-shadow);
  transition: all 0.3s ease;
}

.pigment-card:hover {
  border-color: var(--antique-gold);
  transform: translateY(-3px);
}

.pigment-swatch {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  margin: 0 auto 12px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.4), inset 0 2px 10px rgba(255,255,255,0.1);
  cursor: pointer;
  transition: transform 0.2s ease;
}

.pigment-swatch:hover { transform: scale(1.1); }

.pigment-label {
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--copper-patina);
  margin-bottom: 4px;
}

.pigment-name {
  font-style: italic;
  font-size: 0.9rem;
  color: var(--warm-ivory);
  margin-bottom: 4px;
}

.pigment-hex {
  font-family: "Courier New", monospace;
  font-size: 0.75rem;
  color: var(--verdigris);
}

/* Palette Grid */
.palette-section {
  margin-bottom: 50px;
}

.palette-section-title {
  font-size: 1rem;
  color: var(--dried-rose);
  letter-spacing: 0.2em;
  text-transform: uppercase;
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 1px solid var(--moss-shadow);
}

.palette-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
  gap: 10px;
}

@media (min-width: 768px) {
  .palette-grid { grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); }
}

.color-swatch {
  aspect-ratio: 1;
  min-height: 60px;
  cursor: pointer;
  position: relative;
  transition: all 0.2s ease;
  border: 2px solid transparent;
}

.color-swatch:hover {
  transform: scale(1.08);
  z-index: 10;
  box-shadow: 0 8px 25px rgba(0,0,0,0.5);
}

.color-swatch.favorite::after {
  content: "";
  position: absolute;
  top: 4px;
  right: 4px;
  width: 12px;
  height: 12px;
  background: var(--antique-gold);
  clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
}

.color-swatch .tooltip {
  position: absolute;
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  background: var(--ink);
  color: var(--warm-ivory);
  padding: 6px 10px;
  font-size: 0.7rem;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s ease;
  z-index: 100;
  border: 1px solid var(--verdigris);
}

.color-swatch:hover .tooltip { opacity: 1; }

/* Toast Notification */
.toast {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: var(--antique-gold);
  color: var(--deep-forest);
  padding: 14px 28px;
  font-size: 0.85rem;
  letter-spacing: 0.05em;
  z-index: 1000;
  transition: transform 0.3s ease;
  box-shadow: 0 5px 25px rgba(0,0,0,0.4);
}

.toast.show { transform: translateX(-50%) translateY(0); }

/* Favorites Panel */
.favorites-empty {
  text-align: center;
  padding: 60px 20px;
  color: var(--copper-patina);
  font-style: italic;
}

.favorites-empty::before {
  content: "";
  display: block;
  width: 40px;
  height: 40px;
  margin: 0 auto 20px;
  border: 2px solid var(--moss-shadow);
  border-radius: 50%;
}

/* Compare Tool */
.compare-container {
  display: flex;
  flex-direction: column;
  gap: 20px;
  align-items: center;
}

@media (min-width: 600px) {
  .compare-container { flex-direction: row; justify-content: center; }
}

.compare-slot {
  width: 150px;
  height: 150px;
  border: 2px dashed var(--moss-shadow);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.8rem;
  color: var(--copper-patina);
  text-align: center;
  padding: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.compare-slot.filled {
  border-style: solid;
  border-color: var(--antique-gold);
}

.compare-slot:hover { border-color: var(--verdigris); }

.compare-slot.awaiting {
  border-color: var(--antique-gold);
  animation: pulse-outline 1s infinite;
}

.compare-verdict {
  max-width: 500px;
  margin: 30px auto;
  text-align: center;
  padding: 25px;
  background: rgba(0,0,0,0.3);
  border-left: 3px solid var(--antique-gold);
}

.compare-verdict h4 {
  color: var(--antique-gold);
  margin-bottom: 10px;
  font-weight: normal;
  letter-spacing: 0.1em;
}

/* Looks Gallery */
.looks-grid {
  display: grid;
  gap: 30px;
}

.look-card {
  background: rgba(0,0,0,0.25);
  border: 1px solid var(--moss-shadow);
  padding: 25px;
  transition: all 0.3s ease;
}

.look-card:hover {
  border-color: var(--verdigris);
  box-shadow: 0 5px 30px rgba(0,0,0,0.3);
}

.look-title {
  font-size: 1.1rem;
  color: var(--antique-gold);
  margin-bottom: 15px;
  font-style: italic;
}

.look-colors {
  display: flex;
  gap: 8px;
  margin-bottom: 15px;
  flex-wrap: wrap;
}

.look-color {
  width: 44px;
  height: 44px;
  cursor: pointer;
  transition: transform 0.2s ease;
}

.look-color:hover { transform: scale(1.15); }

.look-description {
  font-size: 0.9rem;
  color: var(--parchment);
  line-height: 1.7;
}

.look-tags {
  margin-top: 12px;
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.look-tag {
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--copper-patina);
  background: rgba(74, 124, 89, 0.2);
  padding: 4px 10px;
}

/* Export Panel */
.export-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  justify-content: center;
  margin-bottom: 30px;
}

.export-btn {
  background: transparent;
  border: 1px solid var(--verdigris);
  color: var(--warm-ivory);
  padding: 14px 28px;
  font-family: inherit;
  font-size: 0.85rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s ease;
  min-height: 48px;
}

.export-btn:hover {
  background: var(--verdigris);
  color: var(--deep-forest);
}

.export-preview {
  background: rgba(0,0,0,0.4);
  padding: 20px;
  font-family: "Courier New", monospace;
  font-size: 0.8rem;
  max-height: 300px;
  overflow-y: auto;
  white-space: pre-wrap;
  word-break: break-all;
  color: var(--copper-patina);
  border: 1px solid var(--moss-shadow);
}

/* Special Features */

/* Feature: Time of Day */
.time-selector {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-bottom: 30px;
  flex-wrap: wrap;
}

.time-btn {
  background: transparent;
  border: 1px solid var(--moss-shadow);
  color: var(--copper-patina);
  padding: 10px 18px;
  font-family: inherit;
  font-size: 0.8rem;
  cursor: pointer;
  transition: all 0.3s ease;
  min-height: 44px;
}

.time-btn.active, .time-btn:hover {
  border-color: var(--antique-gold);
  color: var(--antique-gold);
}

.time-preview {
  width: 100%;
  max-width: 400px;
  height: 200px;
  margin: 0 auto 20px;
  transition: all 0.5s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.time-swatch-demo {
  width: 80px;
  height: 80px;
  transition: all 0.5s ease;
}

.time-description {
  text-align: center;
  font-style: italic;
  color: var(--parchment);
  max-width: 500px;
  margin: 0 auto;
}

/* Feature: Harmony Wheel */
.harmony-container {
  text-align: center;
  margin-bottom: 30px;
}

.harmony-wheel {
  width: 250px;
  height: 250px;
  margin: 0 auto 20px;
  position: relative;
  border-radius: 50%;
  background: conic-gradient(
    #e63946, #f4a261, #e9c46a, #8ac926, 
    #06d6a0, #118ab2, #073b4c, #9d4edd, #e63946
  );
  opacity: 0.8;
}

.harmony-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 80px;
  height: 80px;
  background: var(--deep-forest);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.7rem;
  color: var(--copper-patina);
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

.harmony-type-btns {
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 20px;
}

.harmony-results {
  display: flex;
  justify-content: center;
  gap: 15px;
  flex-wrap: wrap;
}

.harmony-result {
  width: 60px;
  height: 60px;
  cursor: pointer;
  transition: transform 0.2s ease;
}

.harmony-result:hover { transform: scale(1.15); }

/* Feature: Fabric Finder */
.fabric-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 20px;
  margin-top: 30px;
}

.fabric-card {
  text-align: center;
  padding: 20px 15px;
  background: rgba(0,0,0,0.2);
  border: 1px solid var(--moss-shadow);
  transition: all 0.3s ease;
}

.fabric-card:hover {
  border-color: var(--verdigris);
  transform: translateY(-3px);
}

.fabric-icon {
  font-size: 1.5rem;
  margin-bottom: 10px;
}

.fabric-name {
  font-size: 0.9rem;
  color: var(--warm-ivory);
  margin-bottom: 8px;
}

.fabric-note {
  font-size: 0.75rem;
  color: var(--copper-patina);
  font-style: italic;
}

/* Feature: Seasonal Journey */
.journey-timeline {
  position: relative;
  padding-left: 30px;
  margin-top: 30px;
}

.journey-timeline::before {
  content: "";
  position: absolute;
  left: 8px;
  top: 0;
  bottom: 0;
  width: 2px;
  background: linear-gradient(to bottom, var(--antique-gold), var(--verdigris), var(--burgundy-wine), var(--copper-patina));
}

.journey-month {
  position: relative;
  margin-bottom: 25px;
  padding-left: 20px;
}

.journey-month::before {
  content: "";
  position: absolute;
  left: -26px;
  top: 5px;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  border: 2px solid var(--antique-gold);
  background: var(--deep-forest);
}

.journey-month-name {
  font-size: 0.85rem;
  color: var(--antique-gold);
  letter-spacing: 0.15em;
  text-transform: uppercase;
  margin-bottom: 8px;
}

.journey-colors {
  display: flex;
  gap: 6px;
}

.journey-color {
  width: 30px;
  height: 30px;
  cursor: pointer;
}

/* Feature: Mood Mixer */
.mood-container {
  text-align: center;
}

.mood-input {
  display: flex;
  gap: 10px;
  justify-content: center;
  flex-wrap: wrap;
  margin-bottom: 30px;
}

.mood-btn {
  background: transparent;
  border: 1px solid var(--moss-shadow);
  color: var(--copper-patina);
  padding: 12px 20px;
  font-family: inherit;
  font-size: 0.8rem;
  cursor: pointer;
  transition: all 0.3s ease;
  min-height: 44px;
}

.mood-btn.active {
  border-color: var(--antique-gold);
  color: var(--antique-gold);
  background: rgba(201, 162, 39, 0.1);
}

.mood-btn:hover { border-color: var(--verdigris); }

.mood-result-colors {
  display: flex;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
}

.mood-color {
  width: 50px;
  height: 50px;
  cursor: pointer;
  transition: transform 0.2s ease;
}

.mood-color:hover { transform: scale(1.15); }

/* Feature: Luminosity Slider */
.luminosity-container {
  text-align: center;
  margin-top: 30px;
}

.luminosity-slider {
  width: 100%;
  max-width: 400px;
  height: 20px;
  -webkit-appearance: none;
  background: linear-gradient(to right, #1a1a1a, #808080, #ffffff);
  border-radius: 10px;
  margin-bottom: 20px;
}

.luminosity-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 30px;
  height: 30px;
  background: var(--antique-gold);
  border-radius: 50%;
  cursor: pointer;
}

.luminosity-colors {
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
}

.luminosity-swatch {
  width: 50px;
  height: 50px;
  cursor: pointer;
  transition: all 0.3s ease;
}

/* Feature: Personal Almanac */
.almanac-entry {
  background: rgba(0,0,0,0.2);
  border-left: 3px solid var(--antique-gold);
  padding: 20px;
  margin-bottom: 20px;
}

.almanac-date {
  font-size: 0.75rem;
  color: var(--copper-patina);
  letter-spacing: 0.1em;
  text-transform: uppercase;
  margin-bottom: 8px;
}

.almanac-note {
  color: var(--parchment);
  font-style: italic;
}

.almanac-form {
  display: flex;
  flex-direction: column;
  gap: 15px;
  max-width: 500px;
  margin: 30px auto 0;
}

.almanac-textarea {
  background: rgba(0,0,0,0.3);
  border: 1px solid var(--moss-shadow);
  color: var(--warm-ivory);
  padding: 15px;
  font-family: inherit;
  font-size: 0.9rem;
  min-height: 100px;
  resize: vertical;
}

.almanac-textarea:focus {
  outline: none;
  border-color: var(--verdigris);
}

/* Feature: Ritual Generator */
.ritual-card {
  background: linear-gradient(135deg, rgba(114, 47, 55, 0.2), rgba(74, 124, 89, 0.2));
  border: 1px solid var(--burgundy-wine);
  padding: 30px;
  text-align: center;
  margin-top: 30px;
}

.ritual-title {
  font-size: 1.1rem;
  color: var(--antique-gold);
  margin-bottom: 20px;
  font-style: italic;
}

.ritual-colors {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-bottom: 20px;
}

.ritual-color {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
}

.ritual-text {
  font-size: 0.9rem;
  color: var(--parchment);
  line-height: 1.8;
  max-width: 500px;
  margin: 0 auto;
}

.ritual-btn {
  margin-top: 25px;
  background: transparent;
  border: 1px solid var(--antique-gold);
  color: var(--antique-gold);
  padding: 12px 30px;
  font-family: inherit;
  font-size: 0.85rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s ease;
  min-height: 48px;
}

.ritual-btn:hover {
  background: var(--antique-gold);
  color: var(--deep-forest);
}

/* Feature: Chromatic Memory */
.memory-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
  margin-top: 20px;
}

.memory-day {
  aspect-ratio: 1;
  min-height: 30px;
  background: rgba(0,0,0,0.3);
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
}

.memory-day:hover { transform: scale(1.1); z-index: 5; }

.memory-day.today { border: 2px solid var(--antique-gold); }

.memory-day.selected {
  outline: 2px solid var(--antique-gold);
  animation: pulse-outline 1s infinite;
}

@keyframes pulse-outline {
  0%, 100% { outline-color: var(--antique-gold); }
  50% { outline-color: var(--verdigris); }
}

/* Selection mode banner */
.selection-banner {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: var(--antique-gold);
  color: var(--deep-forest);
  text-align: center;
  padding: 12px 20px;
  font-size: 0.9rem;
  letter-spacing: 0.05em;
  z-index: 999;
  transform: translateY(-100%);
  transition: transform 0.3s ease;
}

.selection-banner.show {
  transform: translateY(0);
}

.selection-banner button {
  background: var(--deep-forest);
  color: var(--warm-ivory);
  border: none;
  padding: 6px 16px;
  margin-left: 15px;
  font-family: inherit;
  font-size: 0.8rem;
  cursor: pointer;
}

.memory-labels {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
  margin-bottom: 8px;
}

.memory-label {
  font-size: 0.65rem;
  color: var(--copper-patina);
  text-align: center;
  text-transform: uppercase;
}

/* Footer */
.tome-footer {
  text-align: center;
  padding: 40px 20px;
  margin-top: 60px;
  border-top: 1px solid var(--moss-shadow);
}

.tome-footer p {
  font-size: 0.75rem;
  color: var(--copper-patina);
  letter-spacing: 0.1em;
}

/* Modal */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.85);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 20px;
}

.modal-overlay.show { display: flex; }

.modal-content {
  background: var(--deep-forest);
  border: 1px solid var(--verdigris);
  padding: 30px;
  max-width: 400px;
  width: 100%;
  text-align: center;
}

.modal-swatch {
  width: 120px;
  height: 120px;
  margin: 0 auto 20px;
}

.modal-name {
  font-size: 1.2rem;
  color: var(--antique-gold);
  margin-bottom: 8px;
}

.modal-hex {
  font-family: "Courier New", monospace;
  color: var(--copper-patina);
  margin-bottom: 20px;
}

.modal-close {
  background: transparent;
  border: 1px solid var(--moss-shadow);
  color: var(--warm-ivory);
  padding: 12px 30px;
  font-family: inherit;
  cursor: pointer;
  transition: all 0.3s ease;
  min-height: 44px;
}

.modal-close:hover { border-color: var(--verdigris); }
</style>
</head>
<body>

<div class="grimoire">
  <header class="tome-header">
    <h1 class="palette-title">The Verdant Alchemist</h1>
    <p class="palette-subtitle">A Personal Chromatic Grimoire</p>
  </header>

  <nav class="chapter-nav">
    <button class="chapter-tab active" data-chapter="analysis">Analysis</button>
    <button class="chapter-tab" data-chapter="pigments">Pigments</button>
    <button class="chapter-tab" data-chapter="palette">Palette</button>
    <button class="chapter-tab" data-chapter="looks">Looks</button>
    <button class="chapter-tab" data-chapter="alchemy">Alchemy</button>
    <button class="chapter-tab" data-chapter="favorites">Favorites</button>
    <button class="chapter-tab" data-chapter="export">Export</button>
  </nav>

  <!-- CHAPTER: Analysis -->
  <section class="chapter active" id="analysis">
    <h2 class="chapter-title">The Reading</h2>
    
    <div class="analysis-text">
      <p class="drop-cap">You possess the rare coloring of autumn light filtered through cathedral glass - a luminous neutrality that leans ever so slightly toward the golden warmth of aged honey and sun-bleached meadows. Your skin carries the translucent quality of fine porcelain, revealing a complex underlayer of cool violet-pink veins beneath a surface kissed with warm peachy tones. This push-pull between cool depth and warm surface creates an extraordinary canvas that can harmonize with colors from multiple seasonal families, though your truest flattery lies in the realm of soft, muted warmth with strategic touches of cool clarity.</p>
      
      <p>Your eyes are a masterwork of natural artistry - a complex hazel-green that shifts like forest pools, carrying rings of golden amber around the pupil that dissolve into sage green, rimmed with a darker olive that grounds the entire composition. This chromatic complexity in your iris demands colors of equal sophistication; simple, flat hues will always feel insufficient beside such natural intricacy. Your hair echoes this complexity: a base of ash-kissed brown illuminated by golden and honey highlights that catch light like spun silk, creating a natural ombre that speaks to both warmth and coolness.</p>
      
      <p>The pink-rose tones of your lips and natural flush reveal an undertone sensitivity - you carry both warm coral capacity and cool rose possibility within your skin's repertoire. Your veins present in blue-violet, suggesting a cool undertone foundation, yet the surface warmth of your skin and the golden cast of your coloring places you firmly in the territory of the alchemist: one who can transmute and bridge the seasonal divide. You require colors with inherent complexity, soft saturation, and a certain aged quality - nothing too bright, nothing too stark, nothing too simple.</p>
    </div>

    <div style="text-align: center;">
      <span class="season-badge">Soft Autumn - Light Influenced</span>
    </div>
    
    <p class="analysis-text" style="text-align: center; font-style: italic; margin-top: 20px;">
      A muted warm season with exceptional capacity to borrow from Soft Summer's cooler tones, distinguished by your luminous skin clarity and complex hazel-green eyes.
    </p>
  </section>

  <!-- CHAPTER: Source Pigments -->
  <section class="chapter" id="pigments">
    <h2 class="chapter-title">Source Pigments</h2>
    <p class="analysis-text" style="text-align: center; margin-bottom: 40px;">
      These are the precise colors observed in your natural coloring - the alchemical ingredients from which your entire palette is derived.
    </p>
    
    <div class="pigment-grid" id="pigmentGrid">
      <!-- Generated by JS -->
    </div>
  </section>

  <!-- CHAPTER: Palette -->
  <section class="chapter" id="palette">
    <h2 class="chapter-title">The Complete Palette</h2>
    <p class="analysis-text" style="text-align: center; margin-bottom: 40px;">
      Click any swatch to copy its hex code. Double-click to mark as favorite.
    </p>
    
    <div id="paletteContainer">
      <!-- Generated by JS -->
    </div>
  </section>

  <!-- CHAPTER: Looks -->
  <section class="chapter" id="looks">
    <h2 class="chapter-title">Styled Looks</h2>
    <p class="analysis-text" style="text-align: center; margin-bottom: 40px;">
      Complete color stories for outfit and makeup coordination.
    </p>
    
    <div class="looks-grid" id="looksGrid">
      <!-- Generated by JS -->
    </div>
  </section>

  <!-- CHAPTER: Alchemy -->
  <section class="chapter" id="alchemy">
    <h2 class="chapter-title">Color Alchemy</h2>
    
    <!-- Compare Tool -->
    <div style="margin-bottom: 60px;">
      <h3 class="palette-section-title">The Comparison Chamber</h3>
      <p class="analysis-text" style="text-align: center;">
        Select two colors from any swatch to compare them side by side.
      </p>
      <div class="compare-container">
        <div class="compare-slot" id="compareSlot1" data-slot="1">
          Drop first color here
        </div>
        <div class="compare-slot" id="compareSlot2" data-slot="2">
          Drop second color here
        </div>
      </div>
      <div class="compare-verdict" id="compareVerdict" style="display: none;">
        <h4>The Verdict</h4>
        <p id="verdictText"></p>
      </div>
    </div>

    <!-- Time of Day -->
    <div style="margin-bottom: 60px;">
      <h3 class="palette-section-title">Lighting Transmutation</h3>
      <p class="analysis-text" style="text-align: center;">
        See how your colors transform under different light conditions.
      </p>
      <div class="time-selector">
        <button class="time-btn active" data-time="dawn">Dawn</button>
        <button class="time-btn" data-time="daylight">Daylight</button>
        <button class="time-btn" data-time="golden">Golden Hour</button>
        <button class="time-btn" data-time="candlelight">Candlelight</button>
        <button class="time-btn" data-time="moonlight">Moonlight</button>
      </div>
      <div class="time-preview" id="timePreview">
        <div class="time-swatch-demo" id="timeSwatch"></div>
      </div>
      <p class="time-description" id="timeDescription"></p>
    </div>

    <!-- Harmony Generator -->
    <div style="margin-bottom: 60px;">
      <h3 class="palette-section-title">Harmonic Resonance</h3>
      <p class="analysis-text" style="text-align: center;">
        Generate color harmonies from any color in your palette.
      </p>
      <div class="harmony-container">
        <div class="harmony-wheel">
          <div class="harmony-center">Select a swatch</div>
        </div>
        <div class="harmony-type-btns">
          <button class="time-btn" data-harmony="complement">Complement</button>
          <button class="time-btn" data-harmony="triadic">Triadic</button>
          <button class="time-btn" data-harmony="analogous">Analogous</button>
          <button class="time-btn" data-harmony="split">Split Complement</button>
        </div>
        <div class="harmony-results" id="harmonyResults"></div>
      </div>
    </div>

    <!-- Mood Mixer -->
    <div style="margin-bottom: 60px;">
      <h3 class="palette-section-title">Mood Elixir</h3>
      <p class="analysis-text" style="text-align: center;">
        Select your desired emotional resonance.
      </p>
      <div class="mood-container">
        <div class="mood-input">
          <button class="mood-btn" data-mood="powerful">Powerful</button>
          <button class="mood-btn" data-mood="romantic">Romantic</button>
          <button class="mood-btn" data-mood="mysterious">Mysterious</button>
          <button class="mood-btn" data-mood="serene">Serene</button>
          <button class="mood-btn" data-mood="joyful">Joyful</button>
        </div>
        <div class="mood-result-colors" id="moodColors"></div>
      </div>
    </div>

    <!-- Luminosity Filter -->
    <div style="margin-bottom: 60px;">
      <h3 class="palette-section-title">Luminosity Filter</h3>
      <p class="analysis-text" style="text-align: center;">
        Filter your palette by light to dark values.
      </p>
      <div class="luminosity-container">
        <input type="range" class="luminosity-slider" id="luminositySlider" min="0" max="100" value="50">
        <div class="luminosity-colors" id="luminosityColors"></div>
      </div>
    </div>

    <!-- Seasonal Journey -->
    <div style="margin-bottom: 60px;">
      <h3 class="palette-section-title">Seasonal Almanac</h3>
      <p class="analysis-text" style="text-align: center;">
        Your optimal colors shift with the natural year.
      </p>
      <div class="journey-timeline" id="seasonalJourney"></div>
    </div>

    <!-- Fabric Recommendations -->
    <div style="margin-bottom: 60px;">
      <h3 class="palette-section-title">Material Correspondences</h3>
      <p class="analysis-text" style="text-align: center;">
        Fabrics that enhance your chromatic essence.
      </p>
      <div class="fabric-grid" id="fabricGrid"></div>
    </div>

    <!-- Daily Ritual Generator -->
    <div style="margin-bottom: 60px;">
      <h3 class="palette-section-title">Daily Color Ritual</h3>
      <p class="analysis-text" style="text-align: center;">
        A randomized color intention for your day.
      </p>
      <div class="ritual-card" id="ritualCard">
        <p class="ritual-title" id="ritualTitle">Your Color Oracle</p>
        <div class="ritual-colors" id="ritualColors"></div>
        <p class="ritual-text" id="ritualText">Press the button to receive your daily chromatic guidance.</p>
        <button class="ritual-btn" id="ritualBtn">Cast the Colors</button>
      </div>
    </div>

    <!-- Chromatic Calendar -->
    <div style="margin-bottom: 60px;">
      <h3 class="palette-section-title">Chromatic Memory</h3>
      <p class="analysis-text" style="text-align: center;">
        Track your color choices. Click a day, then click a swatch to record.
      </p>
      <div class="memory-labels">
        <span class="memory-label">S</span>
        <span class="memory-label">M</span>
        <span class="memory-label">T</span>
        <span class="memory-label">W</span>
        <span class="memory-label">T</span>
        <span class="memory-label">F</span>
        <span class="memory-label">S</span>
      </div>
      <div class="memory-grid" id="memoryGrid"></div>
    </div>

    <!-- Color Journal -->
    <div>
      <h3 class="palette-section-title">Personal Almanac</h3>
      <p class="analysis-text" style="text-align: center;">
        Record your color observations and discoveries.
      </p>
      <div id="almanacEntries"></div>
      <div class="almanac-form">
        <textarea class="almanac-textarea" id="almanacInput" placeholder="Today I noticed that the sage green brings out the gold in my eyes when worn near my face..."></textarea>
        <button class="export-btn" id="almanacSave">Record Entry</button>
      </div>
      <div class="almanac-export-btns" id="almanacExportBtns" style="display: none; margin-top: 20px;">
        <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
          <button class="export-btn" id="exportAlmanacText">Export Diary (Text)</button>
          <button class="export-btn" id="exportAlmanacJSON">Export Diary (JSON)</button>
          <button class="export-btn" id="clearAlmanac" style="border-color: var(--burgundy-wine); color: var(--dried-rose);">Clear All Entries</button>
        </div>
      </div>
    </div>
  </section>

  <!-- CHAPTER: Favorites -->
  <section class="chapter" id="favorites">
    <h2 class="chapter-title">Treasured Colors</h2>
    <div id="favoritesContainer">
      <p class="favorites-empty">Double-click any swatch to begin your collection</p>
    </div>
  </section>

  <!-- CHAPTER: Export -->
  <section class="chapter" id="export">
    <h2 class="chapter-title">Export Your Grimoire</h2>
    <div class="export-buttons">
      <button class="export-btn" id="exportJSON">Export Full Palette (JSON)</button>
      <button class="export-btn" id="exportText">Export as Text List</button>
      <button class="export-btn" id="exportFavJSON">Export Favorites (JSON)</button>
      <button class="export-btn" id="exportFavText">Export Favorites (Text)</button>
    </div>
    <pre class="export-preview" id="exportPreview">Select an export option above to preview...</pre>
  </section>

  <footer class="tome-footer">
    <p>The Verdant Alchemist - A Personal Color Analysis</p>
  </footer>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- Selection Banner -->
<div class="selection-banner" id="selectionBanner">
  <span id="selectionText">Select a color swatch to record</span>
  <button id="cancelSelection">Cancel</button>
</div>

<!-- Modal -->
<div class="modal-overlay" id="modal">
  <div class="modal-content">
    <div class="modal-swatch" id="modalSwatch"></div>
    <p class="modal-name" id="modalName"></p>
    <p class="modal-hex" id="modalHex"></p>
    <button class="modal-close" id="modalClose">Close</button>
  </div>
</div>

<script>
// ========== DATA ==========

const sourcePigments = [
  { label: "Skin - Highlight", name: "Porcelain Veil", hex: "#F5E6DC" },
  { label: "Skin - Midtone", name: "Warm Bisque", hex: "#E8CDB5" },
  { label: "Skin - Shadow", name: "Rose Umber", hex: "#C9A593" },
  { label: "Natural Flush", name: "Petal Blush", hex: "#D4A5A5" },
  { label: "Lip - Natural", name: "Dusty Damask", hex: "#BF8B8B" },
  { label: "Lip - Deep", name: "Rosewood", hex: "#8B5A5A" },
  { label: "Eye - Outer Ring", name: "Forest Depths", hex: "#4A5D4A" },
  { label: "Eye - Iris", name: "Sage Smoke", hex: "#7D8B6A" },
  { label: "Eye - Inner", name: "Amber Pool", hex: "#9B8B5A" },
  { label: "Hair - Base", name: "Ash Wheat", hex: "#A89880" },
  { label: "Hair - Highlight", name: "Honeyed Flax", hex: "#C9B896" },
  { label: "Hair - Shadow", name: "Driftwood", hex: "#7A6B5A" },
  { label: "Vein - Cool", name: "Violet Shadow", hex: "#8B7B8B" },
  { label: "Brow", name: "Fawn", hex: "#6B5B4A" }
];

const paletteGroups = {
  "Verdant Depths - Greens": [
    { name: "Forest Cathedral", hex: "#2D5A3D" },
    { name: "Moss Velvet", hex: "#4A7C59" },
    { name: "Sage Mist", hex: "#87A07A" },
    { name: "Eucalyptus", hex: "#7D9B7A" },
    { name: "Olive Grove", hex: "#6B7B4A" },
    { name: "Fern Shadow", hex: "#3D5A3D" },
    { name: "Verdigris", hex: "#5A8B7A" },
    { name: "Jade Antiquity", hex: "#4A8B6A" }
  ],
  "Gilded Earth - Warm Neutrals": [
    { name: "Antique Gold", hex: "#C9A227" },
    { name: "Honeyed Brass", hex: "#B8963A" },
    { name: "Burnished Copper", hex: "#A67B4A" },
    { name: "Caramel Suede", hex: "#9B7B5A" },
    { name: "Toasted Wheat", hex: "#C9B896" },
    { name: "Aged Parchment", hex: "#D9C9A9" },
    { name: "Tawny Port", hex: "#8B5A3A" },
    { name: "Cinnamon Bark", hex: "#7A4A3A" }
  ],
  "Twilight Rose - Soft Warms": [
    { name: "Dusty Rose", hex: "#C9A5A5" },
    { name: "Terracotta Blush", hex: "#C99B8B" },
    { name: "Coral Antiquity", hex: "#D9A58B" },
    { name: "Apricot Glow", hex: "#E9B99B" },
    { name: "Peach Nectar", hex: "#E9C9AB" },
    { name: "Salmon Bisque", hex: "#D9A595" },
    { name: "Rose Quartz", hex: "#D9B9B9" },
    { name: "Muted Coral", hex: "#C9978B" }
  ],
  "Burgundy Library - Deep Warms": [
    { name: "Burgundy Wine", hex: "#722F37" },
    { name: "Mahogany", hex: "#6A3B3B" },
    { name: "Oxblood", hex: "#5A2A2A" },
    { name: "Dried Fig", hex: "#6B4A4A" },
    { name: "Plum Preserve", hex: "#5A3A4A" },
    { name: "Burnt Sienna", hex: "#8B4A3A" },
    { name: "Russet", hex: "#7A4A2A" },
    { name: "Claret", hex: "#6B2A3A" }
  ],
  "Soft Summer Whispers - Borrowed Cools": [
    { name: "Dusty Lavender", hex: "#9B8BA5" },
    { name: "Soft Mauve", hex: "#A59B9B" },
    { name: "Pewter Rose", hex: "#8B7B7B" },
    { name: "Dove Grey", hex: "#9B9B9B" },
    { name: "Misty Heather", hex: "#8B8B9B" },
    { name: "Cocoa Ash", hex: "#7B6B6B" },
    { name: "Slate Rose", hex: "#8B7B8B" },
    { name: "Mushroom", hex: "#9B8B8B" }
  ],
  "Oceanic Depths - Teals and Blues": [
    { name: "Deep Teal", hex: "#2A5B5B" },
    { name: "Stormy Jade", hex: "#4A7B7B" },
    { name: "Peacock Shadow", hex: "#3A5B5A" },
    { name: "Spruce", hex: "#3A5A4A" },
    { name: "Baltic Sea", hex: "#4A6B6B" },
    { name: "Muted Turquoise", hex: "#5A8B8B" },
    { name: "Patina", hex: "#6A9B8B" },
    { name: "Storm Cloud", hex: "#5A6B7B" }
  ]
};

const styledLooks = [
  {
    title: "The Scholarly Enchantress",
    colors: ["#2D5A3D", "#C9A227", "#F5E6DC", "#722F37", "#6B5B4A"],
    description: "A deep forest green blazer over cream silk, with antique gold jewelry and burgundy lip. This is intellectual glamour - the woman who quotes poetry and closes deals.",
    tags: ["Professional", "Autumn", "Statement"]
  },
  {
    title: "Gilded Twilight",
    colors: ["#C9A5A5", "#B8963A", "#E9C9AB", "#8B5A5A", "#87A07A"],
    description: "Dusty rose dress with honeyed brass accessories, muted sage accents. Soft rosewood lip, peachy blush. For evenings that shimmer with possibility.",
    tags: ["Evening", "Romantic", "Soft"]
  },
  {
    title: "Forest Floor",
    colors: ["#4A7C59", "#7A4A3A", "#C9B896", "#3D5A3D", "#9B8B8B"],
    description: "Layered sage and moss with cinnamon leather, toasted wheat knits, mushroom accessories. Minimal makeup, natural brows, tinted lip balm.",
    tags: ["Casual", "Earth", "Layered"]
  },
  {
    title: "The Burgundy Ritual",
    colors: ["#722F37", "#C9A227", "#F5E6DC", "#5A3A4A", "#9B8BA5"],
    description: "Head-to-toe burgundy with gold accents, dusty lavender as the unexpected third. Bold rosewood lip, subtle gold on the inner corners of eyes.",
    tags: ["Drama", "Winter", "Monochrome"]
  },
  {
    title: "Oceanic Mystery",
    colors: ["#2A5B5B", "#5A8B8B", "#E8CDB5", "#6A9B8B", "#7B6B6B"],
    description: "Deep teal jacket, muted turquoise silk scarf, warm bisque base. Cocoa ash eye shadow, nude lip with the barest hint of rose. For days when you want to feel like a secret.",
    tags: ["Cool", "Sophisticated", "Quiet Power"]
  },
  {
    title: "Harvest Moon",
    colors: ["#D9A58B", "#6B7B4A", "#E9B99B", "#8B4A3A", "#D9C9A9"],
    description: "Coral antiquity dress, olive belt, burnt sienna boots. Apricot blush high on cheekbones, terracotta lip. The warmth of October incarnate.",
    tags: ["Daytime", "Warm", "Natural"]
  },
  {
    title: "Victorian SÃ©ance",
    colors: ["#5A2A2A", "#8B7B8B", "#9B8BA5", "#C9A227", "#4A5D4A"],
    description: "Oxblood velvet, slate rose lace, dusty lavender undertones, touches of antique gold. Deep wine lip, smudged violet-grey at the lash line. For when you commune with the sublime.",
    tags: ["Evening", "Gothic", "Romantic"]
  }
];

const fabrics = [
  { name: "Silk Charmeuse", note: "Reflects your luminosity", icon: "~" },
  { name: "Cashmere", note: "Echoes your soft warmth", icon: "o" },
  { name: "Velvet", note: "Deepens your rich tones", icon: "#" },
  { name: "Linen", note: "Grounds with organic texture", icon: "|" },
  { name: "Wool Crepe", note: "Sophisticated matte finish", icon: "=" },
  { name: "Burnout Silk", note: "Layered luminosity", icon: "*" }
];

const seasonalColors = {
  "January": ["#722F37", "#2D5A3D", "#C9A227", "#5A3A4A"],
  "February": ["#8B7B8B", "#5A2A2A", "#C9A5A5", "#4A5D4A"],
  "March": ["#87A07A", "#D9B9B9", "#7D9B7A", "#B8963A"],
  "April": ["#4A7C59", "#E9C9AB", "#6B7B4A", "#D9A58B"],
  "May": ["#6A9B8B", "#E9B99B", "#4A8B6A", "#C9B896"],
  "June": ["#5A8B8B", "#E8CDB5", "#4A7B7B", "#D9C9A9"],
  "July": ["#2A5B5B", "#F5E6DC", "#3A5B5A", "#C99B8B"],
  "August": ["#6B7B4A", "#D9A58B", "#4A7C59", "#C9978B"],
  "September": ["#8B4A3A", "#C9A227", "#6A3B3B", "#87A07A"],
  "October": ["#722F37", "#B8963A", "#5A2A2A", "#9B7B5A"],
  "November": ["#7A4A3A", "#C9A5A5", "#6B5B4A", "#8B7B8B"],
  "December": ["#2D5A3D", "#C9A227", "#722F37", "#9B8BA5"]
};

const moods = {
  powerful: ["#722F37", "#2D5A3D", "#C9A227", "#5A2A2A", "#3D5A3D"],
  romantic: ["#C9A5A5", "#D9B9B9", "#9B8BA5", "#BF8B8B", "#E9C9AB"],
  mysterious: ["#4A5D4A", "#5A3A4A", "#2A5B5B", "#8B7B8B", "#3A5B5A"],
  serene: ["#87A07A", "#9B9B9B", "#7D9B7A", "#D9C9A9", "#5A8B8B"],
  joyful: ["#D9A58B", "#C9A227", "#E9B99B", "#4A8B6A", "#C99B8B"]
};

const rituals = [
  { title: "Grounding", colors: ["#6B5B4A", "#4A7C59", "#A89880"], text: "Today calls for earth tones to anchor your presence. Wear these close to your body - as a scarf, as a base layer, as intention." },
  { title: "Illumination", colors: ["#C9A227", "#F5E6DC", "#B8963A"], text: "Gold and light want to find you today. Let yourself be seen. Wear these where they catch light - at your throat, your wrists, your ears." },
  { title: "Mystery", colors: ["#2D5A3D", "#5A3A4A", "#8B7B8B"], text: "The veil is thin. Dress in layers, in depth, in colors that reveal themselves slowly. You are not required to explain yourself today." },
  { title: "Tenderness", colors: ["#C9A5A5", "#E9C9AB", "#BF8B8B"], text: "Soft warmth is your armor today. These colors will remind everyone who sees you - and most importantly, you - of your inherent gentleness." },
  { title: "Power", colors: ["#722F37", "#C9A227", "#5A2A2A"], text: "Burgundy and gold: the colors of queens and scholars. Wear these when you need to remember your own authority." }
];

// ========== STATE ==========

let favorites = JSON.parse(localStorage.getItem("verdant-favorites")) || {};
let compareColors = [null, null];
let selectedHarmonyColor = null;
let selectedDay = null;
let chromaticMemory = JSON.parse(localStorage.getItem("verdant-memory")) || {};
let almanacEntries = JSON.parse(localStorage.getItem("verdant-almanac")) || [];

// ========== UTILITIES ==========

function showToast(message) {
  const toast = document.getElementById("toast");
  toast.textContent = message;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 2000);
}

function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => {
    showToast("Copied: " + text);
  });
}

function hexToHSL(hex) {
  let r = parseInt(hex.slice(1, 3), 16) / 255;
  let g = parseInt(hex.slice(3, 5), 16) / 255;
  let b = parseInt(hex.slice(5, 7), 16) / 255;
  let max = Math.max(r, g, b), min = Math.min(r, g, b);
  let h, s, l = (max + min) / 2;
  if (max === min) { h = s = 0; }
  else {
    let d = max - min;
    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
    switch (max) {
      case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
      case g: h = ((b - r) / d + 2) / 6; break;
      case b: h = ((r - g) / d + 4) / 6; break;
    }
  }
  return { h: h * 360, s: s * 100, l: l * 100 };
}

function hslToHex(h, s, l) {
  s /= 100; l /= 100;
  const a = s * Math.min(l, 1 - l);
  const f = n => {
    const k = (n + h / 30) % 12;
    const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
    return Math.round(255 * color).toString(16).padStart(2, "0");
  };
  return "#" + f(0) + f(8) + f(4);
}

function saveFavorites() {
  localStorage.setItem("verdant-favorites", JSON.stringify(favorites));
}

function saveMemory() {
  localStorage.setItem("verdant-memory", JSON.stringify(chromaticMemory));
}

function saveAlmanac() {
  localStorage.setItem("verdant-almanac", JSON.stringify(almanacEntries));
}

// ========== RENDERING ==========

function renderPigments() {
  const grid = document.getElementById("pigmentGrid");
  grid.innerHTML = sourcePigments.map(p => `
    <div class="pigment-card">
      <div class="pigment-swatch" style="background: ${p.hex};" data-hex="${p.hex}" data-name="${p.name}"></div>
      <p class="pigment-label">${p.label}</p>
      <p class="pigment-name">${p.name}</p>
      <p class="pigment-hex">${p.hex}</p>
    </div>
  `).join("");
}

function renderPalette() {
  const container = document.getElementById("paletteContainer");
  container.innerHTML = Object.entries(paletteGroups).map(([group, colors]) => `
    <div class="palette-section">
      <h3 class="palette-section-title">${group}</h3>
      <div class="palette-grid">
        ${colors.map(c => `
          <div class="color-swatch ${favorites[c.hex] ? "favorite" : ""}" 
               style="background: ${c.hex};" 
               data-hex="${c.hex}" 
               data-name="${c.name}">
            <span class="tooltip">${c.name}<br>${c.hex}</span>
          </div>
        `).join("")}
      </div>
    </div>
  `).join("");
}

function renderLooks() {
  const grid = document.getElementById("looksGrid");
  grid.innerHTML = styledLooks.map(look => `
    <div class="look-card">
      <h4 class="look-title">${look.title}</h4>
      <div class="look-colors">
        ${look.colors.map(c => `
          <div class="look-color" style="background: ${c};" data-hex="${c}" data-name="${look.title} color"></div>
        `).join("")}
      </div>
      <p class="look-description">${look.description}</p>
      <div class="look-tags">
        ${look.tags.map(t => `<span class="look-tag">${t}</span>`).join("")}
      </div>
    </div>
  `).join("");
}

function renderFavorites() {
  const container = document.getElementById("favoritesContainer");
  const favList = Object.entries(favorites);
  
  if (favList.length === 0) {
    container.innerHTML = '<p class="favorites-empty">Double-click any swatch to begin your collection</p>';
    return;
  }
  
  container.innerHTML = `
    <div class="palette-grid">
      ${favList.map(([hex, name]) => `
        <div class="color-swatch favorite" style="background: ${hex};" data-hex="${hex}" data-name="${name}">
          <span class="tooltip">${name}<br>${hex}</span>
        </div>
      `).join("")}
    </div>
  `;
}

function renderFabrics() {
  const grid = document.getElementById("fabricGrid");
  grid.innerHTML = fabrics.map(f => `
    <div class="fabric-card">
      <div class="fabric-icon">${f.icon}</div>
      <p class="fabric-name">${f.name}</p>
      <p class="fabric-note">${f.note}</p>
    </div>
  `).join("");
}

function renderSeasonalJourney() {
  const timeline = document.getElementById("seasonalJourney");
  timeline.innerHTML = Object.entries(seasonalColors).map(([month, colors]) => `
    <div class="journey-month">
      <p class="journey-month-name">${month}</p>
      <div class="journey-colors">
        ${colors.map(c => `
          <div class="journey-color" style="background: ${c};" data-hex="${c}" data-name="${month} color"></div>
        `).join("")}
      </div>
    </div>
  `).join("");
}

function renderMemoryGrid() {
  const grid = document.getElementById("memoryGrid");
  const today = new Date();
  const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
  const startDay = startOfMonth.getDay();
  const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
  
  let html = "";
  
  // Empty cells before first day
  for (let i = 0; i < startDay; i++) {
    html += '<div class="memory-day" style="opacity: 0.3;"></div>';
  }
  
  // Days of month
  for (let d = 1; d <= daysInMonth; d++) {
    const dateKey = `${today.getFullYear()}-${today.getMonth() + 1}-${d}`;
    const savedColor = chromaticMemory[dateKey];
    const isToday = d === today.getDate();
    html += `
      <div class="memory-day ${isToday ? "today" : ""}" 
           data-date="${dateKey}"
           style="background: ${savedColor || "rgba(0,0,0,0.3)"};">
      </div>
    `;
  }
  
  grid.innerHTML = html;
}

function renderAlmanac() {
  const container = document.getElementById("almanacEntries");
  const exportBtns = document.getElementById("almanacExportBtns");
  
  if (almanacEntries.length === 0) {
    container.innerHTML = "";
    if (exportBtns) exportBtns.style.display = "none";
    return;
  }
  
  // Show export buttons when there are entries
  if (exportBtns) exportBtns.style.display = "block";
  
  container.innerHTML = almanacEntries.slice().reverse().map((entry, idx) => `
    <div class="almanac-entry">
      <p class="almanac-date">${entry.date}</p>
      <p class="almanac-note">${entry.note}</p>
    </div>
  `).join("");
}

function renderRitual() {
  const ritual = rituals[Math.floor(Math.random() * rituals.length)];
  document.getElementById("ritualTitle").textContent = ritual.title;
  document.getElementById("ritualColors").innerHTML = ritual.colors.map(c => `
    <div class="ritual-color" style="background: ${c};" data-hex="${c}" data-name="Ritual color"></div>
  `).join("");
  document.getElementById("ritualText").textContent = ritual.text;
}

// ========== COMPARE TOOL ==========

function updateCompare() {
  const slot1 = document.getElementById("compareSlot1");
  const slot2 = document.getElementById("compareSlot2");
  
  if (compareColors[0]) {
    slot1.classList.add("filled");
    slot1.style.background = compareColors[0].hex;
    slot1.textContent = "";
  } else {
    slot1.classList.remove("filled");
    slot1.style.background = "";
    slot1.textContent = "Drop first color here";
  }
  
  if (compareColors[1]) {
    slot2.classList.add("filled");
    slot2.style.background = compareColors[1].hex;
    slot2.textContent = "";
  } else {
    slot2.classList.remove("filled");
    slot2.style.background = "";
    slot2.textContent = "Drop second color here";
  }
  
  const verdictBox = document.getElementById("compareVerdict");
  if (compareColors[0] && compareColors[1]) {
    verdictBox.style.display = "block";
    document.getElementById("verdictText").textContent = generateVerdict(compareColors[0], compareColors[1]);
  } else {
    verdictBox.style.display = "none";
  }
}

function generateVerdict(c1, c2) {
  const hsl1 = hexToHSL(c1.hex);
  const hsl2 = hexToHSL(c2.hex);
  
  const hueDiff = Math.abs(hsl1.h - hsl2.h);
  const satDiff = Math.abs(hsl1.s - hsl2.s);
  const lightDiff = Math.abs(hsl1.l - hsl2.l);
  
  let verdict = "";
  
  if (hueDiff < 30 || hueDiff > 330) {
    verdict += "These colors share a harmonic family and will read as intentionally coordinated. ";
  } else if (hueDiff > 150 && hueDiff < 210) {
    verdict += "These are complementary opposites - high visual tension that demands attention. ";
  } else if (hueDiff > 90 && hueDiff < 150) {
    verdict += "A split-complement relationship: dynamic but not jarring. ";
  } else {
    verdict += "An unexpected pairing that feels artistic rather than matched. ";
  }
  
  if (lightDiff > 40) {
    verdict += "The strong value contrast creates clear visual hierarchy - excellent for separating garment from accessory. ";
  } else if (lightDiff < 15) {
    verdict += "Similar luminosity means these will blend softly together - layer them for a tonal story. ";
  }
  
  if (satDiff > 30) {
    verdict += "The saturation difference lets one color lead while the other supports. ";
  }
  
  return verdict || "A nuanced combination worthy of experimentation.";
}

// ========== TIME/LIGHTING ==========

function updateTimePreview(time) {
  const preview = document.getElementById("timePreview");
  const swatch = document.getElementById("timeSwatch");
  const desc = document.getElementById("timeDescription");
  
  // Use a signature color for demo
  const baseColor = "#4A7C59";
  swatch.style.background = baseColor;
  
  const settings = {
    dawn: {
      bg: "linear-gradient(135deg, #4A3A5A 0%, #7A5A6A 50%, #C9A5A5 100%)",
      filter: "brightness(0.9) saturate(0.8)",
      desc: "In dawn light, your greens take on a mystical quality, touched with violet undertones."
    },
    daylight: {
      bg: "linear-gradient(135deg, #E9E9F0 0%, #F5F5FF 50%, #E9E9E9 100%)",
      filter: "brightness(1.1) saturate(1)",
      desc: "Full daylight reveals the true hue - colors appear most accurate under this neutral light."
    },
    golden: {
      bg: "linear-gradient(135deg, #E9A55A 0%, #F5C98B 50%, #E9B97A 100%)",
      filter: "brightness(1.05) saturate(1.2) sepia(0.1)",
      desc: "Golden hour bathes everything in amber warmth - your palette glows with extra richness."
    },
    candlelight: {
      bg: "linear-gradient(135deg, #3A2A1A 0%, #5A3A2A 50%, #4A3020 100%)",
      filter: "brightness(0.85) saturate(0.9) sepia(0.2)",
      desc: "Candlelight deepens and warms all colors, adding romance and mystery to your greens."
    },
    moonlight: {
      bg: "linear-gradient(135deg, #1A2A3A 0%, #2A3A4A 50%, #1A1A2A 100%)",
      filter: "brightness(0.75) saturate(0.5)",
      desc: "Moonlight desaturates and cools - your colors become ethereal, almost silvered."
    }
  };
  
  const s = settings[time];
  preview.style.background = s.bg;
  swatch.style.filter = s.filter;
  desc.textContent = s.desc;
}

// ========== HARMONY ==========

function generateHarmony(baseHex, type) {
  const hsl = hexToHSL(baseHex);
  let harmonies = [];
  
  switch (type) {
    case "complement":
      harmonies = [
        baseHex,
        hslToHex((hsl.h + 180) % 360, hsl.s, hsl.l)
      ];
      break;
    case "triadic":
      harmonies = [
        baseHex,
        hslToHex((hsl.h + 120) % 360, hsl.s, hsl.l),
        hslToHex((hsl.h + 240) % 360, hsl.s, hsl.l)
      ];
      break;
    case "analogous":
      harmonies = [
        hslToHex((hsl.h - 30 + 360) % 360, hsl.s, hsl.l),
        baseHex,
        hslToHex((hsl.h + 30) % 360, hsl.s, hsl.l)
      ];
      break;
    case "split":
      harmonies = [
        baseHex,
        hslToHex((hsl.h + 150) % 360, hsl.s, hsl.l),
        hslToHex((hsl.h + 210) % 360, hsl.s, hsl.l)
      ];
      break;
  }
  
  document.getElementById("harmonyResults").innerHTML = harmonies.map(c => `
    <div class="harmony-result" style="background: ${c};" data-hex="${c}" data-name="Harmony color"></div>
  `).join("");
}

// ========== MOOD ==========

function showMood(mood) {
  const colors = moods[mood] || [];
  document.getElementById("moodColors").innerHTML = colors.map(c => `
    <div class="mood-color" style="background: ${c};" data-hex="${c}" data-name="${mood} mood color"></div>
  `).join("");
}

// ========== LUMINOSITY ==========

function filterByLuminosity(value) {
  const allColors = Object.values(paletteGroups).flat();
  const targetL = value;
  const tolerance = 25;
  
  const filtered = allColors.filter(c => {
    const hsl = hexToHSL(c.hex);
    return Math.abs(hsl.l - targetL) < tolerance;
  });
  
  document.getElementById("luminosityColors").innerHTML = filtered.slice(0, 12).map(c => `
    <div class="luminosity-swatch" style="background: ${c.hex};" data-hex="${c.hex}" data-name="${c.name}"></div>
  `).join("");
}

// ========== EXPORT ==========

function getAllColors() {
  const colors = [];
  Object.entries(paletteGroups).forEach(([group, groupColors]) => {
    groupColors.forEach(c => {
      colors.push({ ...c, group });
    });
  });
  return colors;
}

function exportAsJSON(colors) {
  return JSON.stringify(colors, null, 2);
}

function exportAsText(colors) {
  return colors.map(c => `${c.name}: ${c.hex}`).join("\n");
}

// ========== EVENT HANDLERS ==========

document.addEventListener("DOMContentLoaded", () => {
  // Initial renders
  renderPigments();
  renderPalette();
  renderLooks();
  renderFavorites();
  renderFabrics();
  renderSeasonalJourney();
  renderMemoryGrid();
  renderAlmanac();
  renderRitual();
  updateTimePreview("dawn");
  filterByLuminosity(50);
  
  // Tab navigation
  document.querySelectorAll(".chapter-tab").forEach(tab => {
    tab.addEventListener("click", () => {
      document.querySelectorAll(".chapter-tab").forEach(t => t.classList.remove("active"));
      document.querySelectorAll(".chapter").forEach(c => c.classList.remove("active"));
      tab.classList.add("active");
      document.getElementById(tab.dataset.chapter).classList.add("active");
    });
  });
  
  // Track if we're in selection mode
  let selectionMode = null; // null, "memory", "compare1", "compare2"
  
  // Global click handler for swatches
  document.addEventListener("click", e => {
    const swatch = e.target.closest("[data-hex]");
    if (swatch) {
      const hex = swatch.dataset.hex;
      const name = swatch.dataset.name;
      
      // If we have a selected day in memory mode
      if (selectedDay) {
        chromaticMemory[selectedDay] = hex;
        saveMemory();
        renderMemoryGrid();
        const savedDate = selectedDay;
        selectedDay = null;
        selectionMode = null;
        
        // Hide banner
        document.getElementById("selectionBanner").classList.remove("show");
        
        // Clear selection styling
        document.querySelectorAll(".memory-day").forEach(d => d.classList.remove("selected"));
        
        showToast("Color recorded!");
        
        // Highlight the day briefly
        const dayEl = document.querySelector(`.memory-day[data-date="${savedDate}"]`);
        if (dayEl) {
          dayEl.style.transition = "transform 0.2s ease";
          dayEl.style.transform = "scale(1.2)";
          setTimeout(() => { dayEl.style.transform = "scale(1)"; }, 300);
        }
        return;
      }
      
      // If we're in compare selection mode
      if (selectionMode === "compare1") {
        compareColors[0] = { hex, name };
        updateCompare();
        selectionMode = null;
        document.getElementById("selectionBanner").classList.remove("show");
        document.getElementById("compareSlot1").classList.remove("awaiting");
        showToast("First color selected!");
        return;
      }
      
      if (selectionMode === "compare2") {
        compareColors[1] = { hex, name };
        updateCompare();
        selectionMode = null;
        document.getElementById("selectionBanner").classList.remove("show");
        document.getElementById("compareSlot2").classList.remove("awaiting");
        showToast("Second color selected!");
        return;
      }
      
      // Set harmony color and show feedback
      selectedHarmonyColor = hex;
      const harmonyCenter = document.querySelector(".harmony-center");
      if (harmonyCenter) {
        harmonyCenter.textContent = hex;
        harmonyCenter.style.background = hex;
        // Determine text color based on luminosity
        const hsl = hexToHSL(hex);
        harmonyCenter.style.color = hsl.l > 50 ? "#1a2e1f" : "#f5f0e6";
      }
      
      // Normal click - copy
      copyToClipboard(hex);
    }
    
    // Memory day click
    const memoryDay = e.target.closest(".memory-day[data-date]");
    if (memoryDay && !e.target.closest("[data-hex]")) {
      // Clear previous selection visual
      document.querySelectorAll(".memory-day").forEach(d => d.classList.remove("selected"));
      
      selectedDay = memoryDay.dataset.date;
      selectionMode = "memory";
      
      // Visual feedback for selected day
      memoryDay.classList.add("selected");
      
      // Show selection banner
      const banner = document.getElementById("selectionBanner");
      document.getElementById("selectionText").textContent = "Day selected - click any color swatch to record it";
      banner.classList.add("show");
    }
    
    // Compare slot click - enter selection mode for that slot
    const slot = e.target.closest(".compare-slot");
    if (slot) {
      const slotNum = parseInt(slot.dataset.slot);
      
      // If already filled, clear it
      if (slot.classList.contains("filled")) {
        compareColors[slotNum - 1] = null;
        updateCompare();
        return;
      }
      
      // Enter selection mode for this slot
      selectionMode = slotNum === 1 ? "compare1" : "compare2";
      
      // Visual feedback
      document.querySelectorAll(".compare-slot").forEach(s => s.classList.remove("awaiting"));
      slot.classList.add("awaiting");
      
      // Show selection banner
      const banner = document.getElementById("selectionBanner");
      document.getElementById("selectionText").textContent = `Slot ${slotNum} selected - click any color swatch`;
      banner.classList.add("show");
    }
  });
  
  // Cancel selection button
  document.getElementById("cancelSelection").addEventListener("click", () => {
    selectedDay = null;
    selectionMode = null;
    document.querySelectorAll(".memory-day").forEach(d => d.classList.remove("selected"));
    document.querySelectorAll(".compare-slot").forEach(s => s.classList.remove("awaiting"));
    document.getElementById("selectionBanner").classList.remove("show");
  });
  
  // Double-click for favorites
  document.addEventListener("dblclick", e => {
    const swatch = e.target.closest("[data-hex]");
    if (swatch) {
      const hex = swatch.dataset.hex;
      const name = swatch.dataset.name;
      
      if (favorites[hex]) {
        delete favorites[hex];
        swatch.classList.remove("favorite");
        showToast("Removed from favorites");
      } else {
        favorites[hex] = name;
        swatch.classList.add("favorite");
        showToast("Added to favorites");
      }
      saveFavorites();
      renderFavorites();
    }
  });
  
  // Time buttons
  document.querySelectorAll(".time-btn[data-time]").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".time-btn[data-time]").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      updateTimePreview(btn.dataset.time);
    });
  });
  
  // Harmony buttons
  document.querySelectorAll("[data-harmony]").forEach(btn => {
    btn.addEventListener("click", () => {
      if (selectedHarmonyColor) {
        generateHarmony(selectedHarmonyColor, btn.dataset.harmony);
      } else {
        showToast("First click a color to select it");
      }
    });
  });
  
  // Mood buttons
  document.querySelectorAll(".mood-btn[data-mood]").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".mood-btn[data-mood]").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      showMood(btn.dataset.mood);
    });
  });
  
  // Luminosity slider
  document.getElementById("luminositySlider").addEventListener("input", e => {
    filterByLuminosity(parseInt(e.target.value));
  });
  
  // Ritual button
  document.getElementById("ritualBtn").addEventListener("click", renderRitual);
  
  // Almanac save
  document.getElementById("almanacSave").addEventListener("click", () => {
    const input = document.getElementById("almanacInput");
    const note = input.value.trim();
    if (note) {
      const today = new Date();
      almanacEntries.push({
        date: today.toLocaleDateString("en-US", { weekday: "long", year: "numeric", month: "long", day: "numeric" }),
        note
      });
      saveAlmanac();
      renderAlmanac();
      input.value = "";
      showToast("Entry recorded");
    }
  });
  
  // Almanac export as text
  document.getElementById("exportAlmanacText").addEventListener("click", () => {
    if (almanacEntries.length === 0) {
      showToast("No entries to export");
      return;
    }
    const text = "THE VERDANT ALCHEMIST - COLOR DIARY\n" + 
                 "===================================\n\n" +
                 almanacEntries.map(e => `${e.date}\n${e.note}\n`).join("\n---\n\n");
    copyToClipboard(text);
    showToast("Diary copied to clipboard!");
  });
  
  // Almanac export as JSON
  document.getElementById("exportAlmanacJSON").addEventListener("click", () => {
    if (almanacEntries.length === 0) {
      showToast("No entries to export");
      return;
    }
    const json = JSON.stringify({
      title: "The Verdant Alchemist - Color Diary",
      exportDate: new Date().toISOString(),
      entries: almanacEntries
    }, null, 2);
    copyToClipboard(json);
    showToast("Diary JSON copied to clipboard!");
  });
  
  // Clear almanac
  document.getElementById("clearAlmanac").addEventListener("click", () => {
    if (almanacEntries.length === 0) {
      showToast("No entries to clear");
      return;
    }
    if (confirm("Are you sure you want to delete all diary entries? This cannot be undone.")) {
      almanacEntries = [];
      saveAlmanac();
      renderAlmanac();
      showToast("All entries cleared");
    }
  });
  
  // Export buttons
  document.getElementById("exportJSON").addEventListener("click", () => {
    const json = exportAsJSON(getAllColors());
    document.getElementById("exportPreview").textContent = json;
    copyToClipboard(json);
  });
  
  document.getElementById("exportText").addEventListener("click", () => {
    const text = exportAsText(getAllColors());
    document.getElementById("exportPreview").textContent = text;
    copyToClipboard(text);
  });
  
  document.getElementById("exportFavJSON").addEventListener("click", () => {
    const favColors = Object.entries(favorites).map(([hex, name]) => ({ hex, name }));
    const json = exportAsJSON(favColors);
    document.getElementById("exportPreview").textContent = json;
    copyToClipboard(json);
  });
  
  document.getElementById("exportFavText").addEventListener("click", () => {
    const favColors = Object.entries(favorites).map(([hex, name]) => ({ hex, name }));
    const text = exportAsText(favColors);
    document.getElementById("exportPreview").textContent = text;
    copyToClipboard(text);
  });
  
  // Modal
  document.getElementById("modalClose").addEventListener("click", () => {
    document.getElementById("modal").classList.remove("show");
  });
  
  document.getElementById("modal").addEventListener("click", e => {
    if (e.target === document.getElementById("modal")) {
      document.getElementById("modal").classList.remove("show");
    }
  });
});
</script>
<script src="../assets/gate.js"></script>
</body>
</html>
