<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Gilded Moss</title>
    

  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gilded Moss - A Personal Color Study</title>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --skin-luminous: #E8D5C4;
  --skin-shadow: #C9A88A;
  --hair-light: #D4B896;
  --hair-mid: #9A7B5D;
  --hair-depth: #6B5344;
  --eye-gold: #8B7D4A;
  --eye-sage: #7A8B6A;
  --eye-depth: #4A5A42;
  --lip-natural: #C4908A;
  --flush: #D4A5A0;
  --vein-cool: #8A9AAA;
  --ink: #3D3632;
  --paper: #FAF7F2;
  --paper-warm: #F5EDE3;
  --whisper: rgba(61, 54, 50, 0.06);
}

html { font-size: 16px; }
body {
  font-family: Georgia, "Times New Roman", serif;
  background: var(--paper);
  color: var(--ink);
  line-height: 1.6;
  min-height: 100vh;
  overflow-x: hidden;
}

/* Header */
.header {
  padding: 24px 20px;
  text-align: center;
  border-bottom: 1px solid var(--whisper);
  background: linear-gradient(180deg, var(--paper-warm) 0%, var(--paper) 100%);
}

.palette-title {
  font-size: 1.75rem;
  font-weight: normal;
  font-style: italic;
  letter-spacing: 0.02em;
  color: var(--hair-depth);
  margin-bottom: 4px;
}

.subtitle {
  font-size: 0.75rem;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: var(--eye-sage);
}

.source-gems {
  display: flex;
  gap: 4px;
  justify-content: center;
  margin-top: 16px;
}

.source-gem {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  transition: transform 0.3s ease;
  cursor: pointer;
}

.source-gem:hover {
  transform: scale(1.8);
}

/* Navigation */
.nav {
  position: sticky;
  top: 0;
  background: var(--paper);
  border-bottom: 1px solid var(--whisper);
  z-index: 100;
  padding: 10px 16px;
  display: flex;
  gap: 6px;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
}

.nav::-webkit-scrollbar { display: none; }

.nav-btn {
  flex-shrink: 0;
  padding: 10px 14px;
  font-family: inherit;
  font-size: 0.75rem;
  letter-spacing: 0.06em;
  background: transparent;
  border: 1px solid var(--whisper);
  color: var(--ink);
  cursor: pointer;
  transition: all 0.2s ease;
  min-height: 44px;
  border-radius: 2px;
}

.nav-btn:hover, .nav-btn.active {
  background: var(--hair-depth);
  color: var(--paper);
  border-color: var(--hair-depth);
}

/* Sections */
.section {
  display: none;
  padding: 24px 16px;
  max-width: 800px;
  margin: 0 auto;
  animation: fadeSection 0.3s ease;
}

.section.active { display: block; }

@keyframes fadeSection {
  from { opacity: 0; }
  to { opacity: 1; }
}

.section-title {
  font-size: 1.125rem;
  font-weight: normal;
  font-style: italic;
  margin-bottom: 16px;
  padding-bottom: 10px;
  border-bottom: 1px solid var(--whisper);
}

.section-intro {
  font-size: 0.875rem;
  color: var(--skin-shadow);
  margin-bottom: 20px;
  line-height: 1.5;
}

/* Analysis Text */
.analysis p {
  margin-bottom: 1.25em;
  text-align: justify;
  hyphens: auto;
  font-size: 0.9375rem;
}

.analysis p::first-letter {
  font-size: 2.25em;
  float: left;
  line-height: 1;
  margin-right: 6px;
  color: var(--eye-sage);
}

.season-badge {
  display: inline-block;
  padding: 14px 20px;
  background: var(--paper-warm);
  border: 1px solid var(--skin-shadow);
  margin: 20px 0;
  font-size: 0.9375rem;
}

.season-badge strong {
  display: block;
  margin-bottom: 6px;
}

/* Pigments Grid */
.pigments-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
  gap: 12px;
}

.pigment-card {
  background: white;
  padding: 12px;
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.pigment-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.08);
}

.pigment-card:active {
  transform: scale(0.98);
}

.pigment-swatch {
  width: 100%;
  aspect-ratio: 1;
  margin-bottom: 10px;
  position: relative;
}

.pigment-name {
  font-size: 0.75rem;
  margin-bottom: 2px;
}

.pigment-hex {
  font-size: 0.6875rem;
  color: var(--skin-shadow);
  font-family: ui-monospace, monospace;
}

.pigment-source {
  font-size: 0.625rem;
  color: var(--eye-sage);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-top: 4px;
}

/* Palette Grid */
.palette-section {
  margin-bottom: 28px;
}

.palette-section-title {
  font-size: 0.75rem;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--eye-sage);
  margin-bottom: 12px;
}

.palette-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(52px, 1fr));
  gap: 6px;
}

.swatch {
  aspect-ratio: 1;
  cursor: pointer;
  position: relative;
  transition: transform 0.15s ease;
  min-height: 52px;
  border-radius: 2px;
}

.swatch:hover { transform: scale(1.15); z-index: 10; }
.swatch:active { transform: scale(1.05); }

.swatch.favorite::after {
  content: "";
  position: absolute;
  top: 3px;
  right: 3px;
  width: 6px;
  height: 6px;
  background: white;
  border-radius: 50%;
  box-shadow: 0 1px 3px rgba(0,0,0,0.4);
}

.swatch-tooltip {
  position: absolute;
  bottom: calc(100% + 6px);
  left: 50%;
  transform: translateX(-50%);
  background: var(--ink);
  color: var(--paper);
  padding: 5px 8px;
  font-size: 0.6875rem;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.15s ease;
  z-index: 20;
  border-radius: 2px;
}

.swatch:hover .swatch-tooltip { opacity: 1; }

/* Toast */
.toast {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: var(--ink);
  color: var(--paper);
  padding: 12px 20px;
  font-size: 0.8125rem;
  z-index: 1000;
  transition: transform 0.3s ease;
  border-radius: 2px;
}

.toast.show { transform: translateX(-50%) translateY(0); }

/* Compare Panel */
.compare-panel {
  background: white;
  padding: 20px;
  margin-bottom: 20px;
}

.compare-slots {
  display: flex;
  gap: 12px;
  margin-bottom: 16px;
}

.compare-slot {
  flex: 1;
  aspect-ratio: 1;
  max-height: 120px;
  background: var(--whisper);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.6875rem;
  color: var(--skin-shadow);
  text-align: center;
  padding: 8px;
  border-radius: 2px;
}

.compare-verdict {
  padding: 14px;
  background: var(--paper-warm);
  font-style: italic;
  font-size: 0.875rem;
  line-height: 1.5;
  min-height: 70px;
  border-radius: 2px;
}

.compare-actions {
  display: flex;
  gap: 8px;
  margin-top: 14px;
}

.btn {
  padding: 12px 18px;
  font-family: inherit;
  font-size: 0.75rem;
  background: var(--ink);
  color: var(--paper);
  border: none;
  cursor: pointer;
  min-height: 44px;
  transition: all 0.2s ease;
  border-radius: 2px;
  letter-spacing: 0.03em;
}

.btn:hover { background: var(--hair-depth); }
.btn:active { transform: scale(0.98); }

.btn-secondary {
  background: transparent;
  color: var(--ink);
  border: 1px solid var(--ink);
}

.btn-secondary:hover {
  background: var(--ink);
  color: var(--paper);
}

/* Looks */
.looks-grid {
  display: grid;
  gap: 20px;
}

.look-card {
  background: white;
  padding: 20px;
  border-radius: 2px;
}

.look-category {
  font-size: 0.625rem;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--eye-sage);
  margin-bottom: 6px;
}

.look-title {
  font-style: italic;
  font-size: 1.0625rem;
  margin-bottom: 8px;
}

.look-desc {
  font-size: 0.8125rem;
  color: var(--skin-shadow);
  margin-bottom: 14px;
  line-height: 1.5;
}

.look-colors {
  display: flex;
  gap: 4px;
}

.look-swatch {
  width: 44px;
  height: 44px;
  cursor: pointer;
  transition: transform 0.15s ease;
  border-radius: 2px;
}

.look-swatch:hover { transform: scale(1.15); }

/* Favorites */
.favorites-empty {
  text-align: center;
  padding: 40px 20px;
  color: var(--skin-shadow);
  font-style: italic;
}

.favorites-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
  gap: 12px;
}

.favorite-item {
  text-align: center;
}

.favorite-swatch {
  width: 100%;
  aspect-ratio: 1;
  margin-bottom: 6px;
  cursor: pointer;
  transition: transform 0.15s ease;
  border-radius: 2px;
}

.favorite-swatch:hover { transform: scale(1.08); }

.favorite-name {
  font-size: 0.6875rem;
  word-break: break-word;
}

/* Time Simulator */
.time-label {
  font-size: 0.8125rem;
  margin-bottom: 10px;
}

.time-slider {
  width: 100%;
  height: 44px;
  -webkit-appearance: none;
  background: linear-gradient(to right, 
    #1a1a2e 0%, 
    #4a3a50 10%,
    #f5c080 25%, 
    #fff8e8 50%, 
    #f5c080 75%, 
    #4a3a50 90%,
    #1a1a2e 100%
  );
  outline: none;
  border-radius: 4px;
  cursor: pointer;
}

.time-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 8px;
  height: 44px;
  background: white;
  border: 2px solid var(--ink);
  cursor: grab;
}

.time-slider::-webkit-slider-thumb:active {
  cursor: grabbing;
}

.time-preview {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 4px;
  margin-top: 16px;
  padding: 16px;
  transition: filter 0.3s ease, background 0.3s ease;
  border-radius: 4px;
}

.time-preview-swatch {
  height: 50px;
  border-radius: 2px;
}

/* Shopping */
.shopping-input {
  width: 100%;
  padding: 14px 16px;
  font-family: inherit;
  font-size: 0.9375rem;
  border: 1px solid var(--whisper);
  margin-bottom: 12px;
  min-height: 44px;
  border-radius: 2px;
}

.shopping-input:focus {
  outline: none;
  border-color: var(--eye-sage);
}

.shopping-result {
  padding: 20px;
  background: white;
  display: none;
  margin-top: 16px;
  border-radius: 2px;
}

.shopping-result.show { display: block; }

.shop-preview-swatch {
  width: 70px;
  height: 70px;
  margin-bottom: 12px;
  border-radius: 2px;
}

.match-meter {
  height: 6px;
  background: var(--whisper);
  margin: 12px 0;
  border-radius: 3px;
  overflow: hidden;
}

.match-fill {
  height: 100%;
  background: var(--eye-sage);
  transition: width 0.5s ease;
  border-radius: 3px;
}

.closest-swatches {
  display: flex;
  gap: 8px;
  margin-top: 14px;
}

.closest-swatch {
  width: 44px;
  height: 44px;
  border-radius: 2px;
  cursor: pointer;
}

.closest-swatch:hover { transform: scale(1.1); }

/* Harmony */
.harmony-container {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.harmony-wheel {
  width: 260px;
  height: 260px;
  border-radius: 50%;
  position: relative;
  margin-bottom: 20px;
}

.harmony-dot {
  position: absolute;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  border: 2px solid white;
  box-shadow: 0 2px 6px rgba(0,0,0,0.25);
  transform: translate(-50%, -50%);
  cursor: pointer;
  transition: transform 0.2s ease;
}

.harmony-dot:hover { transform: translate(-50%, -50%) scale(1.4); }

.harmony-info {
  text-align: center;
  font-style: italic;
  color: var(--skin-shadow);
  font-size: 0.875rem;
  max-width: 300px;
}

/* Textures */
.texture-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}

.texture-card {
  padding: 16px;
  background: white;
  text-align: center;
  border-radius: 2px;
}

.texture-preview {
  width: 100%;
  height: 60px;
  margin-bottom: 10px;
  border-radius: 2px;
}

.texture-name {
  font-size: 0.8125rem;
  margin-bottom: 4px;
}

.texture-note {
  font-size: 0.6875rem;
  color: var(--skin-shadow);
  font-style: italic;
  line-height: 1.4;
}

/* Story */
.story-output {
  background: var(--paper-warm);
  padding: 20px;
  font-style: italic;
  line-height: 1.7;
  margin-top: 14px;
  min-height: 80px;
  font-size: 0.9375rem;
  border-radius: 2px;
}

/* Seasons */
.season-tabs {
  display: flex;
  gap: 6px;
  margin-bottom: 18px;
  flex-wrap: wrap;
}

.season-tab {
  padding: 10px 14px;
  background: transparent;
  border: 1px solid var(--whisper);
  font-family: inherit;
  font-size: 0.75rem;
  cursor: pointer;
  min-height: 44px;
  transition: all 0.2s ease;
  border-radius: 2px;
}

.season-tab.active {
  background: var(--eye-sage);
  color: white;
  border-color: var(--eye-sage);
}

.season-palette { display: none; }
.season-palette.active { display: block; }

/* Capsule */
.capsule-container {
  display: grid;
  gap: 16px;
}

.capsule-label {
  font-size: 0.6875rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--eye-sage);
  margin-bottom: 8px;
}

.capsule-bank {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(44px, 1fr));
  gap: 6px;
  padding: 14px;
  background: white;
  min-height: 100px;
  border-radius: 2px;
}

.capsule-canvas {
  min-height: 160px;
  background: white;
  padding: 14px;
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  align-content: flex-start;
  border-radius: 2px;
}

.capsule-item {
  width: 44px;
  height: 44px;
  cursor: pointer;
  transition: transform 0.15s ease;
  border-radius: 2px;
}

.capsule-item:hover { transform: scale(1.1); }

/* Discovery */
.discovery-card {
  background: white;
  padding: 28px;
  text-align: center;
  margin-bottom: 16px;
  border-radius: 2px;
}

.discovery-swatch {
  width: 100px;
  height: 100px;
  margin: 0 auto 18px;
  border-radius: 2px;
}

.discovery-name {
  font-size: 1.125rem;
  font-style: italic;
  margin-bottom: 6px;
}

.discovery-hex {
  font-family: ui-monospace, monospace;
  font-size: 0.8125rem;
  color: var(--skin-shadow);
  margin-bottom: 14px;
}

.discovery-insight {
  font-size: 0.875rem;
  line-height: 1.6;
  color: var(--hair-depth);
  max-width: 400px;
  margin: 0 auto;
}

.discovery-nav {
  display: flex;
  justify-content: center;
  gap: 12px;
}

.discovery-counter {
  font-size: 0.75rem;
  color: var(--skin-shadow);
  margin-top: 12px;
}

/* Export */
.export-btns {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 16px;
}

.export-preview {
  background: white;
  padding: 14px;
  font-family: ui-monospace, monospace;
  font-size: 0.6875rem;
  max-height: 280px;
  overflow-y: auto;
  white-space: pre-wrap;
  word-break: break-all;
  border-radius: 2px;
}

/* Palette DNA */
.dna-section {
  margin-bottom: 32px;
  padding-bottom: 24px;
  border-bottom: 1px solid var(--whisper);
}

.dna-section:last-child {
  border-bottom: none;
}

.dna-label {
  font-size: 0.6875rem;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--eye-sage);
  margin-bottom: 14px;
  font-weight: normal;
}

.dna-meter {
  margin-bottom: 12px;
}

.dna-meter-track {
  height: 8px;
  background: linear-gradient(to right, #8A9AAA 0%, #D9CFC3 50%, #D4B878 100%);
  border-radius: 4px;
  position: relative;
}

.dna-meter-marker {
  position: absolute;
  top: -4px;
  width: 16px;
  height: 16px;
  background: white;
  border: 2px solid var(--ink);
  border-radius: 50%;
  transform: translateX(-50%);
  transition: left 0.5s ease;
}

.dna-meter-labels {
  display: flex;
  justify-content: space-between;
  font-size: 0.6875rem;
  color: var(--skin-shadow);
  margin-top: 6px;
}

.dna-reading {
  font-size: 0.875rem;
  line-height: 1.6;
  color: var(--ink);
}

.dna-range-visual {
  height: 40px;
  border-radius: 4px;
  margin-bottom: 12px;
  position: relative;
  overflow: hidden;
}

.dna-range-bar {
  position: absolute;
  top: 0;
  height: 100%;
  transition: all 0.5s ease;
}

.dna-range-marker {
  position: absolute;
  top: 0;
  width: 3px;
  height: 100%;
  background: var(--ink);
}

.dna-hue-map {
  height: 60px;
  border-radius: 4px;
  margin-bottom: 12px;
  position: relative;
  background: conic-gradient(from 0deg at 50% 100%, 
    hsl(0, 40%, 70%) 0deg,
    hsl(30, 40%, 70%) 30deg,
    hsl(60, 40%, 70%) 60deg,
    hsl(90, 40%, 70%) 90deg,
    hsl(120, 40%, 70%) 120deg,
    hsl(150, 40%, 70%) 150deg,
    hsl(180, 40%, 70%) 180deg,
    hsl(210, 40%, 70%) 210deg,
    hsl(240, 40%, 70%) 240deg,
    hsl(270, 40%, 70%) 270deg,
    hsl(300, 40%, 70%) 300deg,
    hsl(330, 40%, 70%) 330deg,
    hsl(360, 40%, 70%) 360deg
  );
  opacity: 0.3;
}

.dna-hue-zone {
  position: absolute;
  bottom: 0;
  height: 100%;
  background: var(--ink);
  opacity: 0.6;
  border-radius: 2px;
}

.dna-comparison {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-bottom: 16px;
}

.dna-comparison-label {
  font-size: 0.75rem;
  color: var(--skin-shadow);
  margin-bottom: 8px;
}

.dna-comparison-swatches {
  display: flex;
  gap: 3px;
  flex-wrap: wrap;
}

.dna-comparison-swatch {
  width: 28px;
  height: 28px;
  border-radius: 2px;
}

.dna-differences {
  background: var(--paper-warm);
  padding: 16px;
  border-radius: 4px;
}

.dna-diff-item {
  font-size: 0.8125rem;
  margin-bottom: 8px;
  padding-left: 16px;
  position: relative;
  line-height: 1.5;
}

.dna-diff-item:last-child {
  margin-bottom: 0;
}

.dna-diff-item::before {
  content: "";
  position: absolute;
  left: 0;
  top: 8px;
  width: 6px;
  height: 6px;
  background: var(--eye-sage);
  border-radius: 50%;
}

/* Responsive */
@media (min-width: 600px) {
  .palette-grid {
    grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
  }
  
  .looks-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .texture-grid {
    grid-template-columns: repeat(4, 1fr);
  }
  
  .capsule-container {
    grid-template-columns: 1fr 2fr;
  }
  
  .pigments-grid {
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  }
}
</style>
</head>
<body>

<header class="header">
  <h1 class="palette-title">Gilded Moss</h1>
  <p class="subtitle">A Personal Color Study</p>
  <div class="source-gems" id="sourceGems"></div>
</header>

<nav class="nav" id="nav">
  <button class="nav-btn active" data-section="analysis">Analysis</button>
  <button class="nav-btn" data-section="pigments">Pigments</button>
  <button class="nav-btn" data-section="palette">Palette</button>
  <button class="nav-btn" data-section="looks">Looks</button>
  <button class="nav-btn" data-section="compare">Compare</button>
  <button class="nav-btn" data-section="favorites">Favorites</button>
  <button class="nav-btn" data-section="time">Light</button>
  <button class="nav-btn" data-section="shopping">Shop</button>
  <button class="nav-btn" data-section="harmony">Harmony</button>
  <button class="nav-btn" data-section="texture">Texture</button>
  <button class="nav-btn" data-section="story">Story</button>
  <button class="nav-btn" data-section="seasons">Seasons</button>
  <button class="nav-btn" data-section="dna">Palette DNA</button>
  <button class="nav-btn" data-section="discovery">Discovery</button>
  <button class="nav-btn" data-section="export">Export</button>
</nav>

<main>
  
  <!-- Analysis -->
  <section class="section active" id="analysis">
    <div class="analysis">
      <p>Yours is the coloring of late afternoon in October, when the sun hangs low and gilds everything it touches with honey-amber warmth, yet the shadows hold the cool mystery of approaching dusk. The interplay is immediate and arresting: a complexion of luminous ivory with the faintest blush of rose-beige, neither purely warm nor purely cool but suspended in that rare atmospheric space where both temperatures coexist. Your skin possesses what colorists call "simultaneous contrast" - it reflects warm tones back at warm colors and cool tones back at cool ones, making you a natural chameleon.</p>
      
      <p>The architecture of your coloring finds its keystone in your eyes. Those irises hold the complexity of a forest floor in shifting light: a central starburst of true gold-amber, surrounded by a ring of sage green that deepens to smoky teal at the outer edge. This tripartite structure - gold, sage, shadow - becomes the harmonic foundation for everything that flatters you. Your hair echoes this dimensional quality: warm honey-wheat at the surface where light catches it, cooling to ash-kissed bronze in the underlayers, with depths that hint at walnut and driftwood.</p>
      
      <p>What distinguishes your coloring is its internal coherence. The soft coral that naturally inhabits your lips reappears as the flush across your cheeks; the sage of your eyes threads through the cool undertone visible in your inner wrist; the gold warmth of your hair manifests in the luminosity of your skin at the cheekbone and brow. You are not a collection of separate colors but a single, integrated color story.</p>
      
      <div class="season-badge">
        <strong>Soft Autumn Leaning Warm</strong>
        <span style="font-size: 0.8125rem;">You possess Autumn's golden undertone and muted quality, but your delicate contrast and sage-green eyes pull you toward the softest, most luminous edge of the season.</span>
      </div>
    </div>
  </section>
  
  <!-- Pigments -->
  <section class="section" id="pigments">
    <h2 class="section-title">Source Pigments</h2>
    <p class="section-intro">The actual colors observed in your skin, hair, eyes, lips, and veins. Click to copy hex codes. Double-click to favorite.</p>
    <div class="pigments-grid" id="pigmentsGrid"></div>
  </section>
  
  <!-- Palette -->
  <section class="section" id="palette">
    <h2 class="section-title">Your Wearable Palette</h2>
    <p class="section-intro">40 colors derived from your source pigments, organized by family. Click to copy, double-click to favorite.</p>
    <div id="paletteContainer"></div>
  </section>
  
  <!-- Looks -->
  <section class="section" id="looks">
    <h2 class="section-title">Styled Looks</h2>
    <p class="section-intro">Complete color stories with outfit and makeup pairings.</p>
    <div class="looks-grid" id="looksGrid"></div>
  </section>
  
  <!-- Compare -->
  <section class="section" id="compare">
    <h2 class="section-title">Compare Colors</h2>
    <p class="section-intro">Click any swatch from other sections to add it here. Get specific advice on how two colors work together.</p>
    <div class="compare-panel">
      <div class="compare-slots">
        <div class="compare-slot" id="compareSlot1">tap a swatch</div>
        <div class="compare-slot" id="compareSlot2">tap a swatch</div>
      </div>
      <div class="compare-verdict" id="compareVerdict">Select two colors to see their relationship.</div>
      <div class="compare-actions">
        <button class="btn btn-secondary" onclick="clearCompare()">Clear</button>
      </div>
    </div>
  </section>
  
  <!-- Favorites -->
  <section class="section" id="favorites">
    <h2 class="section-title">Your Favorites</h2>
    <p class="section-intro">Double-click any swatch to save it here. Persists across sessions.</p>
    <div id="favoritesContainer">
      <p class="favorites-empty">Double-click any swatch to save it here.</p>
    </div>
    <div id="favExport" style="display: none; margin-top: 20px;">
      <button class="btn" onclick="exportFavorites()">Export Favorites</button>
    </div>
  </section>
  
  <!-- Time -->
  <section class="section" id="time">
    <h2 class="section-title">Light Simulator</h2>
    <p class="section-intro">See how your colors shift from dawn to dusk. Drag the slider to change the time.</p>
    <div class="time-label">Hour: <span id="timeLabel">12:00 - Noon</span></div>
    <input type="range" class="time-slider" id="timeSlider" min="0" max="24" value="12" step="0.5">
    <div class="time-preview" id="timePreview"></div>
  </section>
  
  <!-- Shopping -->
  <section class="section" id="shopping">
    <h2 class="section-title">Color Match</h2>
    <p class="section-intro">Paste a hex code from any product page and see if it belongs in your palette.</p>
    <input type="text" class="shopping-input" id="shopInput" placeholder="#B5A090 or rgb(181, 160, 144)">
    <button class="btn" onclick="analyzeShopColor()">Analyze</button>
    <div class="shopping-result" id="shopResult">
      <div class="shop-preview-swatch" id="shopPreview"></div>
      <div id="shopVerdict"></div>
      <div class="match-meter"><div class="match-fill" id="matchFill"></div></div>
      <p style="font-size: 0.8125rem; margin-top: 12px;">Closest palette matches:</p>
      <div class="closest-swatches" id="closestSwatches"></div>
    </div>
  </section>
  
  <!-- Harmony -->
  <section class="section" id="harmony">
    <h2 class="section-title">Harmony Wheel</h2>
    <p class="section-intro">Your palette colors mapped by hue and saturation. See where they cluster.</p>
    <div class="harmony-container">
      <div class="harmony-wheel" id="harmonyWheel"></div>
      <p class="harmony-info">Your palette clusters in the warm-muted quadrant with sage-green accents. Hover over dots to explore.</p>
    </div>
  </section>
  
  <!-- Texture -->
  <section class="section" id="texture">
    <h2 class="section-title">Texture Affinities</h2>
    <p class="section-intro">Materials and finishes that amplify your natural qualities.</p>
    <div class="texture-grid" id="textureGrid"></div>
  </section>
  
  <!-- Story -->
  <section class="section" id="story">
    <h2 class="section-title">Color Story Generator</h2>
    <p class="section-intro">Generate a poetic micro-narrative inspired by your palette.</p>
    <button class="btn" onclick="generateStory()">Generate New Story</button>
    <div class="story-output" id="storyOutput">Click the button to generate a color story...</div>
  </section>
  
  <!-- Seasons -->
  <section class="section" id="seasons">
    <h2 class="section-title">Seasonal Variations</h2>
    <p class="section-intro">Your palette adjusted for each season's characteristic light and mood.</p>
    <div class="season-tabs">
      <button class="season-tab active" data-season="spring">Spring</button>
      <button class="season-tab" data-season="summer">Summer</button>
      <button class="season-tab" data-season="autumn">Autumn</button>
      <button class="season-tab" data-season="winter">Winter</button>
    </div>
    <div id="seasonPalettes"></div>
  </section>
  
  <!-- Palette DNA -->
  <section class="section" id="dna">
    <h2 class="section-title">Palette DNA</h2>
    <p class="section-intro">The underlying structure that makes Gilded Moss yours - not generic Soft Autumn.</p>
    
    <div class="dna-section">
      <h3 class="dna-label">Temperature Signature</h3>
      <div class="dna-meter">
        <div class="dna-meter-track">
          <div class="dna-meter-fill" id="tempFill"></div>
          <div class="dna-meter-marker" id="tempMarker"></div>
        </div>
        <div class="dna-meter-labels">
          <span>Cool</span>
          <span>Neutral</span>
          <span>Warm</span>
        </div>
      </div>
      <p class="dna-reading" id="tempReading"></p>
    </div>
    
    <div class="dna-section">
      <h3 class="dna-label">Saturation Range</h3>
      <div class="dna-range-visual" id="saturationRange"></div>
      <p class="dna-reading" id="satReading"></p>
    </div>
    
    <div class="dna-section">
      <h3 class="dna-label">Value Spread</h3>
      <div class="dna-range-visual" id="valueRange"></div>
      <p class="dna-reading" id="valueReading"></p>
    </div>
    
    <div class="dna-section">
      <h3 class="dna-label">Hue Territory</h3>
      <div class="dna-hue-map" id="hueMap"></div>
      <p class="dna-reading" id="hueReading"></p>
    </div>
    
    <div class="dna-section">
      <h3 class="dna-label">What Makes You Different</h3>
      <div class="dna-comparison">
        <div class="dna-comparison-item">
          <div class="dna-comparison-label">Generic Soft Autumn</div>
          <div class="dna-comparison-swatches" id="genericSA"></div>
        </div>
        <div class="dna-comparison-item">
          <div class="dna-comparison-label">Your Gilded Moss</div>
          <div class="dna-comparison-swatches" id="yourPalette"></div>
        </div>
      </div>
      <div class="dna-differences" id="differences"></div>
    </div>
    
    <div class="dna-section">
      <h3 class="dna-label">Your Color Fingerprint</h3>
      <p class="dna-reading" id="fingerprint"></p>
    </div>
  </section>
  
  <!-- Discovery -->
  <section class="section" id="discovery">
    <h2 class="section-title">Discovery Mode</h2>
    <p class="section-intro">Explore your colors one at a time with personalized insights.</p>
    <div class="discovery-card">
      <div class="discovery-swatch" id="discoverySwatch"></div>
      <div class="discovery-name" id="discoveryName"></div>
      <div class="discovery-hex" id="discoveryHex"></div>
      <div class="discovery-insight" id="discoveryInsight"></div>
    </div>
    <div class="discovery-nav">
      <button class="btn btn-secondary" onclick="prevDiscovery()">Previous</button>
      <button class="btn" onclick="nextDiscovery()">Next</button>
    </div>
    <p class="discovery-counter" id="discoveryCounter"></p>
  </section>
  
  <!-- Export -->
  <section class="section" id="export">
    <h2 class="section-title">Export</h2>
    <p class="section-intro">Download your palette in different formats.</p>
    <div class="export-btns">
      <button class="btn" onclick="exportJSON()">Full Palette JSON</button>
      <button class="btn btn-secondary" onclick="exportText()">Text List</button>
      <button class="btn btn-secondary" onclick="exportFavJSON()">Favorites JSON</button>
    </div>
    <pre class="export-preview" id="exportPreview">Select an export format above.</pre>
  </section>
  
</main>

<div class="toast" id="toast"></div>

<script>
// Data
const sourcePigments = [
  { name: "Luminous Ivory", hex: "#E8D5C4", source: "skin highlight" },
  { name: "Rose Bisque", hex: "#D4BBA8", source: "skin midtone" },
  { name: "Fawn Shadow", hex: "#C9A88A", source: "skin shadow" },
  { name: "Honey Wheat", hex: "#D4B896", source: "hair highlight" },
  { name: "Warm Flax", hex: "#C4A880", source: "hair midtone" },
  { name: "Bronze Driftwood", hex: "#9A7B5D", source: "hair shadow" },
  { name: "Walnut Depth", hex: "#6B5344", source: "hair darkest" },
  { name: "Amber Starburst", hex: "#8B7D4A", source: "eye inner" },
  { name: "Sage Moss", hex: "#7A8B6A", source: "eye middle" },
  { name: "Forest Smoke", hex: "#4A5A42", source: "eye outer" },
  { name: "Damask Rose", hex: "#C4908A", source: "natural lip" },
  { name: "Peach Flush", hex: "#D4A5A0", source: "cheek flush" },
  { name: "Slate Vein", hex: "#8A9AAA", source: "vein undertone" }
];

const paletteGroups = {
  "Foundation Neutrals": [
    { name: "Parchment", hex: "#F5EDE3" },
    { name: "Warm Stone", hex: "#D9CFC3" },
    { name: "Driftwood", hex: "#B5A090" },
    { name: "Taupe", hex: "#9A8B7A" },
    { name: "Mushroom", hex: "#8A7D70" },
    { name: "Umber", hex: "#6B5D50" },
    { name: "Espresso", hex: "#4A3F35" },
    { name: "Deep Earth", hex: "#3D3632" }
  ],
  "Golden Hour": [
    { name: "Buttermilk", hex: "#F5E6C8" },
    { name: "Champagne", hex: "#E8D5B0" },
    { name: "Honey Gold", hex: "#D4B878" },
    { name: "Amber", hex: "#C9A050" },
    { name: "Bronze Leaf", hex: "#A88840" },
    { name: "Ochre", hex: "#B89050" },
    { name: "Burnished Gold", hex: "#9A7830" }
  ],
  "Sage Garden": [
    { name: "Celadon Mist", hex: "#D4DBC8" },
    { name: "Pale Sage", hex: "#B8C4A8" },
    { name: "Soft Fern", hex: "#9AAB88" },
    { name: "Moss", hex: "#7A8B68" },
    { name: "Olive Leaf", hex: "#6B7A55" },
    { name: "Deep Sage", hex: "#5A6B48" },
    { name: "Forest Floor", hex: "#4A5A3D" }
  ],
  "Warm Earth": [
    { name: "Terracotta Blush", hex: "#D4A090" },
    { name: "Clay Rose", hex: "#C4908A" },
    { name: "Sienna", hex: "#B87860" },
    { name: "Cinnamon", hex: "#A86850" },
    { name: "Brick", hex: "#985848" },
    { name: "Rust", hex: "#8A4838" }
  ],
  "Muted Jewels": [
    { name: "Dusty Rose", hex: "#C4A0A0" },
    { name: "Mauve Taupe", hex: "#A89090" },
    { name: "Smoky Plum", hex: "#8A7080" },
    { name: "Deep Mulberry", hex: "#6A4858" },
    { name: "Teal Mist", hex: "#7A9A9A" },
    { name: "Stormy Teal", hex: "#5A7A80" },
    { name: "Deep Teal", hex: "#3A5A60" }
  ],
  "Atmospheric Blue": [
    { name: "Horizon", hex: "#C8D0D8" },
    { name: "Slate Blue", hex: "#8A9AAA" },
    { name: "Dusk", hex: "#6A7A8A" },
    { name: "Storm Cloud", hex: "#5A6A78" },
    { name: "Deep Slate", hex: "#4A5A68" }
  ]
};

const looks = [
  {
    title: "October Afternoon",
    desc: "Golden light filtering through amber leaves. A silk blouse in champagne, high-waisted trousers in deep sage, cognac leather belt, earthy terracotta lip.",
    colors: ["#E8D5B0", "#5A6B48", "#9A7B5D", "#D4A090"],
    category: "Daytime Elegance"
  },
  {
    title: "Gallery Opening",
    desc: "Intellectual allure. A structured blazer in mushroom, cream silk camisole, gold vermeil hoops, smoky plum lip with bronze highlight at cupid's bow.",
    colors: ["#8A7D70", "#F5EDE3", "#D4B878", "#8A7080"],
    category: "Evening Event"
  },
  {
    title: "Coastal Morning",
    desc: "Salt air and soft focus. Oversized cashmere in warm stone, slate blue trousers, bare face with tinted SPF, hair loose and textured.",
    colors: ["#D9CFC3", "#8A9AAA", "#E8D5C4", "#C4A880"],
    category: "Relaxed Weekend"
  },
  {
    title: "Candlelit Dinner",
    desc: "Intimate drama. Velvet in deep mulberry, gold stacking rings, dewy skin with bronze at the cheekbones, soft fern shadow in the outer corner.",
    colors: ["#6A4858", "#D4B878", "#D4BBA8", "#9AAB88"],
    category: "Date Night"
  },
  {
    title: "Spring Garden",
    desc: "Fresh and alive. Linen dress in pale sage, woven basket bag, peachy flush on apples of cheeks, mascara only, sandals in honey leather.",
    colors: ["#B8C4A8", "#D4B896", "#D4A5A0", "#C9A88A"],
    category: "Outdoor Daytime"
  },
  {
    title: "Autumn Study",
    desc: "Scholarly warmth. Wool turtleneck in sienna, corduroy in umber, cognac oxford shoes, burgundy lip stain worn sheerly.",
    colors: ["#B87860", "#6B5D50", "#9A7B5D", "#8A7080"],
    category: "Workwear"
  },
  {
    title: "Soft Power",
    desc: "Commanding without shouting. Silk shirt in celadon mist, tailored trousers in deep earth, gold cuff, nude lip in damask rose.",
    colors: ["#D4DBC8", "#3D3632", "#D4B878", "#C4908A"],
    category: "Professional"
  }
];

const textures = [
  { name: "Matte Silk", note: "Your skin's luminosity needs no sheen competition", gradient: "linear-gradient(135deg, #E8D5C4 0%, #D4BBA8 100%)" },
  { name: "Brushed Cashmere", note: "Soft nap absorbs light like your coloring", gradient: "linear-gradient(135deg, #D9CFC3 0%, #B5A090 100%)" },
  { name: "Burnished Leather", note: "Worn-in warmth echoes your golden undertones", gradient: "linear-gradient(135deg, #9A7B5D 0%, #6B5344 100%)" },
  { name: "Raw Silk", note: "Textured elegance with temperature shifts", gradient: "linear-gradient(135deg, #D4B896 0%, #C4A880 100%)" },
  { name: "Matte Gold", note: "Your metal - warm but never brassy", gradient: "linear-gradient(135deg, #D4B878 0%, #A88840 100%)" },
  { name: "Aged Bronze", note: "Patina tells a story, like your coloring", gradient: "linear-gradient(135deg, #9A7B5D 0%, #6B5D50 100%)" },
  { name: "Velvet", note: "Light-absorbing depth for evening drama", gradient: "linear-gradient(135deg, #6A4858 0%, #4A3F35 100%)" },
  { name: "Linen", note: "Breathes and softens with wear, like you", gradient: "linear-gradient(135deg, #F5EDE3 0%, #D9CFC3 100%)" }
];

const colorInsights = {
  "#F5EDE3": "Your perfect white - warm enough to harmonize, light enough to brighten without washing you out.",
  "#D9CFC3": "The color your skin appears in soft window light. A neutral that makes you look healthy.",
  "#B5A090": "Your natural shadow color. Use it where you want to recede or create depth.",
  "#D4B878": "The gold in your eyes, amplified. Draws light to your face when worn near it.",
  "#7A8B68": "The sage ring of your iris. Makes your eyes appear more vividly green when repeated nearby.",
  "#C4908A": "Your natural lip color. Foundation for all lip looks - go sheerer or deeper from here.",
  "#6A4858": "Evening drama without severity. Deep enough for a statement, warm enough to belong to you.",
  "#8A9AAA": "Your one cool neutral - the blue in your veins made wearable. Use sparingly for contrast.",
  "#E8D5C4": "Luminous Ivory - the highlight on your cheekbone, your skin at its brightest.",
  "#4A5A42": "Forest Smoke - the deep outer ring of your iris. Grounding and mysterious."
};

const storyFragments = {
  settings: [
    "A November afternoon in a private library, dust motes suspended in amber light",
    "The hour before a dinner party, alone in a room full of flowers",
    "A train through countryside at golden hour, half-dreaming",
    "Morning fog lifting from a garden you have loved since childhood",
    "The quiet after snow, when colors become more themselves"
  ],
  subjects: [
    "the woman arranging dried roses wears",
    "she has chosen, deliberately,",
    "the light catches",
    "what remains when everything else is stripped away:",
    "the only colors that feel like truth:"
  ],
  objects: [
    "a silk scarf the color of October honey",
    "linen the shade of old love letters",
    "something soft and moss-green, worn to perfect softness",
    "gold that has lost its brightness to become something better",
    "the blush of a rose pressed between pages"
  ],
  endings: [
    "She has always known what suited her.",
    "Some colors are not worn but inhabited.",
    "The palette of a life that chose itself.",
    "These are the colors that will outlast everything else.",
    "She is most visible when dressed in whispers."
  ]
};

// State
let favorites = {};
try {
  favorites = JSON.parse(localStorage.getItem("gildedMossFavorites") || "{}");
} catch(e) { favorites = {}; }

let compareColors = [null, null];
let discoveryIndex = 0;

// All colors flat
const allColors = [];
sourcePigments.forEach(p => allColors.push({ name: p.name, hex: p.hex }));
Object.values(paletteGroups).forEach(group => {
  group.forEach(c => allColors.push({ name: c.name, hex: c.hex }));
});

// Init
document.addEventListener("DOMContentLoaded", () => {
  renderSourceGems();
  renderPigments();
  renderPalette();
  renderLooks();
  renderFavorites();
  renderTimePreview();
  renderHarmonyWheel();
  renderTextures();
  renderSeasonPalettes();
  renderPaletteDNA();
  renderDiscovery();
  initNav();
  initTimeSlider();
  initSeasonTabs();
});

function initNav() {
  document.querySelectorAll(".nav-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".nav-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
      document.getElementById(btn.dataset.section).classList.add("active");
    });
  });
}

function renderSourceGems() {
  const container = document.getElementById("sourceGems");
  sourcePigments.forEach(p => {
    const gem = document.createElement("div");
    gem.className = "source-gem";
    gem.style.background = p.hex;
    gem.title = p.name + " - " + p.source;
    gem.addEventListener("click", () => copyHex(p.hex, p.name));
    container.appendChild(gem);
  });
}

function renderPigments() {
  const grid = document.getElementById("pigmentsGrid");
  sourcePigments.forEach(p => {
    const card = document.createElement("div");
    card.className = "pigment-card";
    card.innerHTML = `
      <div class="pigment-swatch" style="background: ${p.hex}"></div>
      <div class="pigment-name">${p.name}</div>
      <div class="pigment-hex">${p.hex}</div>
      <div class="pigment-source">${p.source}</div>
    `;
    card.addEventListener("click", () => {
      copyHex(p.hex, p.name);
      addToCompare(p.hex, p.name);
    });
    card.addEventListener("dblclick", () => toggleFavorite(p.hex, p.name));
    grid.appendChild(card);
  });
}

function renderPalette() {
  const container = document.getElementById("paletteContainer");
  container.innerHTML = "";
  
  Object.entries(paletteGroups).forEach(([groupName, colors]) => {
    const section = document.createElement("div");
    section.className = "palette-section";
    section.innerHTML = `<h3 class="palette-section-title">${groupName}</h3>`;
    
    const grid = document.createElement("div");
    grid.className = "palette-grid";
    
    colors.forEach(c => {
      const swatch = createSwatch(c.hex, c.name);
      grid.appendChild(swatch);
    });
    
    section.appendChild(grid);
    container.appendChild(section);
  });
}

function createSwatch(hex, name) {
  const swatch = document.createElement("div");
  swatch.className = "swatch";
  if (favorites[hex]) swatch.classList.add("favorite");
  swatch.style.background = hex;
  swatch.innerHTML = `<span class="swatch-tooltip">${name}<br>${hex}</span>`;
  swatch.addEventListener("click", (e) => {
    e.stopPropagation();
    copyHex(hex, name);
    addToCompare(hex, name);
  });
  swatch.addEventListener("dblclick", (e) => {
    e.stopPropagation();
    toggleFavorite(hex, name);
    swatch.classList.toggle("favorite", !!favorites[hex]);
  });
  return swatch;
}

function renderLooks() {
  const grid = document.getElementById("looksGrid");
  looks.forEach(look => {
    const card = document.createElement("div");
    card.className = "look-card";
    
    let colorsHTML = "";
    look.colors.forEach(hex => {
      colorsHTML += `<div class="look-swatch" style="background: ${hex}" onclick="copyHex('${hex}')"></div>`;
    });
    
    card.innerHTML = `
      <div class="look-category">${look.category}</div>
      <h3 class="look-title">${look.title}</h3>
      <p class="look-desc">${look.desc}</p>
      <div class="look-colors">${colorsHTML}</div>
    `;
    grid.appendChild(card);
  });
}

function copyHex(hex, name) {
  if (name === undefined) name = "";
  navigator.clipboard.writeText(hex).then(() => {
    showToast(`Copied ${hex}${name ? " (" + name + ")" : ""}`);
  }).catch(() => {
    showToast(`${hex}${name ? " (" + name + ")" : ""}`);
  });
}

function showToast(message) {
  const toast = document.getElementById("toast");
  toast.textContent = message;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 2000);
}

function toggleFavorite(hex, name) {
  if (favorites[hex]) {
    delete favorites[hex];
    showToast(`Removed ${name} from favorites`);
  } else {
    favorites[hex] = name;
    showToast(`Added ${name} to favorites`);
  }
  try {
    localStorage.setItem("gildedMossFavorites", JSON.stringify(favorites));
  } catch(e) {}
  renderFavorites();
  document.querySelectorAll(".swatch").forEach(s => {
    const bg = rgbToHex(s.style.backgroundColor);
    s.classList.toggle("favorite", !!favorites[bg]);
  });
}

function rgbToHex(rgb) {
  if (!rgb) return "";
  if (rgb.startsWith("#")) return rgb.toUpperCase();
  const match = rgb.match(/\d+/g);
  if (!match || match.length < 3) return rgb;
  return "#" + match.slice(0, 3).map(x => parseInt(x).toString(16).padStart(2, "0")).join("").toUpperCase();
}

function renderFavorites() {
  const container = document.getElementById("favoritesContainer");
  const exportSection = document.getElementById("favExport");
  
  if (Object.keys(favorites).length === 0) {
    container.innerHTML = '<p class="favorites-empty">Double-click any swatch to save it here.</p>';
    exportSection.style.display = "none";
    return;
  }
  
  exportSection.style.display = "block";
  let html = '<div class="favorites-grid">';
  Object.entries(favorites).forEach(([hex, name]) => {
    html += `
      <div class="favorite-item">
        <div class="favorite-swatch" style="background: ${hex}" onclick="copyHex('${hex}', '${name}')" ondblclick="toggleFavorite('${hex}', '${name}')"></div>
        <div class="favorite-name">${name}</div>
      </div>
    `;
  });
  html += '</div>';
  container.innerHTML = html;
}

function addToCompare(hex, name) {
  if (!compareColors[0]) {
    compareColors[0] = { hex, name };
    updateCompareSlot(0);
  } else if (!compareColors[1]) {
    compareColors[1] = { hex, name };
    updateCompareSlot(1);
    generateVerdict();
  } else {
    compareColors[0] = compareColors[1];
    compareColors[1] = { hex, name };
    updateCompareSlot(0);
    updateCompareSlot(1);
    generateVerdict();
  }
}

function updateCompareSlot(index) {
  const slot = document.getElementById(`compareSlot${index + 1}`);
  const color = compareColors[index];
  if (color) {
    slot.style.background = color.hex;
    slot.textContent = color.name;
    slot.style.color = isLight(color.hex) ? "#3D3632" : "#FAF7F2";
    slot.style.fontSize = "0.75rem";
    slot.style.fontStyle = "italic";
  } else {
    slot.style.background = "";
    slot.textContent = "tap a swatch";
    slot.style.color = "";
  }
}

function isLight(hex) {
  const r = parseInt(hex.slice(1, 3), 16);
  const g = parseInt(hex.slice(3, 5), 16);
  const b = parseInt(hex.slice(5, 7), 16);
  return (r * 0.299 + g * 0.587 + b * 0.114) > 150;
}

function clearCompare() {
  compareColors = [null, null];
  updateCompareSlot(0);
  updateCompareSlot(1);
  document.getElementById("compareVerdict").textContent = "Select two colors to see their relationship.";
}

function generateVerdict() {
  const [c1, c2] = compareColors;
  if (!c1 || !c2) return;
  
  const hsl1 = hexToHSL(c1.hex);
  const hsl2 = hexToHSL(c2.hex);
  
  const hueDiff = Math.abs(hsl1.h - hsl2.h);
  const satDiff = Math.abs(hsl1.s - hsl2.s);
  const lightDiff = Math.abs(hsl1.l - hsl2.l);
  
  let verdict = "";
  
  if (hueDiff < 30 || hueDiff > 330) {
    if (lightDiff > 25) {
      verdict = `${c1.name} and ${c2.name} are tonal relatives - same family at different depths. Wear together for sophisticated monochrome with dimension.`;
    } else {
      verdict = `Near-twins in the same family. One may overpower the other. Separate them with a neutral or choose just one.`;
    }
  } else if (hueDiff > 150 && hueDiff < 210) {
    verdict = `${c1.name} and ${c2.name} are complementary opposites. High tension - use one as accent against the other as base for maximum impact.`;
  } else if ((hueDiff > 60 && hueDiff < 120) || (hueDiff > 240 && hueDiff < 300)) {
    verdict = `Harmonious neighbors on the color wheel. Gentle movement without jarring contrast - ideal for a relaxed, pulled-together look.`;
  } else {
    verdict = `${c1.name} and ${c2.name} create a split relationship - interesting dialogue without direct opposition. Use as base-accent pair with intention.`;
  }
  
  if (satDiff > 30) {
    verdict += ` The saturation difference creates a focal point on the more vivid color.`;
  }
  
  document.getElementById("compareVerdict").textContent = verdict;
}

function hexToHSL(hex) {
  let r = parseInt(hex.slice(1, 3), 16) / 255;
  let g = parseInt(hex.slice(3, 5), 16) / 255;
  let b = parseInt(hex.slice(5, 7), 16) / 255;
  
  const max = Math.max(r, g, b), min = Math.min(r, g, b);
  let h, s, l = (max + min) / 2;
  
  if (max === min) {
    h = s = 0;
  } else {
    const d = max - min;
    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
    switch (max) {
      case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
      case g: h = ((b - r) / d + 2) / 6; break;
      case b: h = ((r - g) / d + 4) / 6; break;
    }
  }
  
  return { h: h * 360, s: s * 100, l: l * 100 };
}

// Time Simulator
function initTimeSlider() {
  const slider = document.getElementById("timeSlider");
  slider.addEventListener("input", () => {
    updateTimePreview(parseFloat(slider.value));
  });
}

function renderTimePreview() {
  const preview = document.getElementById("timePreview");
  const previewColors = ["#D4B878", "#7A8B68", "#C4908A", "#B5A090", "#8A9AAA", "#6A4858"];
  previewColors.forEach(hex => {
    const div = document.createElement("div");
    div.className = "time-preview-swatch";
    div.style.background = hex;
    preview.appendChild(div);
  });
  updateTimePreview(12);
}

function updateTimePreview(hour) {
  const label = document.getElementById("timeLabel");
  const preview = document.getElementById("timePreview");
  
  const hourInt = Math.floor(hour);
  const mins = Math.round((hour - hourInt) * 60);
  const timeStr = `${hourInt.toString().padStart(2, "0")}:${mins.toString().padStart(2, "0")}`;
  
  let period = "";
  if (hour < 6) period = "Night";
  else if (hour < 9) period = "Golden Dawn";
  else if (hour < 11) period = "Morning Light";
  else if (hour < 14) period = "Noon";
  else if (hour < 17) period = "Afternoon";
  else if (hour < 19) period = "Golden Hour";
  else if (hour < 21) period = "Dusk";
  else period = "Night";
  
  label.textContent = `${timeStr} - ${period}`;
  
  let warmth = 0;
  let brightness = 1;
  
  if (hour < 6 || hour > 21) {
    warmth = -10;
    brightness = 0.5;
  } else if (hour < 9 || (hour > 17 && hour < 19)) {
    warmth = 25;
    brightness = 1.05;
  } else if (hour > 11 && hour < 14) {
    warmth = 5;
    brightness = 1.15;
  }
  
  preview.style.filter = `brightness(${brightness}) sepia(${Math.max(0, warmth) / 100}) saturate(${1 + warmth / 100})`;
  preview.style.background = hour < 6 || hour > 21 ? "#1a1a2e" : hour > 17 ? "#f5e6c8" : "#fff";
}

// Shopping
function analyzeShopColor() {
  const input = document.getElementById("shopInput").value.trim();
  let hex = "";
  
  if (input.startsWith("#")) {
    hex = input.toUpperCase();
    if (hex.length === 4) {
      hex = "#" + hex[1] + hex[1] + hex[2] + hex[2] + hex[3] + hex[3];
    }
  } else if (input.toLowerCase().startsWith("rgb")) {
    const match = input.match(/\d+/g);
    if (match && match.length >= 3) {
      hex = "#" + match.slice(0, 3).map(x => parseInt(x).toString(16).padStart(2, "0")).join("").toUpperCase();
    }
  }
  
  if (!hex || hex.length !== 7) {
    showToast("Enter a valid hex (#B5A090) or RGB");
    return;
  }
  
  const result = document.getElementById("shopResult");
  const preview = document.getElementById("shopPreview");
  const verdict = document.getElementById("shopVerdict");
  const matchFill = document.getElementById("matchFill");
  const closestContainer = document.getElementById("closestSwatches");
  
  preview.style.background = hex;
  
  const distances = allColors.map(c => ({
    ...c,
    distance: colorDistance(hex, c.hex)
  })).sort((a, b) => a.distance - b.distance);
  
  const closest = distances.slice(0, 3);
  const matchPercent = Math.max(0, 100 - closest[0].distance * 2);
  
  matchFill.style.width = matchPercent + "%";
  
  if (matchPercent > 85) {
    verdict.textContent = `Excellent match! This belongs in your palette. Nearly identical to ${closest[0].name}.`;
  } else if (matchPercent > 70) {
    verdict.textContent = `Good harmony. This works with your palette - closest to ${closest[0].name}.`;
  } else if (matchPercent > 50) {
    verdict.textContent = `Proceed with caution. Outside your core palette but could work as a small accent. Pulls toward ${closest[0].name}.`;
  } else {
    verdict.textContent = `Outside your palette territory. If you love it, pair with ${closest[0].name} to bridge it back.`;
  }
  
  closestContainer.innerHTML = "";
  closest.forEach(c => {
    const div = document.createElement("div");
    div.className = "closest-swatch";
    div.style.background = c.hex;
    div.title = c.name;
    div.addEventListener("click", () => copyHex(c.hex, c.name));
    closestContainer.appendChild(div);
  });
  
  result.classList.add("show");
}

function colorDistance(hex1, hex2) {
  const r1 = parseInt(hex1.slice(1, 3), 16);
  const g1 = parseInt(hex1.slice(3, 5), 16);
  const b1 = parseInt(hex1.slice(5, 7), 16);
  const r2 = parseInt(hex2.slice(1, 3), 16);
  const g2 = parseInt(hex2.slice(3, 5), 16);
  const b2 = parseInt(hex2.slice(5, 7), 16);
  
  return Math.sqrt(Math.pow(r1 - r2, 2) + Math.pow(g1 - g2, 2) + Math.pow(b1 - b2, 2)) / 4.41;
}

// Harmony
function renderHarmonyWheel() {
  const wheel = document.getElementById("harmonyWheel");
  const radius = 110;
  const centerX = 130;
  const centerY = 130;
  
  wheel.style.background = `conic-gradient(
    hsl(0, 40%, 65%),
    hsl(60, 40%, 65%),
    hsl(120, 40%, 65%),
    hsl(180, 40%, 65%),
    hsl(240, 40%, 65%),
    hsl(300, 40%, 65%),
    hsl(360, 40%, 65%)
  )`;
  wheel.style.opacity = "0.25";
  
  allColors.slice(0, 25).forEach(color => {
    const hsl = hexToHSL(color.hex);
    const angle = (hsl.h - 90) * Math.PI / 180;
    const distance = (hsl.s / 100) * radius;
    
    const x = centerX + Math.cos(angle) * distance;
    const y = centerY + Math.sin(angle) * distance;
    
    const dot = document.createElement("div");
    dot.className = "harmony-dot";
    dot.style.background = color.hex;
    dot.style.left = x + "px";
    dot.style.top = y + "px";
    dot.title = color.name;
    dot.addEventListener("click", () => copyHex(color.hex, color.name));
    wheel.appendChild(dot);
  });
}

// Textures
function renderTextures() {
  const grid = document.getElementById("textureGrid");
  textures.forEach(t => {
    const card = document.createElement("div");
    card.className = "texture-card";
    card.innerHTML = `
      <div class="texture-preview" style="background: ${t.gradient}"></div>
      <div class="texture-name">${t.name}</div>
      <div class="texture-note">${t.note}</div>
    `;
    grid.appendChild(card);
  });
}

// Story
function generateStory() {
  const output = document.getElementById("storyOutput");
  const setting = storyFragments.settings[Math.floor(Math.random() * storyFragments.settings.length)];
  const subject = storyFragments.subjects[Math.floor(Math.random() * storyFragments.subjects.length)];
  const object = storyFragments.objects[Math.floor(Math.random() * storyFragments.objects.length)];
  const ending = storyFragments.endings[Math.floor(Math.random() * storyFragments.endings.length)];
  
  output.textContent = `${setting}. ${subject.charAt(0).toUpperCase() + subject.slice(1)} ${object}. ${ending}`;
}

// Seasons
function initSeasonTabs() {
  document.querySelectorAll(".season-tab").forEach(tab => {
    tab.addEventListener("click", () => {
      document.querySelectorAll(".season-tab").forEach(t => t.classList.remove("active"));
      tab.classList.add("active");
      document.querySelectorAll(".season-palette").forEach(p => p.classList.remove("active"));
      document.getElementById(`season-${tab.dataset.season}`).classList.add("active");
    });
  });
}

function renderSeasonPalettes() {
  const container = document.getElementById("seasonPalettes");
  
  const seasonAdjustments = {
    spring: { hShift: 10, sBoost: 10, lBoost: 5, desc: "Warmer, brighter - for clear spring light" },
    summer: { hShift: -5, sBoost: -15, lBoost: 10, desc: "Softer, cooler - for hazy summer days" },
    autumn: { hShift: 5, sBoost: 5, lBoost: -5, desc: "Richer, earthier - your natural home" },
    winter: { hShift: 0, sBoost: -10, lBoost: -10, desc: "Deeper, quieter - for low winter light" }
  };
  
  Object.entries(seasonAdjustments).forEach(([season, adj]) => {
    const palette = document.createElement("div");
    palette.className = `season-palette${season === "spring" ? " active" : ""}`;
    palette.id = `season-${season}`;
    
    const desc = document.createElement("p");
    desc.style.cssText = "font-size: 0.8125rem; color: var(--skin-shadow); font-style: italic; margin-bottom: 14px;";
    desc.textContent = adj.desc;
    palette.appendChild(desc);
    
    const grid = document.createElement("div");
    grid.className = "palette-grid";
    
    const baseColors = Object.values(paletteGroups).flat().slice(0, 16);
    baseColors.forEach(c => {
      const hsl = hexToHSL(c.hex);
      const newHex = hslToHex(
        (hsl.h + adj.hShift + 360) % 360,
        Math.max(0, Math.min(100, hsl.s + adj.sBoost)),
        Math.max(0, Math.min(100, hsl.l + adj.lBoost))
      );
      
      const swatch = document.createElement("div");
      swatch.className = "swatch";
      swatch.style.background = newHex;
      swatch.innerHTML = `<span class="swatch-tooltip">${c.name} (${season})<br>${newHex}</span>`;
      swatch.addEventListener("click", () => copyHex(newHex, c.name + " (" + season + ")"));
      grid.appendChild(swatch);
    });
    
    palette.appendChild(grid);
    container.appendChild(palette);
  });
}

function hslToHex(h, s, l) {
  s /= 100;
  l /= 100;
  const a = s * Math.min(l, 1 - l);
  const f = n => {
    const k = (n + h / 30) % 12;
    const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
    return Math.round(255 * color).toString(16).padStart(2, "0");
  };
  return `#${f(0)}${f(8)}${f(4)}`.toUpperCase();
}

// Palette DNA
function renderPaletteDNA() {
  // Temperature: 68% warm (you lean warm but have cool capacity)
  const tempMarker = document.getElementById("tempMarker");
  tempMarker.style.left = "68%";
  document.getElementById("tempReading").textContent = "You sit at 68% warm - firmly in warm territory but not at the extreme. This is why you can wear both golden honey AND slate blue. Most Soft Autumns are 60-65% warm; your extra warmth comes from the golden starburst in your eyes and the honey tones in your hair. But your cool-toned veins and the sage-green in your iris give you unusual range into muted teals and dusty blues that would flatten a typical Autumn.";
  
  // Saturation range: 15-55%
  const satRange = document.getElementById("saturationRange");
  satRange.style.background = "linear-gradient(to right, #e8e8e8 0%, #888 100%)";
  satRange.innerHTML = '<div class="dna-range-bar" style="left: 15%; width: 40%; background: linear-gradient(to right, ' + 
    allColors.slice(0, 8).map(c => c.hex).join(", ") + ');"></div>';
  document.getElementById("satReading").textContent = "Your saturation sweet spot is 15-55% - definitively muted. You disappear in anything too vivid; you look muddy in anything too gray. This narrow band is why 'finding your colors' feels hard - most retail colors miss it entirely. Your most powerful colors live around 35% saturation: visible but never loud.";
  
  // Value spread: 25-85%
  const valueRange = document.getElementById("valueRange");
  valueRange.style.background = "linear-gradient(to right, #1a1a1a 0%, #ffffff 100%)";
  valueRange.innerHTML = '<div class="dna-range-bar" style="left: 15%; width: 60%; background: linear-gradient(to right, #3D3632, #6B5D50, #9A8B7A, #D9CFC3, #F5EDE3);"></div>';
  document.getElementById("valueReading").textContent = "Value range of 25-85% means you handle both light and dark well, but true black and true white are outside your zone. Your darkest workable color is Deep Earth (#3D3632) - almost black but with brown warmth. Your lightest is Parchment (#F5EDE3) - almost white but with cream warmth. This is a medium-to-wide value range, giving you good contrast options without harshness.";
  
  // Hue territory
  const hueMap = document.getElementById("hueMap");
  hueMap.innerHTML = '<div class="dna-hue-zone" style="left: 5%; width: 25%;"></div>' + // yellows to oranges
    '<div class="dna-hue-zone" style="left: 32%; width: 12%;"></div>' + // greens
    '<div class="dna-hue-zone" style="left: 50%; width: 8%; opacity: 0.3;"></div>'; // hint of blue
  document.getElementById("hueReading").textContent = "Your hue territory clusters heavily in yellow-orange (30-60 degrees) with a secondary home in yellow-green (75-110 degrees). You have a small outpost in blue-gray (200-220 degrees) - this is unusual for Soft Autumn and comes from your cool vein undertone. Red and purple are largely absent; when you wear them, you need the brownest, most muted versions (terracotta not cherry, plum not violet).";
  
  // Generic SA comparison
  const genericSA = document.getElementById("genericSA");
  const genericColors = ["#C9B896", "#A8926F", "#7A8060", "#C4A882", "#D4B8A0", "#8A7868", "#B89878", "#6B6B5B"];
  genericColors.forEach(hex => {
    const swatch = document.createElement("div");
    swatch.className = "dna-comparison-swatch";
    swatch.style.background = hex;
    genericSA.appendChild(swatch);
  });
  
  const yourPalette = document.getElementById("yourPalette");
  const yourColors = ["#D4B878", "#7A8B6A", "#8A9AAA", "#C4908A", "#6B5344", "#4A5A42", "#D4A5A0", "#5A7A80"];
  yourColors.forEach(hex => {
    const swatch = document.createElement("div");
    swatch.className = "dna-comparison-swatch";
    swatch.style.background = hex;
    yourPalette.appendChild(swatch);
  });
  
  const differences = document.getElementById("differences");
  differences.innerHTML = `
    <div class="dna-diff-item"><strong>More sage, less olive.</strong> Generic SA leans yellow-green; you lean blue-green. Your eye color pulls the whole palette toward sage and teal.</div>
    <div class="dna-diff-item"><strong>Cool neutral capacity.</strong> Slate Blue (#8A9AAA) and Stormy Teal (#5A7A80) would not appear in standard SA palettes. They come from your vein undertone and the outer ring of your iris.</div>
    <div class="dna-diff-item"><strong>Pinker flush tones.</strong> Your natural blush and lip color are rosier than typical SA, which runs more peach. This lets you wear dustier pinks that would look off on other Autumns.</div>
    <div class="dna-diff-item"><strong>Higher contrast tolerance.</strong> Your hair has both light and dark - honey to walnut - giving you more range between your lightest and darkest wearable colors than the typical "soft" season.</div>
    <div class="dna-diff-item"><strong>Gold over bronze.</strong> Your ideal metal is matte gold, not the antiqued bronze often recommended for SA. Your warmth is yellow-based, not orange-based.</div>
  `;
  
  // Fingerprint
  document.getElementById("fingerprint").textContent = "Gilded Moss is Soft Autumn filtered through green-gold eyes, expressed in sage rather than olive, with unusual cool-neutral range and a rosier-than-typical flush. Your palette's signature is the coexistence of warm gold and cool sage - colors that don't usually live together but that your coloring bridges. When you wear both in one outfit, you look like yourself. When you wear all-warm or all-cool, something's missing.";
}

// Discovery
function renderDiscovery() {
  updateDiscoveryCard();
}

function updateDiscoveryCard() {
  const color = allColors[discoveryIndex];
  document.getElementById("discoverySwatch").style.background = color.hex;
  document.getElementById("discoveryName").textContent = color.name;
  document.getElementById("discoveryHex").textContent = color.hex;
  document.getElementById("discoveryCounter").textContent = `${discoveryIndex + 1} of ${allColors.length}`;
  
  const insight = colorInsights[color.hex] || generateGenericInsight(color);
  document.getElementById("discoveryInsight").textContent = insight;
}

function generateGenericInsight(color) {
  const hsl = hexToHSL(color.hex);
  
  if (hsl.l > 70) {
    return `A light value in your palette - use ${color.name} to brighten and open up an outfit or draw focus upward toward your face.`;
  } else if (hsl.l < 30) {
    return `${color.name} is a grounding anchor. Use it as a base or to add weight and seriousness to lighter combinations.`;
  } else if (hsl.s > 50) {
    return `One of your more saturated options. ${color.name} will draw the eye - place it where you want attention.`;
  } else {
    return `${color.name} has the muted quality that defines your palette. It harmonizes easily and creates sophisticated combinations.`;
  }
}

function prevDiscovery() {
  discoveryIndex = (discoveryIndex - 1 + allColors.length) % allColors.length;
  updateDiscoveryCard();
}

function nextDiscovery() {
  discoveryIndex = (discoveryIndex + 1) % allColors.length;
  updateDiscoveryCard();
}

// Export
function exportJSON() {
  const data = {
    title: "Gilded Moss",
    season: "Soft Autumn Leaning Warm",
    sourcePigments,
    palette: paletteGroups,
    exportDate: new Date().toISOString()
  };
  
  document.getElementById("exportPreview").textContent = JSON.stringify(data, null, 2);
  showToast("JSON generated - copy from below");
}

function exportText() {
  let text = "GILDED MOSS - Personal Color Palette\n";
  text += "Season: Soft Autumn Leaning Warm\n\n";
  text += "=== SOURCE PIGMENTS ===\n";
  sourcePigments.forEach(p => {
    text += `${p.name}: ${p.hex} (${p.source})\n`;
  });
  text += "\n=== WEARABLE PALETTE ===\n";
  Object.entries(paletteGroups).forEach(([group, colors]) => {
    text += `\n${group}:\n`;
    colors.forEach(c => {
      text += `  ${c.name}: ${c.hex}\n`;
    });
  });
  
  document.getElementById("exportPreview").textContent = text;
  showToast("Text list generated - copy from below");
}

function exportFavJSON() {
  const data = {
    title: "Gilded Moss - Favorites",
    favorites: Object.entries(favorites).map(([hex, name]) => ({ name, hex })),
    exportDate: new Date().toISOString()
  };
  
  document.getElementById("exportPreview").textContent = JSON.stringify(data, null, 2);
  showToast("Favorites JSON generated");
}

function exportFavorites() {
  exportFavJSON();
  document.querySelectorAll(".nav-btn").forEach(b => b.classList.remove("active"));
  document.querySelector('[data-section="export"]').classList.add("active");
  document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
  document.getElementById("export").classList.add("active");
}
</script>

</body>
</html>
    
  </body>
  
</html>
